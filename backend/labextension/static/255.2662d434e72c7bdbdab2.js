"use strict";(self.webpackChunk_hdsp_agent_extension=self.webpackChunk_hdsp_agent_extension||[]).push([[255],{6255:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ye});var o=n(7495),a=n(7324),s=n(6766),r=n(3345),l=n.n(r),i=n(5882);const c=({onClose:e,onSave:t,currentConfig:n})=>{const[o,a]=(0,r.useState)(n?.provider||"gemini"),[s,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[p,u]=(0,r.useState)(n?.gemini?.apiKey||""),m=e=>e&&["gemini-3-pro-preview","gemini-2.5-pro","gemini-2.5-flash"].includes(e)?e:(console.warn(`[SettingsPanel] Invalid Gemini model "${e}", defaulting to gemini-2.5-pro`),"gemini-2.5-pro"),[g,h]=(0,r.useState)(m(n?.gemini?.model)),[f,C]=(0,r.useState)(n?.vllm?.endpoint||"http://localhost:8000"),[y,b]=(0,r.useState)(n?.vllm?.apiKey||""),[x,v]=(0,r.useState)(n?.vllm?.model||"meta-llama/Llama-2-7b-chat-hf"),[w,E]=(0,r.useState)(n?.openai?.apiKey||""),[k,S]=(0,r.useState)(n?.openai?.model||"gpt-4");(0,r.useEffect)(()=>{n&&(a(n.provider||"gemini"),u(n.gemini?.apiKey||""),h(m(n.gemini?.model)),C(n.vllm?.endpoint||"http://localhost:8000"),b(n.vllm?.apiKey||""),v(n.vllm?.model||"meta-llama/Llama-2-7b-chat-hf"),E(n.openai?.apiKey||""),S(n.openai?.model||"gpt-4"))},[n]);const L=e=>{const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length&&t.pop()?.split(";").shift()||""},j=()=>({provider:o,gemini:{apiKey:p,model:g},vllm:{endpoint:f,apiKey:y,model:x},openai:{apiKey:w,model:k}});return l().createElement("div",{className:"jp-agent-settings-overlay"},l().createElement("div",{className:"jp-agent-settings-dialog"},l().createElement("div",{className:"jp-agent-settings-header"},l().createElement("h2",null,"LLM ì„¤ì •"),l().createElement("button",{className:"jp-agent-settings-close",onClick:e,title:"ë‹«ê¸°"},"Ã—")),l().createElement("div",{className:"jp-agent-settings-content"},l().createElement("div",{className:"jp-agent-settings-group"},l().createElement("label",{className:"jp-agent-settings-label"},"í”„ë¡œë°”ì´ë”"),l().createElement("select",{className:"jp-agent-settings-select",value:o,onChange:e=>a(e.target.value)},l().createElement("option",{value:"gemini"},"Google Gemini"),l().createElement("option",{value:"vllm"},"vLLM"),l().createElement("option",{value:"openai"},"OpenAI"))),"gemini"===o&&l().createElement("div",{className:"jp-agent-settings-provider"},l().createElement("h3",null,"Gemini ì„¤ì •"),l().createElement("div",{className:"jp-agent-settings-group"},l().createElement("label",{className:"jp-agent-settings-label"},"API í‚¤"),l().createElement("input",{type:"password",className:"jp-agent-settings-input",value:p,onChange:e=>u(e.target.value),placeholder:"Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”"})),l().createElement("div",{className:"jp-agent-settings-group"},l().createElement("label",{className:"jp-agent-settings-label"},"ëª¨ë¸"),l().createElement("select",{className:"jp-agent-settings-select",value:g,onChange:e=>h(e.target.value)},l().createElement("option",{value:"gemini-3-pro-preview"},"Gemini 3.0 Pro"),l().createElement("option",{value:"gemini-2.5-pro"},"Gemini 2.5 Pro"),l().createElement("option",{value:"gemini-2.5-flash"},"Gemini 2.5 Flash")))),"vllm"===o&&l().createElement("div",{className:"jp-agent-settings-provider"},l().createElement("h3",null,"vLLM ì„¤ì •"),l().createElement("div",{className:"jp-agent-settings-group"},l().createElement("label",{className:"jp-agent-settings-label"},"ì„œë²„ ì£¼ì†Œ"),l().createElement("input",{type:"text",className:"jp-agent-settings-input",value:f,onChange:e=>C(e.target.value),placeholder:"http://localhost:8000"})),l().createElement("div",{className:"jp-agent-settings-group"},l().createElement("label",{className:"jp-agent-settings-label"},"API í‚¤ (ì„ íƒì‚¬í•­)"),l().createElement("input",{type:"password",className:"jp-agent-settings-input",value:y,onChange:e=>b(e.target.value),placeholder:"API í‚¤ê°€ í•„ìš”í•œ ê²½ìš° ì…ë ¥"})),l().createElement("div",{className:"jp-agent-settings-group"},l().createElement("label",{className:"jp-agent-settings-label"},"ëª¨ë¸ ì´ë¦„"),l().createElement("input",{type:"text",className:"jp-agent-settings-input",value:x,onChange:e=>v(e.target.value),placeholder:"meta-llama/Llama-2-7b-chat-hf"}))),"openai"===o&&l().createElement("div",{className:"jp-agent-settings-provider"},l().createElement("h3",null,"OpenAI ì„¤ì •"),l().createElement("div",{className:"jp-agent-settings-group"},l().createElement("label",{className:"jp-agent-settings-label"},"API í‚¤"),l().createElement("input",{type:"password",className:"jp-agent-settings-input",value:w,onChange:e=>E(e.target.value),placeholder:"sk-..."})),l().createElement("div",{className:"jp-agent-settings-group"},l().createElement("label",{className:"jp-agent-settings-label"},"ëª¨ë¸"),l().createElement("select",{className:"jp-agent-settings-select",value:k,onChange:e=>S(e.target.value)},l().createElement("option",{value:"gpt-4"},"GPT-4"),l().createElement("option",{value:"gpt-4-turbo"},"GPT-4 Turbo"),l().createElement("option",{value:"gpt-3.5-turbo"},"GPT-3.5 Turbo"))))),c&&l().createElement("div",{className:"jp-agent-settings-test-result"},c),l().createElement("div",{className:"jp-agent-settings-footer"},l().createElement("button",{className:"jp-agent-settings-button jp-agent-settings-button-secondary",onClick:e},"ì·¨ì†Œ"),l().createElement("button",{className:"jp-agent-settings-button jp-agent-settings-button-test",onClick:async()=>{i(!0),d(null);try{const e=j(),t=await fetch("/hdsp-agent/test-llm",{method:"POST",headers:{"Content-Type":"application/json","X-XSRFToken":L("_xsrf")},body:JSON.stringify(e)});if(t.ok){const e=await t.json();d(`âœ… ì„±ê³µ: ${e.message}`)}else{const e=await t.json();d(`âŒ ì‹¤íŒ¨: ${e.error}`)}}catch(e){d(`âŒ ì˜¤ë¥˜: ${e instanceof Error?e.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`)}finally{i(!1)}},disabled:s},s?"í…ŒìŠ¤íŠ¸ ì¤‘...":"API í…ŒìŠ¤íŠ¸"),l().createElement("button",{className:"jp-agent-settings-button jp-agent-settings-button-primary",onClick:()=>{const n=j();t(n),e()}},"ì €ì¥"))))};var d=n(3603);class p{constructor(e){if(e)this.baseUrl=e;else{const e=d.PageConfig.getBaseUrl();this.baseUrl=d.URLExt.join(e,"hdsp-agent")}console.log("[ApiService] Base URL initialized:",this.baseUrl)}getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length&&t.pop()?.split(";").shift()||""}getCsrfToken(){return this.getCookie("_xsrf")}getHeaders(){return{"Content-Type":"application/json","X-XSRFToken":this.getCsrfToken()}}async cellAction(e){const t=await fetch(`${this.baseUrl}/cell/action`,{method:"POST",headers:this.getHeaders(),credentials:"include",body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({message:"API request failed"}));throw new Error(e.message||"API request failed")}return t.json()}async sendMessage(e){const t=await fetch(`${this.baseUrl}/chat/message`,{method:"POST",headers:this.getHeaders(),credentials:"include",body:JSON.stringify(e)});if(!t.ok){const n=await t.json().catch(()=>({message:`Failed to send message (${t.status})`,error:`HTTP ${t.status}: ${t.statusText}`}));throw console.error("Chat API error:",n),console.error("Response status:",t.status),console.error("Request:",e),new Error(n.message||n.error||`Failed to send message (${t.status})`)}return t.json()}async sendMessageStream(e,t,n){const o=await fetch(`${this.baseUrl}/chat/stream`,{method:"POST",headers:this.getHeaders(),credentials:"include",body:JSON.stringify(e)});if(!o.ok){const e=await o.text();throw new Error(`Failed to send message: ${e}`)}const a=o.body?.getReader();if(!a)throw new Error("Response body is not readable");const s=new TextDecoder;let r="";try{for(;;){const{done:e,value:o}=await a.read();if(e)break;r+=s.decode(o,{stream:!0});const l=r.split("\n");r=l.pop()||"";for(const e of l)if(e.startsWith("data: "))try{const o=JSON.parse(e.slice(6));if(o.error)throw new Error(o.error);o.conversationId&&n&&n({conversationId:o.conversationId,messageId:o.messageId,provider:o.metadata?.provider,model:o.metadata?.model}),o.content&&t(o.content),o.done&&o.metadata&&n&&n({provider:o.metadata.provider,model:o.metadata.model})}catch(t){if(!(t instanceof SyntaxError))throw t;console.warn("Failed to parse SSE data:",e)}}}finally{a.releaseLock()}}async saveConfig(e){const t=await fetch(`${this.baseUrl}/config`,{method:"POST",headers:this.getHeaders(),credentials:"include",body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({message:"Failed to save configuration"}));throw new Error(e.message||"Failed to save configuration")}}async getConfig(){const e=await fetch(`${this.baseUrl}/config`);if(!e.ok)throw new Error("Failed to load configuration");return e.json()}async getStatus(){const e=await fetch(`${this.baseUrl}/status`);if(!e.ok)throw new Error("Failed to get status");return e.json()}async getModels(){const e=await fetch(`${this.baseUrl}/models`);if(!e.ok)throw new Error("Failed to load models");return e.json()}async generateExecutionPlan(e){console.log("[ApiService] generateExecutionPlan request:",e);const t=await fetch(`${this.baseUrl}/auto-agent/plan`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)});if(!t.ok){const e=await t.text();console.error("[ApiService] Plan API Error:",{status:t.status,statusText:t.statusText,body:e,url:`${this.baseUrl}/auto-agent/plan`});let n="ê³„íš ìƒì„± ì‹¤íŒ¨";try{const t=JSON.parse(e);n=t.error||t.message||n}catch(t){n=e||n}throw new Error(n)}const n=await t.json();return console.log("[ApiService] Plan API Success:",n),n}async refineStepCode(e){console.log("[ApiService] refineStepCode request:",e);const t=await fetch(`${this.baseUrl}/auto-agent/refine`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)});if(!t.ok){const e=await t.text();console.error("[ApiService] Refine API Error:",{status:t.status,statusText:t.statusText,body:e,url:`${this.baseUrl}/auto-agent/refine`});let n="ì½”ë“œ ìˆ˜ì • ì‹¤íŒ¨";try{const t=JSON.parse(e);n=t.error||t.message||n}catch(t){n=e||n}throw new Error(n)}const n=await t.json();return console.log("[ApiService] Refine API Success:",n),n}async replanExecution(e){console.log("[ApiService] replanExecution request:",e);const t=await fetch(`${this.baseUrl}/auto-agent/replan`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)});if(!t.ok){const e=await t.text();console.error("[ApiService] Replan API Error:",{status:t.status,statusText:t.statusText,body:e,url:`${this.baseUrl}/auto-agent/replan`});let n="ê³„íš ì¬ìˆ˜ë¦½ ì‹¤íŒ¨";try{const t=JSON.parse(e);n=t.error||t.message||n}catch(t){n=e||n}throw new Error(n)}const n=await t.json();return console.log("[ApiService] Replan API Success:",n),n}async validateCode(e){console.log("[ApiService] validateCode request:",e);const t=await fetch(`${this.baseUrl}/auto-agent/validate`,{method:"POST",headers:this.getHeaders(),credentials:"include",body:JSON.stringify(e)});if(!t.ok){const e=await t.text();console.error("[ApiService] Validate API Error:",{status:t.status,statusText:t.statusText,body:e,url:`${this.baseUrl}/auto-agent/validate`});let n="ì½”ë“œ ê²€ì¦ ì‹¤íŒ¨";try{const t=JSON.parse(e);n=t.error||t.message||n}catch(t){n=e||n}throw new Error(n)}const n=await t.json();return console.log("[ApiService] Validate API Success:",n),n}async reflectOnExecution(e){console.log("[ApiService] reflectOnExecution request:",e);const t=await fetch(`${this.baseUrl}/auto-agent/reflect`,{method:"POST",headers:this.getHeaders(),credentials:"include",body:JSON.stringify(e)});if(!t.ok){const e=await t.text();console.error("[ApiService] Reflect API Error:",{status:t.status,statusText:t.statusText,body:e,url:`${this.baseUrl}/auto-agent/reflect`});let n="Reflection ì‹¤íŒ¨";try{const t=JSON.parse(e);n=t.error||t.message||n}catch(t){n=e||n}throw new Error(n)}const n=await t.json();return console.log("[ApiService] Reflect API Success:",n),n}async generateExecutionPlanStream(e,t,n){const o=await fetch(`${this.baseUrl}/auto-agent/plan/stream`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)});if(!o.ok){const e=await o.text();throw new Error(`Failed to generate plan: ${e}`)}const a=o.body?.getReader();if(!a)throw new Error("Response body is not readable");const s=new TextDecoder;let r="",l=null;try{for(;;){const{done:e,value:o}=await a.read();if(e)break;r+=s.decode(o,{stream:!0});const i=r.split("\n");r=i.pop()||"";for(const e of i)if(e.startsWith("data: "))try{const o=JSON.parse(e.slice(6));if(o.error)throw new Error(o.error);o.reasoning&&n&&n(o.reasoning),o.plan&&(t(o.plan),o.done&&(l=o.plan))}catch(e){if(!(e instanceof SyntaxError))throw e}}}finally{a.releaseLock()}if(!l)throw new Error("No plan received from server");return l}}class u{constructor(e,t){this.autoScrollEnabled=!0,this.lastCreatedCellIndex=-1,this.notebook=e,this.sessionContext=t}setAutoScroll(e){this.autoScrollEnabled=e}scrollToCell(e){if(!this.autoScrollEnabled)return;const t=this.notebook.content.widgets[e];t&&t.node.scrollIntoView({behavior:"smooth",block:"center"})}async executeTool(e,t){let n;switch(console.log("[ToolExecutor] executeTool called:",JSON.stringify(e,null,2),"stepNumber:",t),e.tool){case"jupyter_cell":console.log("[ToolExecutor] Executing jupyter_cell tool"),n=await this.executeJupyterCell(e.parameters,t);break;case"markdown":console.log("[ToolExecutor] Executing markdown tool"),n=await this.executeMarkdown(e.parameters,t);break;case"final_answer":console.log("[ToolExecutor] Executing final_answer tool"),n=await this.executeFinalAnswer(e.parameters);break;default:n={success:!1,error:`Unknown tool: ${e.tool}`}}return console.log("[ToolExecutor] Tool result:",JSON.stringify(n,null,2)),n}async executeJupyterCell(e,t){console.log("[ToolExecutor] executeJupyterCell params:",e);const n=this.notebook.content;let o;console.log("[ToolExecutor] notebook content available:",!!n),console.log("[ToolExecutor] notebook model available:",!!n?.model);let a=!1,s=e.code;void 0!==t&&(s=`# [Step ${t}]\n${e.code}`);try{void 0!==e.cellIndex?(console.log("[ToolExecutor] Modifying existing cell at index:",e.cellIndex),o=e.cellIndex,this.updateCellContent(o,s),a=!0):(console.log("[ToolExecutor] Creating new code cell"),o=await this.createCodeCell(s,e.insertAfter),console.log("[ToolExecutor] Created cell at index:",o)),this.scrollToCell(o),console.log("[ToolExecutor] Executing cell at index:",o);const t=await this.executeCellAndCapture(o);return console.log("[ToolExecutor] Cell execution result:",t.status),{success:"ok"===t.status,output:t.result||t.stdout,error:t.error?.evalue,traceback:t.error?.traceback,cellIndex:o,wasModified:a}}catch(e){return console.error("[ToolExecutor] executeJupyterCell error:",e),{success:!1,error:e.message||"Failed to execute jupyter_cell",cellIndex:o,wasModified:a}}}async executeMarkdown(e,t){try{let n,o=!1,a=e.content;return void 0!==t&&(a=`**[Step ${t}]**\n\n${e.content}`),void 0!==e.cellIndex?(n=e.cellIndex,this.updateCellContent(n,a),o=!0):n=await this.createMarkdownCell(a),this.scrollToCell(n),{success:!0,cellIndex:n,wasModified:o}}catch(e){return{success:!1,error:e.message||"Failed to execute markdown"}}}async executeFinalAnswer(e){return{success:!0,output:e.answer}}async getVariableValues(e){if(0===e.length)return{};try{const t=`\nimport json\n\ndef _format_value(v):\n    """ë³€ìˆ˜ ê°’ì„ ì ì ˆí•œ í˜•íƒœë¡œ í¬ë§·íŒ…"""\n    try:\n        # 1. DataFrame â†’ HTML table (pandas, modin ë“±)\n        if hasattr(v, 'to_html'):\n            try:\n                html = v.to_html(index=False, max_rows=100)\n                return f"\x3c!--DFHTML--\x3e{html}\x3c!--/DFHTML--\x3e"\n            except:\n                pass\n\n        # 2. Lazy DataFrame (dask) - ìƒ˜í”Œë§Œ ë³€í™˜\n        if hasattr(v, 'compute'):\n            try:\n                sample = v.head(100).compute()\n                if hasattr(sample, 'to_html'):\n                    html = sample.to_html(index=False)\n                    return f"\x3c!--DFHTML--\x3e{html}\x3c!--/DFHTML--\x3e"\n            except:\n                pass\n\n        # 3. Spark DataFrame\n        if hasattr(v, 'toPandas'):\n            try:\n                sample = v.limit(100).toPandas()\n                if hasattr(sample, 'to_html'):\n                    html = sample.to_html(index=False)\n                    return f"\x3c!--DFHTML--\x3e{html}\x3c!--/DFHTML--\x3e"\n            except:\n                pass\n\n        # 4. DataFrame with to_pandas conversion (polars, cudf, vaex ë“±)\n        for method in ['to_pandas', 'to_pandas_df']:\n            if hasattr(v, method):\n                try:\n                    converted = getattr(v, method)()\n                    if hasattr(converted, 'to_html'):\n                        html = converted.to_html(index=False, max_rows=100)\n                        return f"\x3c!--DFHTML--\x3e{html}\x3c!--/DFHTML--\x3e"\n                except:\n                    continue\n\n        # 5. Series - to_string()\n        if hasattr(v, 'to_string'):\n            try:\n                return v.to_string(max_rows=100)\n            except:\n                pass\n\n        # 6. ê¸°ë³¸ str()\n        return str(v)\n    except:\n        return str(v)\n\n# ë³€ìˆ˜ ê°’ ì¶”ì¶œ\nresult = {}\n${e.map(e=>`\nif '${e}' in locals() or '${e}' in globals():\n    val = locals().get('${e}', globals().get('${e}'))\n    result['${e}'] = _format_value(val)\nelse:\n    result['${e}'] = None`).join("")}\n\nprint(json.dumps(result))\n`.trim(),n=this.notebook.content.model;if(!n)throw new Error("Notebook model is not available");const o=n.cells.length;n.sharedModel.insertCell(o,{cell_type:"code",source:t});const a=await this.executeCellAndCapture(o);if(n.sharedModel.deleteCell(o),a.stdout){const e=JSON.parse(a.stdout.trim()),t={};for(const[n,o]of Object.entries(e))null!==o&&(t[n]=o);return t}return{}}catch(e){return console.error("[ToolExecutor] Failed to extract variable values:",e),{}}}resetSequentialExecution(){const e=this.notebook.content.model;this.lastCreatedCellIndex=e?e.cells.length-1:-1,console.log("[ToolExecutor] Reset sequential execution, lastCreatedCellIndex:",this.lastCreatedCellIndex)}async createCodeCell(e,t){const n=this.notebook.content,o=n.model;if(!o)throw new Error("Notebook model not available");const a=n.activeCellIndex,s=a===o.cells.length-1;if(a>=0&&void 0===t&&s){const t=o.cells.get(a);if(t&&"code"===t.type&&""===t.sharedModel.getSource().trim())return t.sharedModel.setSource(e),this.lastCreatedCellIndex=a,a}const r=o.cells.length;return o.sharedModel.insertCell(r,{cell_type:"code",source:e,metadata:{}}),this.lastCreatedCellIndex=r,n.activeCellIndex=r,console.log("[ToolExecutor] Created cell at index:",r,"(always at end)"),r}async createMarkdownCell(e,t){const n=this.notebook.content,o=n.model;if(!o)throw new Error("Notebook model not available");const a=o.cells.length;o.sharedModel.insertCell(a,{cell_type:"markdown",source:e,metadata:{}});const s=n.widgets[a];return s&&void 0!==s.rendered&&(s.rendered=!0),this.lastCreatedCellIndex=a,n.activeCellIndex=a,console.log("[ToolExecutor] Created markdown cell at index:",a,"(always at end)"),a}updateCellContent(e,t){const n=this.notebook.content.widgets[e];if(!n||!n.model?.sharedModel)throw new Error(`Cell at index ${e} not found or model not available`);n.model.sharedModel.setSource(t)}async executeCellAndCapture(e){const t=this.notebook.content,n=t.widgets[e];if(!n)throw new Error(`Cell at index ${e} not found`);const o=Date.now();t.activeCellIndex=e;const a=await s.NotebookActions.run(t,this.sessionContext);console.log("[ToolExecutor] NotebookActions.run() success:",a),await new Promise(e=>setTimeout(e,300));const r=Date.now()-o;let l,i="",c="",d=null;const p=n.model?.outputs;if(console.log("[ToolExecutor] Cell outputs count:",p?.length??0,"| runSuccess:",a),p&&p.length>0)for(let e=0;e<p.length;e++){const t=p.get(e);if(console.log(`[ToolExecutor] Output ${e} type:`,t.type),"stream"===t.type){const e=t;"stdout"===e.name?i+=e.text||"":"stderr"===e.name&&(c+=e.text||"")}else if("execute_result"===t.type||"display_data"===t.type){const e=t.data;d||(d=e)}else if("error"===t.type){const e=t;console.log("[ToolExecutor] Error output detected:",JSON.stringify(e)),(e.ename||e.evalue)&&(l={ename:e.ename,evalue:e.evalue,traceback:e.traceback})}}const u=l||!a?"error":"ok";return console.log("[ToolExecutor] Final status:",u),console.log("[ToolExecutor] - runSuccess:",a),console.log("[ToolExecutor] - error detected:",!!l),l&&(console.log("[ToolExecutor] - error.ename:",l.ename),console.log("[ToolExecutor] - error.evalue:",l.evalue)),a||l||(console.warn("[ToolExecutor] NotebookActions.run() failed but no error output captured!"),l={ename:"ExecutionError",evalue:"Cell execution failed (NotebookActions.run returned false)",traceback:[]}),{status:u,stdout:i,stderr:c,result:d,error:l,executionTime:r,cellIndex:e}}getCellCount(){return this.notebook.content.model?.cells.length||0}getCellContent(e){const t=this.notebook.content.widgets[e];return t?.model?.sharedModel?.getSource()||""}getCellOutput(e){const t=this.notebook.content.widgets[e],n=t?.model?.outputs;if(!t||!n)return"";const o=[];for(let e=0;e<n.length;e++){const t=n.get(e);if("stream"===t.type)o.push(t.text||"");else if("execute_result"===t.type||"display_data"===t.type){const e=t.data;e?.["text/plain"]&&o.push(e["text/plain"])}else if("error"===t.type){const e=t;o.push(`${e.ename}: ${e.evalue}`)}}return o.join("\n")}async interruptKernel(){const e=this.sessionContext.session?.kernel;e&&await e.interrupt()}deleteCell(e){const t=this.notebook.content.model;t&&e>=0&&e<t.cells.length&&t.sharedModel.deleteCell(e)}async executeMultipleCells(e){const t=[];for(const n of e){const e=await this.executeCellAndCapture(n);if(t.push(e),"error"===e.status)break}return t}}const m=[{pattern:/rm\s+-rf\s+[\/~]/,description:"ì¬ê·€ ì‚­ì œ ëª…ë ¹ (rm -rf)",severity:"critical",category:"system"},{pattern:/os\.system\s*\(/,description:"ì‹œìŠ¤í…œ ëª…ë ¹ ì‹¤í–‰ (os.system)",severity:"critical",category:"system"},{pattern:/subprocess\.(run|call|Popen|check_output)\s*\(/,description:"ì„œë¸Œí”„ë¡œì„¸ìŠ¤ ì‹¤í–‰ (subprocess)",severity:"warning",category:"system"},{pattern:/os\.exec\w*\s*\(/,description:"OS exec ëª…ë ¹ ì‹¤í–‰",severity:"critical",category:"system"},{pattern:/\beval\s*\(/,description:"ë™ì  ì½”ë“œ ì‹¤í–‰ (eval)",severity:"critical",category:"security"},{pattern:/\bexec\s*\(/,description:"ë™ì  ì½”ë“œ ì‹¤í–‰ (exec)",severity:"critical",category:"security"},{pattern:/__import__\s*\(/,description:"ë™ì  ëª¨ë“ˆ ì„í¬íŠ¸ (__import__)",severity:"warning",category:"security"},{pattern:/compile\s*\([^)]*exec/,description:"ë™ì  ì½”ë“œ ì»´íŒŒì¼ (compile)",severity:"critical",category:"security"},{pattern:/open\s*\([^)]*,\s*['"]w/,description:"íŒŒì¼ ì“°ê¸° ëª¨ë“œ ì—´ê¸°",severity:"warning",category:"file"},{pattern:/shutil\.(rmtree|move|copy)/,description:"íŒŒì¼/ë””ë ‰í† ë¦¬ ì¡°ì‘ (shutil)",severity:"warning",category:"file"},{pattern:/os\.(remove|unlink|rmdir|makedirs|rename)/,description:"íŒŒì¼ ì‹œìŠ¤í…œ ë³€ê²½ (os)",severity:"warning",category:"file"},{pattern:/pathlib\.Path[^)]*\.(unlink|rmdir|write)/,description:"íŒŒì¼ ì‹œìŠ¤í…œ ë³€ê²½ (pathlib)",severity:"warning",category:"file"},{pattern:/requests\.(get|post|put|delete|patch)\s*\([^)]*\)/,description:"HTTP ìš”ì²­ (requests)",severity:"info",category:"network"},{pattern:/urllib\.(request|urlopen)/,description:"URL ìš”ì²­ (urllib)",severity:"info",category:"network"},{pattern:/socket\./,description:"ì†Œì¼“ í†µì‹  (socket)",severity:"warning",category:"network"},{pattern:/while\s+True\s*:/,description:"ë¬´í•œ ë£¨í”„ (while True)",severity:"warning",category:"loop"},{pattern:/while\s+1\s*:/,description:"ë¬´í•œ ë£¨í”„ (while 1)",severity:"warning",category:"loop"},{pattern:/for\s+\w+\s+in\s+iter\s*\(\s*int\s*,/,description:"ë¬´í•œ ë°˜ë³µì (iter(int, ...))",severity:"warning",category:"loop"},{pattern:/os\.environ\s*\[/,description:"í™˜ê²½ ë³€ìˆ˜ ì ‘ê·¼",severity:"info",category:"security"},{pattern:/(password|secret|api_key|token)\s*=\s*['"][^'"]+['"]/i,description:"í•˜ë“œì½”ë”©ëœ ë¯¼ê° ì •ë³´",severity:"warning",category:"security"},{pattern:/import\s+pickle|from\s+pickle\s+import/,description:"Pickle ëª¨ë“ˆ (ì—­ì§ë ¬í™” ì·¨ì•½ì )",severity:"info",category:"security"},{pattern:/import\s+ctypes|from\s+ctypes\s+import/,description:"ctypes ëª¨ë“ˆ (ì €ìˆ˜ì¤€ ë©”ëª¨ë¦¬ ì ‘ê·¼)",severity:"warning",category:"security"}];class g{constructor(e){this.config={enableSafetyCheck:!0,blockDangerousPatterns:!1,requireConfirmation:!0,maxExecutionTime:30,...e}}checkCodeSafety(e){if(!this.config.enableSafetyCheck)return{safe:!0,warnings:[]};const t=[],n=[];for(const o of m)if(o.pattern.test(e)){const e=`[${o.severity.toUpperCase()}] ${o.description}`;"critical"===o.severity&&this.config.blockDangerousPatterns?n.push(e):t.push(e)}return{safe:0===n.length,warnings:t,blockedPatterns:n.length>0?n:void 0}}checkMultipleCodeBlocks(e){const t=[],n=[];for(let o=0;o<e.length;o++){const a=this.checkCodeSafety(e[o]);a.warnings.forEach(e=>t.push(`[Block ${o+1}] ${e}`)),a.blockedPatterns&&a.blockedPatterns.forEach(e=>n.push(`[Block ${o+1}] ${e}`))}return{safe:0===n.length,warnings:t,blockedPatterns:n.length>0?n:void 0}}checkInfiniteLoopRisk(e){return m.filter(e=>"loop"===e.category).some(t=>t.pattern.test(e))}checkFileSystemRisk(e){return m.filter(e=>"file"===e.category).some(t=>t.pattern.test(e))}checkNetworkActivity(e){return m.filter(e=>"network"===e.category).some(t=>t.pattern.test(e))}getMaxExecutionTime(){return 1e3*this.config.maxExecutionTime}requiresConfirmation(e){return!!this.config.requireConfirmation&&(e.warnings.length>0||(e.blockedPatterns?.length||0)>0)}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}formatWarningsForDisplay(e){if(0===e.warnings.length&&!e.blockedPatterns?.length)return"";const t=[];return e.blockedPatterns&&e.blockedPatterns.length>0&&(t.push("â›” ì°¨ë‹¨ëœ íŒ¨í„´:"),e.blockedPatterns.forEach(e=>t.push(`  â€¢ ${e}`))),e.warnings.length>0&&(t.push("âš ï¸ ê²½ê³ :"),e.warnings.forEach(e=>t.push(`  â€¢ ${e}`))),t.join("\n")}}const h={instant:0,fast:800,normal:1500,slow:3e3,"step-by-step":-1},f={maxRetriesPerStep:3,executionTimeout:3e4,enableSafetyCheck:!0,showDetailedProgress:!0,executionSpeed:"normal",stepDelay:1500,autoScrollToCell:!0,highlightCurrentCell:!0};class C{constructor(e,t,n,o){this.abortController=null,this.isRunning=!1,this.stepByStepResolver=null,this.isPaused=!1,this.enablePreValidation=!0,this.enableReflection=!0,this.executedStepVariables=new Set,this.executedStepVariableValues={},this.notebook=e,this.apiService=n||new p,this.toolExecutor=new u(e,t),this.safetyChecker=new g({enableSafetyCheck:o?.enableSafetyCheck??!0,maxExecutionTime:(o?.executionTimeout??3e4)/1e3}),this.config={...f,...o},console.log("[Orchestrator] Initialized with config:",{executionSpeed:this.config.executionSpeed,stepDelay:this.config.stepDelay}),this.toolExecutor.setAutoScroll(this.config.autoScrollToCell)}async executeTask(e,t,n){if(this.isRunning)return{success:!1,plan:null,executedSteps:[],createdCells:[],modifiedCells:[],error:"Auto-Agentê°€ ì´ë¯¸ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤",totalAttempts:0};this.isRunning=!0,this.abortController=new AbortController,this.executedStepVariables.clear(),this.executedStepVariableValues={};const o=[],a=[],s=[],r=Date.now();try{n({phase:"planning",message:"ì‘ì—… ê³„íš ìˆ˜ë¦½ ì¤‘..."});const l=this.extractNotebookContext(t),i=(await this.apiService.generateExecutionPlan({request:e,notebookContext:l,availableTools:["jupyter_cell","markdown","final_answer"]})).plan;n({phase:"planned",plan:i,message:`${i.totalSteps}ë‹¨ê³„ ì‹¤í–‰ ê³„íš ìƒì„±ë¨`}),console.log("[Orchestrator] Starting execution phase with",i.steps.length,"steps");let c=i,d=0,p=0;const u=3;for(;d<c.steps.length;){const l=c.steps[d];if(console.log("[Orchestrator] Executing step",l.stepNumber,":",l.description),this.abortController.signal.aborted)return{success:!1,plan:c,executedSteps:s,createdCells:o,modifiedCells:a,error:"ì‚¬ìš©ìì— ì˜í•´ ì·¨ì†Œë¨",totalAttempts:this.countTotalAttempts(s),executionTime:Date.now()-r};n({phase:"executing",currentStep:l.stepNumber,totalSteps:c.totalSteps,description:l.description});const i=await this.executeStepWithRetry(l,t,n);if(i.toolResults.forEach(e=>{void 0!==e.cellIndex&&(e.wasModified?a.push(e.cellIndex):o.push(e.cellIndex),this.scrollToAndHighlightCell(e.cellIndex))}),!i.success){if(console.log("[Orchestrator] Step failed, attempting adaptive replanning"),p>=u)return n({phase:"failed",message:`ìµœëŒ€ ì¬ê³„íš ì‹œë„ íšŸìˆ˜(${u})ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.`}),{success:!1,plan:c,executedSteps:s,createdCells:o,modifiedCells:a,error:`Step ${l.stepNumber} ì‹¤íŒ¨: ${i.error}`,totalAttempts:this.countTotalAttempts(s),executionTime:Date.now()-r};n({phase:"replanning",message:"ê³„íš ìˆ˜ì • ì¤‘...",currentStep:l.stepNumber});const t={type:"runtime",message:i.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",traceback:i.toolResults.find(e=>e.traceback)?.traceback||[],recoverable:!0},m=i.toolResults.map(e=>e.output).filter(Boolean).join("\n");try{const o=await this.apiService.replanExecution({originalRequest:e,executedSteps:s.map(e=>c.steps.find(t=>t.stepNumber===e.stepNumber)).filter(Boolean),failedStep:l,error:t,executionOutput:m});console.log("[Orchestrator] Replan decision:",o.decision),console.log("[Orchestrator] Replan reasoning:",o.reasoning);const a=i.toolResults.find(e=>void 0!==e.cellIndex)?.cellIndex;console.log("[Orchestrator] Failed cell index for reuse:",a),c=this.applyReplanChanges(c,d,o,a),n({phase:"planned",plan:c,message:`ê³„íš ìˆ˜ì •ë¨ (${this.getReplanDecisionLabel(o.decision)})`,currentStep:l.stepNumber,totalSteps:c.totalSteps}),p++;continue}catch(e){return console.error("[Orchestrator] Replan failed:",e),n({phase:"failed",message:`Step ${l.stepNumber} ì‹¤íŒ¨ (ì¬ê³„íš ì‹¤íŒ¨): ${i.error}`}),{success:!1,plan:c,executedSteps:s,createdCells:o,modifiedCells:a,error:`Step ${l.stepNumber} ì‹¤íŒ¨: ${i.error}`,totalAttempts:this.countTotalAttempts(s),executionTime:Date.now()-r}}}if(s.push(i),p=0,this.trackVariablesFromStep(l),this.enableReflection&&i.toolResults.length>0){n({phase:"reflecting",reflectionStatus:"analyzing",currentStep:l.stepNumber,message:"ì‹¤í–‰ ê²°ê³¼ ë¶„ì„ ì¤‘..."});const e=c.steps.slice(d+1),t=await this.performReflection(l,i.toolResults,e);if(t){const{shouldContinue:e,action:o,reason:a}=this.shouldContinueAfterReflection(t);console.log("[Orchestrator] Reflection decision:",{shouldContinue:e,action:o,reason:a}),t.evaluation.checkpoint_passed?n({phase:"reflecting",reflectionStatus:"passed",currentStep:l.stepNumber,message:"ê²€ì¦ í†µê³¼"}):n({phase:"reflecting",reflectionStatus:"adjusting",currentStep:l.stepNumber,message:`ì¡°ì • ê¶Œê³ : ${a}`}),e||("replan"===o?console.log("[Orchestrator] Reflection recommends replan, triggering adaptive replanning"):"retry"===o&&console.log("[Orchestrator] Reflection recommends retry - but step succeeded, continuing"))}}if(await this.applyStepDelay(),i.isFinalAnswer)return n({phase:"completed",message:i.finalAnswer||"ì‘ì—… ì™„ë£Œ"}),{success:!0,plan:c,executedSteps:s,createdCells:o,modifiedCells:a,finalAnswer:i.finalAnswer,totalAttempts:this.countTotalAttempts(s),executionTime:Date.now()-r};d++}return n({phase:"completed",message:"ëª¨ë“  ë‹¨ê³„ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ"}),{success:!0,plan:i,executedSteps:s,createdCells:o,modifiedCells:a,totalAttempts:this.countTotalAttempts(s),executionTime:Date.now()-r}}catch(e){return n({phase:"failed",message:e.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ"}),{success:!1,plan:null,executedSteps:s,createdCells:o,modifiedCells:a,error:e.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ ë°œìƒ",totalAttempts:this.countTotalAttempts(s),executionTime:Date.now()-r}}finally{this.isRunning=!1,this.abortController=null}}analyzeOutputForFailure(e){if(!e)return{isNegative:!1};const t=[{pattern:/ModuleNotFoundError/i,reason:"ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŒ (íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš”)"},{pattern:/ImportError/i,reason:"import ì—ëŸ¬ (íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš”)"},{pattern:/No module named/i,reason:"ëª¨ë“ˆì´ ì—†ìŒ (íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš”)"},{pattern:/cannot import name/i,reason:"import ì‹¤íŒ¨"},{pattern:/FileNotFoundError|No such file or directory|íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤/i,reason:"íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ"},{pattern:/NameError:\s*name\s*'([^']+)'\s*is not defined/i,reason:"ë³€ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ"},{pattern:/KeyError/i,reason:"í‚¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"},{pattern:/IndexError/i,reason:"ì¸ë±ìŠ¤ ë²”ìœ„ ì´ˆê³¼"},{pattern:/TypeError/i,reason:"íƒ€ì… ì˜¤ë¥˜"},{pattern:/ValueError/i,reason:"ê°’ ì˜¤ë¥˜"},{pattern:/AttributeError/i,reason:"ì†ì„± ì˜¤ë¥˜"},{pattern:/ì‹¤íŒ¨|failed|Fail/i,reason:"ëª…ì‹œì  ì˜¤ë¥˜ ë©”ì‹œì§€ ê°ì§€"},{pattern:/not found|cannot find|ì°¾ì„ ìˆ˜ ì—†/i,reason:"ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"}];for(const{pattern:n,reason:o}of t)if(n.test(e))return console.log("[Orchestrator] Negative output detected:",o),{isNegative:!0,reason:o};return{isNegative:!1}}async executeStepWithRetry(e,t,n){console.log("[Orchestrator] executeStep called for step:",e.stepNumber),console.log("[Orchestrator] Step toolCalls:",JSON.stringify(e.toolCalls,null,2));const o=[];try{console.log("[Orchestrator] Processing",e.toolCalls.length,"tool calls");for(const t of e.toolCalls){if(console.log("[Orchestrator] Processing toolCall:",t.tool),this.abortController?.signal.aborted)return{success:!1,stepNumber:e.stepNumber,toolResults:o,attempts:1,error:"ì‚¬ìš©ìì— ì˜í•´ ì·¨ì†Œë¨"};if(n({phase:"tool_calling",tool:t.tool,attempt:1,currentStep:e.stepNumber}),"jupyter_cell"===t.tool){const a=t.parameters,s=this.safetyChecker.checkCodeSafety(a.code);if(!s.safe)return{success:!1,stepNumber:e.stepNumber,toolResults:o,attempts:1,error:`ì•ˆì „ì„± ê²€ì‚¬ ì‹¤íŒ¨: ${s.blockedPatterns?.join(", ")}`};n({phase:"validating",validationStatus:"checking",currentStep:e.stepNumber,message:"ì½”ë“œ í’ˆì§ˆ ê²€ì¦ ì¤‘..."});const r=await this.validateCodeBeforeExecution(a.code);if(r){if(r.hasErrors)return console.log(""),console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"),console.log("â•‘  ğŸ”´ [Orchestrator] PRE-VALIDATION FAILED                     â•‘"),console.log("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"),console.log(`â•‘  Step: ${e.stepNumber} - ${e.description?.substring(0,45)||"N/A"}...`),console.log(`â•‘  Summary: ${r.summary||"No summary"}`),console.log("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"),console.log("â•‘  Code:"),console.log("â•‘  "+(a.code||"").split("\n").join("\nâ•‘  ")),console.log("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"),console.log("â•‘  Issues:"),r.issues&&r.issues.length>0?r.issues.forEach((e,t)=>{console.log(`â•‘    ${t+1}. [${e.severity||"unknown"}] ${e.category||"unknown"}: ${e.message||"no message"}`),e.line&&console.log(`â•‘       Line ${e.line}${e.column?`:${e.column}`:""}`),e.code_snippet&&console.log(`â•‘       Snippet: ${e.code_snippet}`)}):console.log("â•‘    (No issues array available)"),r.dependencies&&(console.log("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"),console.log("â•‘  Dependencies:",JSON.stringify(r.dependencies))),console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log(""),n({phase:"validating",validationStatus:"failed",currentStep:e.stepNumber,message:`ê²€ì¦ ì‹¤íŒ¨: ${r.summary}`}),{success:!1,stepNumber:e.stepNumber,toolResults:o,attempts:1,error:`ì‚¬ì „ ê²€ì¦ ì˜¤ë¥˜: ${r.summary}`};r.hasWarnings?(console.log("[Orchestrator] âš ï¸ Pre-validation warnings:",r.issues.map(e=>e.message).join("; ")),n({phase:"validating",validationStatus:"warning",currentStep:e.stepNumber,message:`ê²½ê³  ê°ì§€: ${r.issues.length}ê±´ (ì‹¤í–‰ ê³„ì†)`})):(console.log("[Orchestrator] âœ… Pre-validation passed for step",e.stepNumber),n({phase:"validating",validationStatus:"passed",currentStep:e.stepNumber,message:"ì½”ë“œ ê²€ì¦ í†µê³¼"}))}}console.log("[Orchestrator] Calling toolExecutor.executeTool for:",t.tool,"step:",e.stepNumber);const a=await this.executeWithTimeout(()=>this.toolExecutor.executeTool(t,e.stepNumber),this.config.executionTimeout);if(console.log("[Orchestrator] Tool execution result:",JSON.stringify(a)),o.push(a),!a.success&&"jupyter_cell"===t.tool){const t=a.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";return console.log("[Orchestrator] jupyter_cell execution failed:",t.substring(0,100)),{success:!1,stepNumber:e.stepNumber,toolResults:o,attempts:1,error:t}}if("final_answer"===t.tool){let t=a.output;try{const e=/\{(\w+)\}/g,n=[...t.matchAll(e)],o=[...new Set(n.map(e=>e[1]))];if(o.length>0){console.log("[Orchestrator] Extracting variable values for finalAnswer:",o);const n=await this.toolExecutor.getVariableValues(o);console.log("[Orchestrator] Extracted variable values:",n),t=t.replace(e,(e,t)=>n[t]??e),console.log("[Orchestrator] Final answer after substitution:",t)}}catch(e){console.error("[Orchestrator] Failed to substitute variables in finalAnswer:",e)}return{success:!0,stepNumber:e.stepNumber,toolResults:o,attempts:1,isFinalAnswer:!0,finalAnswer:t}}}if(o.length>0&&o.every(e=>e.success)){const t=o.map(e=>{const t=e.output;if(!t)return"";if("string"==typeof t)return t;if("object"==typeof t&&null!==t){if("text/plain"in t){const e=t["text/plain"];return"string"==typeof e?e:String(e||"")}try{return JSON.stringify(t)}catch{return"[object]"}}try{return String(t)}catch{return"[unknown]"}}).join("\n"),n=this.analyzeOutputForFailure(t);return n.isNegative?(console.log("[Orchestrator] Negative output detected:",n.reason),{success:!1,stepNumber:e.stepNumber,toolResults:o,attempts:1,error:n.reason||"ì¶œë ¥ ê²°ê³¼ì—ì„œ ë¬¸ì œ ê°ì§€"}):{success:!0,stepNumber:e.stepNumber,toolResults:o,attempts:1}}return{success:!1,stepNumber:e.stepNumber,toolResults:o,attempts:1,error:"ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ ì—†ìŒ"}}catch(t){const n=t.message?.includes("timeout");return n&&await this.toolExecutor.interruptKernel(),{success:!1,stepNumber:e.stepNumber,toolResults:o,attempts:1,error:t.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}extractNotebookContext(e){const t=e.content.model?.cells,n=t?.length||0,o=[];if(t)for(let e=Math.max(0,n-3);e<n;e++){const n=t.get(e);o.push({index:e,type:n.type,source:n.sharedModel.getSource().slice(0,500),output:this.toolExecutor.getCellOutput(e).slice(0,300)})}return{cellCount:n,recentCells:o,importedLibraries:this.detectImportedLibraries(e),definedVariables:this.detectDefinedVariables(e),notebookPath:e.context?.path}}detectImportedLibraries(e){const t=new Set,n=e.content.model?.cells;if(!n)return[];for(let e=0;e<n.length;e++){const o=n.get(e);if("code"===o.type){const e=o.sharedModel.getSource(),n=e.matchAll(/^import\s+(\w+)/gm);for(const e of n)t.add(e[1]);const a=e.matchAll(/^from\s+(\w+)/gm);for(const e of a)t.add(e[1])}}return Array.from(t)}detectDefinedVariables(e){const t=new Set,n=e.content.model?.cells;if(!n)return[];for(let e=0;e<n.length;e++){const o=n.get(e);if("code"===o.type){const e=o.sharedModel.getSource(),n=e.matchAll(/^[ \t]*(\w+)\s*=/gm);for(const e of n){const n=e[1];if(!["if","for","while","def","class","import","from","elif","return","yield","assert","raise","del","pass","break","continue","global","nonlocal","lambda","with","as","try","except","finally"].includes(n)){const o=e[0];o.includes("==")||o.includes("!=")||o.includes("<=")||o.includes(">=")||t.add(n)}}const a=e.matchAll(/^[ \t]*(\w+(?:\s*,\s*\w+)+)\s*=/gm);for(const e of a){const n=e[1].split(",").map(e=>e.trim());for(const e of n)e&&/^\w+$/.test(e)&&t.add(e)}const s=e.matchAll(/^[ \t]*for\s+(\w+(?:\s*,\s*\w+)*)\s+in\s+/gm);for(const e of s){const n=e[1].split(",").map(e=>e.trim());for(const e of n)e&&/^\w+$/.test(e)&&t.add(e)}const r=e.matchAll(/^[ \t]*with\s+.*\s+as\s+(\w+)/gm);for(const e of r)t.add(e[1]);const l=e.matchAll(/^[ \t]*except\s+.*\s+as\s+(\w+)/gm);for(const e of l)t.add(e[1])}}return Array.from(t)}extractVariablesFromCode(e){const t=new Set,n=["if","for","while","def","class","import","from","elif","return","yield","assert","raise","del","pass","break","continue","global","nonlocal","lambda","with","as","try","except","finally"],o=e.matchAll(/^[ \t]*(\w+)\s*=/gm);for(const e of o){const o=e[1];if(!n.includes(o)){const n=e[0];n.includes("==")||n.includes("!=")||n.includes("<=")||n.includes(">=")||t.add(o)}}const a=e.matchAll(/^[ \t]*(\w+(?:\s*,\s*\w+)+)\s*=/gm);for(const e of a){const n=e[1].split(",").map(e=>e.trim());for(const e of n)e&&/^\w+$/.test(e)&&t.add(e)}const s=e.matchAll(/^[ \t]*for\s+(\w+(?:\s*,\s*\w+)*)\s+in\s+/gm);for(const e of s){const n=e[1].split(",").map(e=>e.trim());for(const e of n)e&&/^\w+$/.test(e)&&t.add(e)}const r=e.matchAll(/^[ \t]*with\s+.*\s+as\s+(\w+)/gm);for(const e of r)t.add(e[1]);const l=e.matchAll(/^[ \t]*except\s+.*\s+as\s+(\w+)/gm);for(const e of l)t.add(e[1]);return Array.from(t)}trackVariablesFromStep(e){for(const t of e.toolCalls)if("jupyter_cell"===t.tool){const n=t.parameters,o=this.extractVariablesFromCode(n.code);o.forEach(e=>this.executedStepVariables.add(e)),console.log("[Orchestrator] Tracked variables from step",e.stepNumber,":",o)}}applyReplanChanges(e,t,n,o){const{decision:a,changes:s}=n,r=[...e.steps],l=r[t];switch(console.log("[Orchestrator] Applying replan changes:",a,"(always append new cells)"),a){case"refine":if(s.refined_code){const e=l.toolCalls.map(e=>"jupyter_cell"===e.tool?{...e,parameters:{...e.parameters,code:s.refined_code}}:e);e.forEach(e=>{"jupyter_cell"===e.tool&&e.parameters&&delete e.parameters.cellIndex}),r[t]={...l,toolCalls:e}}break;case"insert_steps":if(s.new_steps&&s.new_steps.length>0){const e=s.new_steps.map((e,t)=>({...e,stepNumber:l.stepNumber+.1*t,isNew:!0}));r.splice(t,0,...e),r.forEach((e,t)=>{e.stepNumber=t+1})}break;case"replace_step":if(s.replacement){const e={...s.replacement,stepNumber:l.stepNumber,toolCalls:s.replacement.toolCalls||[]};e.toolCalls.forEach(e=>{"jupyter_cell"===e.tool&&e.parameters&&delete e.parameters.cellIndex}),r[t]=e}break;case"replan_remaining":if(s.new_plan&&s.new_plan.length>0){const e=r.slice(0,t),n=s.new_plan.map((e,n)=>({...e,stepNumber:t+n+1,isNew:!0}));n.some(e=>e.toolCalls?.some(e=>"final_answer"===e.tool))||console.warn("[Orchestrator] replan_remaining: new_plan does not include final_answer"),r.length=0,r.push(...e,...n)}}return{...e,steps:r,totalSteps:r.length}}countTotalAttempts(e){return e.reduce((e,t)=>e+t.attempts,0)}async executeWithTimeout(e,t){return new Promise((n,o)=>{const a=setTimeout(()=>{o(new Error(`ì‹¤í–‰ íƒ€ì„ì•„ì›ƒ (${t}ms)`))},t);e().then(e=>{clearTimeout(a),n(e)}).catch(e=>{clearTimeout(a),o(e)})})}delay(e){return new Promise(t=>setTimeout(t,e))}cancel(){this.abortController&&this.abortController.abort()}getIsRunning(){return this.isRunning}updateConfig(e){this.config={...this.config,...e},this.safetyChecker.updateConfig({enableSafetyCheck:this.config.enableSafetyCheck,maxExecutionTime:this.config.executionTimeout/1e3}),void 0!==e.autoScrollToCell&&this.toolExecutor.setAutoScroll(this.config.autoScrollToCell)}scrollToAndHighlightCell(e){if(!this.config.autoScrollToCell&&!this.config.highlightCurrentCell)return;const t=this.notebook.content,n=t.widgets[e];n&&(this.config.autoScrollToCell&&n.node.scrollIntoView({behavior:"smooth",block:"center"}),this.config.highlightCurrentCell&&(t.widgets.forEach(e=>{e.node.classList.remove("aa-cell-executing")}),n.node.classList.add("aa-cell-executing"),setTimeout(()=>{n.node.classList.remove("aa-cell-executing")},this.getEffectiveDelay()+500)))}getEffectiveDelay(){const e=h[this.config.executionSpeed];return void 0!==e?e:this.config.stepDelay||0}async applyStepDelay(){const e=this.getEffectiveDelay();if(console.log(`[Orchestrator] applyStepDelay called: speed=${this.config.executionSpeed}, delay=${e}ms`),"step-by-step"===this.config.executionSpeed||e<0)return this.isPaused=!0,await new Promise(e=>{this.stepByStepResolver=e}),this.isPaused=!1,void(this.stepByStepResolver=null);e>0&&await this.delay(e)}proceedToNextStep(){this.stepByStepResolver&&this.stepByStepResolver()}getIsPaused(){return this.isPaused}getExecutionSpeed(){return this.config.executionSpeed}async validateCodeBeforeExecution(e){if(!this.enablePreValidation)return null;try{console.log("[Orchestrator] Pre-validation: Checking code quality");const t=this.extractNotebookContext(this.notebook),n=new Set([...t.definedVariables,...this.executedStepVariables]);t.definedVariables=Array.from(n),console.log("[Orchestrator] Validation context - tracked vars:",Array.from(this.executedStepVariables));const o=await this.apiService.validateCode({code:e,notebookContext:t});return console.log("[Orchestrator] Validation result:",{valid:o.valid,hasErrors:o.hasErrors,issueCount:o.issues.length}),o}catch(e){return console.warn("[Orchestrator] Pre-validation failed:",e.message),null}}async performReflection(e,t,n){if(!this.enableReflection)return null;try{const o=t.find(e=>void 0!==e.cellIndex);if(!o)return null;const a=e.toolCalls.find(e=>"jupyter_cell"===e.tool),s=a?a.parameters.code:"",r=e.checkpoint,l=(()=>{const e=o.output;if(!e)return"";if("string"==typeof e)return e;if("object"==typeof e&&null!==e){if("text/plain"in e){const t=e["text/plain"];return"string"==typeof t?t:String(t||"")}try{return JSON.stringify(e)}catch{return"[object]"}}try{return String(e)}catch{return"[unknown]"}})(),i=this.analyzeOutputForFailure(l);let c=o.error,d=o.success?"ok":"error";i.isNegative&&(console.log("[Orchestrator] Reflection: Local output analysis detected issue:",i.reason),c=c?`${c}; ì¶œë ¥ ë¶„ì„: ${i.reason}`:`ì¶œë ¥ ë¶„ì„: ${i.reason}`,o.success&&i.isNegative&&(d="warning")),console.log("[Orchestrator] Performing reflection for step",e.stepNumber);const p=await this.apiService.reflectOnExecution({stepNumber:e.stepNumber,stepDescription:e.description,executedCode:s,executionStatus:d,executionOutput:l,errorMessage:c,expectedOutcome:r?.expectedOutcome,validationCriteria:r?.validationCriteria,remainingSteps:n});return console.log("[Orchestrator] Reflection result:",{checkpointPassed:p.reflection.evaluation.checkpoint_passed,confidenceScore:p.reflection.evaluation.confidence_score,action:p.reflection.recommendations.action}),p.reflection}catch(e){return console.warn("[Orchestrator] Reflection failed:",e.message),null}}shouldContinueAfterReflection(e){if(!e)return{shouldContinue:!0,action:"continue",reason:"No reflection data"};const{evaluation:t,recommendations:n}=e;if(t.checkpoint_passed&&t.confidence_score>=.7)return{shouldContinue:!0,action:"continue",reason:"Checkpoint passed with high confidence"};switch(n.action){case"continue":return{shouldContinue:!0,action:"continue",reason:n.reasoning};case"adjust":return{shouldContinue:!0,action:"adjust",reason:n.reasoning};case"retry":return{shouldContinue:!1,action:"retry",reason:n.reasoning};case"replan":return{shouldContinue:!1,action:"replan",reason:n.reasoning};default:return{shouldContinue:!0,action:"continue",reason:"Default continue"}}}async attemptAutoFix(e,t){const n=t.issues.filter(e=>"unused_import"===e.category||"unused_variable"===e.category);return t.hasErrors?null:!t.hasErrors&&n.length>0?(console.log("[Orchestrator] Code has warnings but is executable"),e):null}setValidationEnabled(e){this.enablePreValidation=e,console.log("[Orchestrator] Pre-validation:",e?"enabled":"disabled")}setReflectionEnabled(e){this.enableReflection=e,console.log("[Orchestrator] Reflection:",e?"enabled":"disabled")}getValidationEnabled(){return this.enablePreValidation}getReflectionEnabled(){return this.enableReflection}getReplanDecisionLabel(e){switch(e){case"refine":return"ì½”ë“œ ìˆ˜ì •";case"insert_steps":return"ë‹¨ê³„ ì¶”ê°€";case"replace_step":return"ë‹¨ê³„ êµì²´";case"replan_remaining":return"ë‚¨ì€ ê³„íš ì¬ìˆ˜ë¦½";default:return e}}}function y(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function b(e,t){const n=document.createElement("span");let o=0;for(;o<e.length;){if("`"===e[o]){let t=o+1,a=!1;for(;t<e.length;)if("\\"!==e[t]||a){if("`"===e[t]&&!a)break;a=!1,t++}else a=!0,t++;if(t<e.length&&"`"===e[t]){const a=document.createElement("span");a.style.color="#ce9178",a.textContent=e.substring(o,t+1),n.appendChild(a),o=t+1;continue}}if('"'===e[o]){let t=o+1,a=!1;for(;t<e.length;)if("\\"!==e[t]||a){if('"'===e[t]&&!a)break;a=!1,t++}else a=!0,t++;if(t<e.length&&'"'===e[t]){const a=document.createElement("span");a.style.color="#ce9178",a.textContent=e.substring(o,t+1),n.appendChild(a),o=t+1;continue}const s=document.createElement("span");s.style.color="#ce9178",s.textContent=e.substring(o),n.appendChild(s);break}if("'"===e[o]){let t=o+1,a=!1;for(;t<e.length;)if("\\"!==e[t]||a){if("'"===e[t]&&!a)break;a=!1,t++}else a=!0,t++;if(t<e.length&&"'"===e[t]){const a=document.createElement("span");a.style.color="#ce9178",a.textContent=e.substring(o,t+1),n.appendChild(a),o=t+1;continue}const s=document.createElement("span");s.style.color="#ce9178",s.textContent=e.substring(o),n.appendChild(s);break}if(/\d/.test(e[o])){let t=o;for(;t<e.length&&/[\d.]/.test(e[t]);)t++;const a=document.createElement("span");a.style.color="#b5cea8",a.textContent=e.substring(o,t),n.appendChild(a),o=t;continue}if(/[a-zA-Z_$]/.test(e[o])){let a=o;for(;a<e.length&&/[a-zA-Z0-9_$]/.test(e[a]);)a++;const s=e.substring(o,a);if(t.includes(s)){const e=document.createElement("span");e.style.color="#569cd6",e.style.fontWeight="500",e.textContent=s,n.appendChild(e)}else{const e=document.createTextNode(s);n.appendChild(e)}o=a;continue}const a=document.createTextNode(e[o]);n.appendChild(a),o++}return n.innerHTML}function x(e){let t=y(e);return t=t.replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>'),t=t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*([^*]+)\*/g,"<em>$1</em>"),t}function v(e){const t=e.trim().split("\n");if(t.length<2)return y(e);const n=t.findIndex(e=>/^\|?\s*[-:]+[-|\s:]+\s*\|?$/.test(e));if(-1===n||0===n)return y(e);const o=t.slice(0,n),a=t[n],s=t.slice(n+1),r=[];a.split("|").filter(e=>e.trim()).forEach(e=>{const t=e.trim();t.startsWith(":")&&t.endsWith(":")?r.push("center"):t.endsWith(":")?r.push("right"):r.push("left")});let l='<div class="markdown-table-wrapper"><table class="markdown-table">';return l+="<thead>",o.forEach(e=>{l+="<tr>",e.split("|").filter((e,t,n)=>!(0===t&&""===e.trim()||t===n.length-1&&""===e.trim())).forEach((e,t)=>{const n=r[t]||"left";l+=`<th style="text-align: ${n};">${x(e.trim())}</th>`}),l+="</tr>"}),l+="</thead>",s.length>0&&(l+="<tbody>",s.forEach(e=>{e.trim()&&(l+="<tr>",e.split("|").filter((e,t,n)=>!(0===t&&""===e.trim()||t===n.length-1&&""===e.trim())).forEach((e,t)=>{const n=r[t]||"left";l+=`<td style="text-align: ${n};">${x(e.trim())}</td>`}),l+="</tr>")}),l+="</tbody>"),l+="</table></div>",l}function w(e){const t=document.createElement("textarea");t.innerHTML=e;let n=t.value;const o=[];n=n.replace(/<!--DFHTML-->([\s\S]*?)<!--\/DFHTML-->/g,(e,t)=>{const n="__DATAFRAME_HTML_"+Math.random().toString(36).substr(2,9)+"__";return o.push({placeholder:n,html:t}),n});const a=[],s=[];n=n.replace(/```(\w+)?\n([\s\S]*?)```/g,(e,t,n)=>{const o=(t||"python").toLowerCase(),r=function(e){const t=e.split("\n");let n=1/0;const o=[];for(let e=0;e<t.length;e++){const a=t[e];if(a.trim().length>0){const t=a.match(/^(\s*)/),s=t?t[1].length:0;n=Math.min(n,s),o.push(e)}}return n===1/0||0===n?e:t.map(e=>0===e.trim().length?"":e.substring(n)).join("\n")}(n.trim()),l="code-block-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),i="__CODE_BLOCK_"+l+"__";a.push({id:l,code:r,language:o});const c="python"===o||"py"===o?function(e){let t=e;const n="color: #ce9178;",o=[];let a=0;return t=t.replace(/(#.*$)/gm,e=>{const t=`__PH${a++}__`;return o.push({id:t,html:`<span style="color: #6a9955; font-style: italic;">${y(e)}</span>`}),t}),t=t.replace(/(['"]{3})([\s\S]*?)(\1)/g,e=>{const t=`__PH${a++}__`;return o.push({id:t,html:`<span style="${n}">${y(e)}</span>`}),t}),t=t.replace(/(['"])([^'"]*?)(\1)/g,e=>{const t=`__PH${a++}__`;return o.push({id:t,html:`<span style="${n}">${y(e)}</span>`}),t}),t=t.replace(/\b(\d+\.?\d*)\b/g,e=>{const t=`__PH${a++}__`;return o.push({id:t,html:`<span style="color: #b5cea8;">${e}</span>`}),t}),["def","class","if","elif","else","for","while","return","import","from","as","try","except","finally","with","lambda","yield","async","await","pass","break","continue","raise","assert","del","global","nonlocal","True","False","None","and","or","not","in","is"].forEach(e=>{const n=new RegExp(`\\b${e}\\b`,"g");t=t.replace(n,e=>{const t=`__PH${a++}__`;return o.push({id:t,html:`<span style="color: #c586c0; font-weight: bold;">${e}</span>`}),t})}),["print","len","range","str","int","float","list","dict","tuple","set","bool","type","isinstance","issubclass","hasattr","getattr","setattr","delattr","dir","vars","locals","globals","input","open","file","abs","all","any","bin","chr","ord","hex","oct","pow","round","sum","min","max","sorted","reversed","enumerate","zip","map","filter","reduce"].forEach(e=>{const n=new RegExp(`\\b${e}\\b`,"g");t=t.replace(n,e=>{const t=`__PH${a++}__`;return o.push({id:t,html:`<span style="color: #dcdcaa;">${e}</span>`}),t})}),t=t.replace(/(__PH\d+__\s+)([a-zA-Z_][a-zA-Z0-9_]*)/g,(e,t,n)=>{const s=o.find(e=>e.id===t.trim());if(s&&s.html.includes("def")){const e=`__PH${a++}__`;return o.push({id:e,html:`<span style="color: #4fc1ff; font-weight: bold;">${n}</span>`}),t+e}return e}),t=t.split(/(__PH\d+__)/g).map(e=>e.match(/^__PH\d+__$/)?e:e=(e=(e=y(e)).replace(/([+\-*/%=<>!&|^~]+)/g,'<span style="color: #d4d4d4;">$1</span>')).replace(/([()[\]{}])/g,'<span style="color: #d4d4d4;">$1</span>')).join(""),o.forEach(e=>{t=t.replace(e.id,e.html)}),t}(r):"javascript"===o||"js"===o?function(e){const t=y(e).split("\n"),n=["function","const","let","var","if","else","for","while","return","class","import","export","from","async","await","new","this","null","undefined","true","false","typeof"];let o=!1;return t.map(e=>{if(o){const t=e.indexOf("*/");return-1!==t?(o=!1,`<span style="color: #6a9955; font-style: italic;">${e.substring(0,t+2)}</span>`+b(e.substring(t+2),n)):`<span style="color: #6a9955; font-style: italic;">${e}</span>`}const t=e.match(/^(\s*)(\/\/.*)$/);if(t)return t[1]+`<span style="color: #6a9955; font-style: italic;">${t[2]}</span>`;const a=e.indexOf("/*");if(-1!==a){const t=e.indexOf("*/",a);return-1!==t?b(e.substring(0,a),n)+`<span style="color: #6a9955; font-style: italic;">${e.substring(a,t+2)}</span>`+b(e.substring(t+2),n):(o=!0,b(e.substring(0,a),n)+`<span style="color: #6a9955; font-style: italic;">${e.substring(a)}</span>`)}const s=e.indexOf("//");return-1!==s?b(e.substring(0,s),n)+`<span style="color: #6a9955; font-style: italic;">${e.substring(s)}</span>`:b(e,n)}).join("\n")}(r):y(r),d='<div class="code-block-container" data-block-id="'+l+'"><div class="code-block-header"><span class="code-block-language">'+y(o)+'</span><div class="code-block-actions"><button class="code-block-apply" data-block-id="'+l+'" title="ì…€ì— ì ìš©">ì…€ì— ì ìš©</button><button class="code-block-copy" data-block-id="'+l+'" title="ë³µì‚¬">ë³µì‚¬</button></div></div><pre class="code-block language-'+y(o)+'"><code id="'+l+'">'+c+"</code></pre></div>";return s.push({placeholder:i,html:d}),i});const r=[];n=n.replace(/`([^`]+)`/g,(e,t)=>{const n="__INLINE_CODE_"+Math.random().toString(36).substr(2,9)+"__";return r.push({placeholder:n,html:'<code class="inline-code">'+y(t)+"</code>"}),n});const l=[];return n=n.replace(/(?:^|\n)((?:\|[^\n]+\|\n?)+\|[-:| ]+\|(?:\n\|[^\n]+\|)*)/gm,(e,t)=>{const n="__TABLE_"+Math.random().toString(36).substr(2,9)+"__",o=v(t.trim());return l.push({placeholder:n,html:o}),"\n"+n+"\n"}),n=n.replace(/(?:^|\n)((?:[^\n|]+\|[^\n]+\n)+[-:|\s]+[-|]+\n(?:[^\n|]+\|[^\n]+\n?)*)/gm,(e,t)=>{if(t.includes("__TABLE_"))return e;const n="__TABLE_"+Math.random().toString(36).substr(2,9)+"__",o=v(t.trim());return l.push({placeholder:n,html:o}),"\n"+n+"\n"}),n=n.replace(/(?:^|\n)(\|[^\n]*\|\n\|[-:| ]*\|(?:\n\|[^\n]*\|)*)/gm,(e,t)=>{if(t.includes("__TABLE_"))return e;const n="__TABLE_"+Math.random().toString(36).substr(2,9)+"__",o=v(t.trim());return l.push({placeholder:n,html:o}),"\n"+n+"\n"}),n=n.split(/(__(?:DATAFRAME_HTML|CODE_BLOCK|INLINE_CODE|TABLE)_[a-z0-9-]+__)/gi).map((e,t)=>t%2==1?e:y(e)).join(""),n=n.replace(/^###### (.*$)/gim,"<h6>$1</h6>"),n=n.replace(/^##### (.*$)/gim,"<h5>$1</h5>"),n=n.replace(/^#### (.*$)/gim,"<h4>$1</h4>"),n=n.replace(/^### (.*$)/gim,"<h3>$1</h3>"),n=n.replace(/^## (.*$)/gim,"<h2>$1</h2>"),n=n.replace(/^# (.*$)/gim,"<h1>$1</h1>"),n=n.replace(/^---+$/gim,"<hr>"),n=n.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>'),n=n.replace(/^[\-\*]\s+(.*$)/gim,"<li>$1</li>"),n=n.replace(/^\d+\.\s+(.*$)/gim,"<li>$1</li>"),n=n.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),n=n.replace(/(?<!\*)\*([^*\n]+)\*(?!\*)/g,"<em>$1</em>"),n=n.replace(/\n/g,"<br>"),l.forEach(e=>{n=n.replace(e.placeholder,e.html)}),o.forEach(e=>{n=n.replace(e.placeholder,e.html)}),r.forEach(e=>{n=n.replace(e.placeholder,e.html)}),s.forEach(e=>{n=n.replace(e.placeholder,e.html)}),n}const E=new i.LabIcon({name:"hdsp-agent:tab-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="1024" height="1024" viewBox="0 0 1024 1024">\n<g>\n<path d="M 318.50 710.49 C315.20,711.26 311.55,712.17 310.40,712.52 C307.71,713.33 306.05,711.65 301.13,703.18 C293.61,690.23 288.22,675.88 285.58,661.76 C282.40,644.82 281.97,629.53 282.56,555.82 C282.88,515.84 282.77,482.31 282.32,481.32 C281.87,480.32 281.75,449.12 282.06,412.00 L 282.61 344.50 L 285.27 334.50 C288.45,322.58 295.99,307.08 304.32,295.38 C314.87,280.54 322.55,273.94 380.00,230.25 C429.66,192.50 443.04,185.40 469.17,182.96 C485.43,181.44 640.59,182.24 653.00,183.91 C663.20,185.28 679.81,189.55 681.96,191.36 C682.80,192.08 685.97,193.69 689.00,194.95 C692.03,196.20 696.97,198.70 700.00,200.49 C703.03,202.28 706.94,204.59 708.69,205.62 C720.60,212.62 725.49,217.04 745.14,238.56 C759.73,254.53 769.58,277.30 775.20,308.00 C776.94,317.54 777.38,324.66 777.74,349.72 L 778.18 379.95 L 769.84 390.09 C765.25,395.66 758.09,403.89 753.92,408.36 C749.75,412.84 743.50,419.88 740.04,424.00 C736.57,428.12 728.06,437.18 721.12,444.13 C714.18,451.08 706.91,458.50 704.97,460.63 C703.02,462.76 696.56,469.00 690.59,474.50 C676.24,487.74 665.08,498.19 657.61,505.39 C651.89,510.90 646.43,514.99 644.78,515.00 C644.38,515.00 643.93,470.79 643.78,416.75 L 643.50 318.50 L 641.33 314.46 C638.38,308.94 631.03,302.38 626.35,301.08 C623.75,300.36 593.15,300.01 531.79,300.01 C442.88,300.00 440.97,300.04 435.62,302.04 C429.58,304.30 424.10,309.57 421.38,315.73 C419.85,319.19 419.71,332.47 419.61,477.50 L 419.50 635.50 L 421.71 639.62 C425.88,647.44 433.20,652.01 442.74,652.77 C446.46,653.07 448.93,653.71 448.73,654.31 C448.19,655.93 436.40,662.87 426.50,667.40 C421.55,669.66 413.55,673.66 408.71,676.28 C403.88,678.90 396.68,682.36 392.71,683.95 C388.75,685.55 382.79,688.18 379.47,689.81 C376.15,691.44 371.26,693.51 368.60,694.41 C365.94,695.32 362.80,696.58 361.63,697.21 C360.46,697.85 356.80,699.14 353.50,700.10 C350.20,701.05 342.33,703.46 336.00,705.46 C329.67,707.45 321.80,709.72 318.50,710.49 ZM 590.03 786.96 C576.83,788.58 441.72,788.11 426.00,786.40 C412.11,784.88 402.89,782.97 402.86,781.60 C402.83,780.50 407.87,777.80 434.00,764.91 C458.43,752.86 468.21,747.76 473.23,744.45 C475.28,743.10 477.22,742.00 477.55,742.00 C478.06,742.00 490.62,734.77 495.00,731.96 C495.83,731.43 497.51,730.56 498.74,730.03 C501.03,729.03 511.25,722.59 521.00,715.98 C524.03,713.93 528.75,711.06 531.50,709.60 C534.25,708.14 540.33,704.49 545.00,701.50 C549.67,698.50 554.88,695.40 556.57,694.59 C558.25,693.78 562.75,690.70 566.57,687.73 C572.88,682.81 586.92,673.39 595.22,668.51 C599.11,666.22 605.83,661.28 611.01,656.89 C614.04,654.32 619.44,650.24 623.01,647.83 C635.20,639.59 657.62,622.53 670.00,612.08 C679.61,603.97 685.79,599.08 688.60,597.38 C690.31,596.35 696.26,591.28 701.82,586.12 C707.38,580.96 714.96,574.43 718.67,571.62 C722.37,568.80 729.70,562.41 734.95,557.42 C740.20,552.42 748.55,544.78 753.50,540.43 C758.45,536.09 765.17,529.68 768.43,526.20 C774.29,519.94 779.57,516.24 780.84,517.51 C782.11,518.78 782.23,597.03 780.98,606.00 C778.42,624.31 774.06,638.87 766.75,653.50 C760.23,666.57 754.14,674.86 742.50,686.54 C726.82,702.27 680.51,739.24 645.50,763.99 C627.99,776.36 607.61,784.80 590.03,786.96 Z" fill="rgb(100,102,88)"/>\n<path d="M 781.70 537.56 C781.54,526.19 781.25,517.91 780.84,517.51 C779.57,516.24 774.29,519.94 768.43,526.20 C765.17,529.68 758.45,536.09 753.50,540.43 C748.55,544.78 740.20,552.42 734.95,557.42 C729.70,562.41 722.37,568.80 718.67,571.62 C714.96,574.43 707.38,580.96 701.82,586.12 C696.26,591.28 690.31,596.35 688.60,597.38 C685.79,599.08 679.61,603.97 670.00,612.08 C657.62,622.53 635.20,639.59 623.01,647.83 C619.44,650.24 614.04,654.32 611.01,656.89 C605.83,661.28 599.11,666.22 595.22,668.51 C586.92,673.39 572.88,682.81 566.57,687.73 C562.75,690.70 558.25,693.78 556.57,694.59 C554.88,695.40 549.67,698.50 545.00,701.50 C540.33,704.49 534.25,708.14 531.50,709.60 C528.75,711.06 524.03,713.93 521.00,715.98 C511.25,722.59 501.03,729.03 498.74,730.03 C497.51,730.56 495.83,731.43 495.00,731.96 C490.62,734.77 478.06,742.00 477.55,742.00 C477.22,742.00 475.28,743.10 473.23,744.45 C468.21,747.76 458.43,752.86 434.00,764.91 C407.87,777.80 402.83,780.50 402.86,781.60 C402.88,782.29 405.26,783.13 409.41,783.98 C403.38,782.89 398.48,781.78 397.22,781.09 C396.96,780.94 396.71,780.85 396.67,780.69 C396.48,780.02 400.05,778.29 422.41,767.46 L 425.35 766.03 C436.82,760.48 449.65,753.98 453.85,751.59 C458.06,749.20 470.73,742.16 482.00,735.95 C493.27,729.74 507.23,721.66 513.00,717.99 C518.78,714.32 529.58,707.57 537.00,702.99 C552.59,693.37 587.09,670.61 597.88,662.83 C601.94,659.90 609.14,654.70 613.88,651.28 C618.62,647.86 625.79,642.69 629.81,639.78 C646.64,627.62 701.04,583.66 709.50,575.38 C711.70,573.23 716.04,569.55 719.14,567.20 C722.24,564.85 729.44,558.55 735.14,553.21 C740.84,547.86 747.97,541.38 751.00,538.81 C754.03,536.24 762.12,528.64 769.00,521.92 L 781.50 509.70 ZM 643.50 318.50 L 643.78 416.75 C643.93,470.79 644.38,515.00 644.78,515.00 C646.43,514.99 651.89,510.90 657.61,505.39 C665.08,498.19 676.24,487.74 690.59,474.50 C696.56,469.00 703.02,462.76 704.97,460.63 C706.91,458.50 714.18,451.08 721.12,444.13 C728.06,437.18 736.57,428.12 740.04,424.00 C743.50,419.88 749.75,412.84 753.92,408.36 C758.09,403.89 765.25,395.66 769.84,390.09 L 778.15 379.97 L 778.17 384.09 L 775.38 387.79 C770.92,393.70 756.87,410.31 754.47,412.50 C753.27,413.60 746.65,420.80 739.76,428.50 C732.87,436.20 725.50,444.13 723.37,446.11 C721.24,448.10 716.51,452.83 712.86,456.61 C706.74,462.96 683.75,485.05 669.50,498.26 C666.20,501.32 660.58,506.55 657.00,509.89 C653.42,513.23 650.20,515.97 649.83,515.98 C649.46,515.99 647.88,517.07 646.33,518.38 L 643.50 520.76 L 643.50 318.50 ZM 318.50 710.49 C321.80,709.72 329.67,707.45 336.00,705.46 C342.33,703.46 350.20,701.05 353.50,700.10 C356.80,699.14 360.46,697.85 361.63,697.21 C362.80,696.58 365.94,695.32 368.60,694.41 C371.26,693.51 376.15,691.44 379.47,689.81 C382.79,688.18 388.75,685.55 392.71,683.95 C396.68,682.36 403.88,678.90 408.71,676.28 C413.55,673.66 421.55,669.66 426.50,667.40 C436.40,662.87 448.19,655.93 448.73,654.31 C448.93,653.71 446.46,653.07 442.74,652.77 C442.25,652.73 441.77,652.68 441.29,652.62 C443.73,652.85 446.67,652.99 449.37,652.99 C457.15,653.00 458.09,653.19 457.00,654.50 C456.32,655.33 455.25,656.00 454.63,656.00 C454.01,656.00 449.72,658.25 445.10,661.00 C440.47,663.75 436.42,666.00 436.10,666.01 C435.77,666.01 434.15,666.72 432.50,667.58 C412.88,677.87 396.05,685.98 385.00,690.48 C381.42,691.94 376.70,693.94 374.50,694.94 C372.30,695.93 365.77,698.40 360.00,700.42 C354.23,702.44 348.47,704.52 347.21,705.04 C344.40,706.21 329.70,710.39 317.12,713.60 C306.12,716.42 305.90,716.44 306.61,714.57 C306.88,713.87 305.48,710.61 303.40,706.97 C306.65,712.16 308.17,713.19 310.40,712.52 C311.55,712.17 315.20,711.26 318.50,710.49 ZM 284.60 655.99 C284.35,654.52 284.12,653.03 283.89,651.50 C282.48,642.17 280.91,588.39 280.35,530.25 C280.07,501.54 279.52,483.00 278.95,483.00 C277.33,483.00 277.91,480.39 279.94,478.56 C281.18,477.44 281.63,476.05 281.89,456.65 C281.93,471.24 282.07,480.77 282.32,481.32 C282.77,482.31 282.88,515.84 282.56,555.82 C282.03,621.19 282.32,640.61 284.60,655.99 ZM 758.58 257.58 C754.65,250.40 750.18,244.08 745.14,238.56 C725.49,217.04 720.60,212.62 708.69,205.62 C706.94,204.59 703.03,202.28 700.00,200.49 C696.97,198.70 692.03,196.20 689.00,194.95 C685.97,193.69 682.80,192.08 681.96,191.36 C680.19,189.88 668.68,186.73 658.97,184.89 C662.69,185.57 666.66,186.40 669.44,187.12 C676.94,189.03 681.06,189.14 685.18,187.51 C686.44,187.01 686.75,187.29 686.44,188.67 C686.10,190.13 688.06,191.50 696.26,195.49 C715.66,204.95 722.25,210.17 745.24,234.29 C747.30,236.45 748.73,238.63 748.41,239.14 C748.10,239.65 750.07,243.53 752.79,247.78 C754.88,251.04 756.80,254.29 758.58,257.58 ZM 280.81 873.85 C275.48,874.48 270.19,875.00 269.06,875.00 C266.03,875.00 266.55,873.31 269.75,872.73 C271.26,872.46 276.46,871.50 281.31,870.60 C286.44,869.65 290.75,869.32 291.62,869.81 C294.39,871.36 290.93,872.65 280.81,873.85 ZM 798.26 106.91 C789.36,109.48 788.09,109.51 788.27,107.12 C788.41,105.18 789.34,104.99 806.00,103.53 C810.21,103.16 810.80,103.26 808.50,103.93 C806.85,104.42 802.24,105.76 798.26,106.91 ZM 782.43 111.02 C778.94,112.35 775.85,112.20 773.73,110.59 C772.06,109.33 772.09,109.21 774.23,108.64 C777.89,107.65 785.00,107.91 785.00,109.02 C785.00,109.59 783.85,110.49 782.43,111.02 ZM 778.14 377.74 L 777.74 349.72 C777.53,335.58 777.31,327.14 776.83,320.77 C777.69,328.88 777.97,337.95 778.05,355.62 ZM 781.40 599.34 C781.72,590.47 781.87,575.02 781.86,559.90 C781.97,579.09 781.91,590.69 781.40,599.34 ZM 432.42 650.07 C427.85,647.83 424.21,644.31 421.71,639.62 L 419.50 635.50 L 422.00 639.95 C424.15,643.79 428.28,647.69 432.42,650.07 ZM 697.02 725.24 C710.23,714.79 722.38,704.75 731.50,696.72 C725.40,702.21 718.52,708.06 711.00,714.13 C706.63,717.66 701.91,721.41 697.02,725.24 ZM 421.63 785.89 C423.03,786.06 424.49,786.23 426.00,786.40 C431.73,787.02 453.28,787.48 479.02,787.73 C453.57,787.51 432.39,787.10 427.00,786.53 C425.29,786.35 423.48,786.13 421.63,785.89 ZM 749.23 679.46 C754.57,673.54 758.57,668.13 762.28,661.81 C760.95,664.10 759.56,666.33 758.13,668.50 C756.07,671.62 753.06,675.31 749.23,679.46 ZM 299.40 700.11 C295.31,692.73 292.17,685.52 289.67,677.63 C292.19,685.32 295.47,692.91 299.40,700.11 ZM 771.50 291.24 C768.94,281.46 765.84,272.64 762.18,264.73 C766.02,272.94 769.06,281.57 771.50,291.24 ZM 774.58 634.52 C777.00,627.13 778.85,619.38 780.25,610.83 C779.68,614.64 778.93,618.27 777.96,622.51 C777.05,626.48 775.92,630.50 774.58,634.52 ZM 282.56 350.91 L 282.59 344.50 L 285.27 334.50 C286.44,330.10 288.21,325.21 290.40,320.20 C294.13,311.65 299.07,302.76 304.32,295.38 C299.07,302.75 294.13,311.64 290.40,320.20 C288.22,325.20 286.45,330.10 285.27,334.50 L 282.61 344.50 Z" fill="rgb(146,104,68)"/>\n<path d="M 781.70 537.56 L 781.50 509.70 L 769.00 521.92 C762.12,528.64 754.03,536.24 751.00,538.81 C747.97,541.38 740.84,547.86 735.14,553.21 C729.44,558.55 722.24,564.85 719.14,567.20 C716.04,569.55 711.70,573.23 709.50,575.38 C701.04,583.66 646.64,627.62 629.81,639.78 C625.79,642.69 618.62,647.86 613.88,651.28 C609.14,654.70 601.94,659.90 597.88,662.83 C587.09,670.61 552.59,693.37 537.00,702.99 C529.58,707.57 518.78,714.32 513.00,717.99 C507.23,721.66 493.27,729.74 482.00,735.95 C470.73,742.16 458.06,749.20 453.85,751.59 C449.65,753.98 436.82,760.48 425.35,766.03 L 422.41 767.46 C400.05,778.29 396.48,780.02 396.67,780.69 C396.71,780.85 396.96,780.94 397.22,781.09 C398.14,781.59 401.00,782.32 404.83,783.10 C400.40,782.42 396.22,782.06 394.54,782.25 C392.32,782.50 384.65,785.22 377.50,788.29 C324.99,810.83 278.31,824.81 236.50,830.51 C222.36,832.44 186.45,833.29 176.60,831.93 C146.13,827.72 122.52,813.00 112.24,791.81 C107.92,782.91 104.51,770.53 103.48,760.00 C102.78,752.89 104.89,734.09 107.55,723.75 C123.45,661.92 177.67,581.88 260.13,498.50 L 280.48 477.92 C280.32,478.19 280.14,478.38 279.94,478.56 C277.91,480.39 277.33,483.00 278.95,483.00 C279.52,483.00 280.07,501.54 280.35,530.25 C280.51,547.00 280.76,563.38 281.06,578.45 C280.72,575.03 280.29,573.32 279.80,573.62 C278.84,574.22 266.21,590.12 262.02,596.02 C245.24,619.64 235.17,638.56 228.41,659.15 C226.13,666.09 225.66,669.36 225.59,678.50 C225.51,688.55 225.74,690.02 228.30,695.50 C233.60,706.86 243.51,714.27 257.60,717.42 C269.81,720.16 304.59,718.03 306.64,714.48 C306.63,714.51 306.62,714.54 306.61,714.57 C305.90,716.44 306.12,716.42 317.12,713.60 C329.70,710.39 344.40,706.21 347.21,705.04 C348.47,704.52 354.23,702.44 360.00,700.42 C365.77,698.40 372.30,695.93 374.50,694.94 C376.70,693.94 381.42,691.94 385.00,690.48 C396.05,685.98 412.88,677.87 432.50,667.58 C434.15,666.72 435.77,666.01 436.10,666.01 C436.42,666.00 440.47,663.75 445.10,661.00 C449.72,658.25 454.01,656.00 454.63,656.00 C455.25,656.00 456.32,655.33 457.00,654.50 C458.09,653.19 457.15,653.00 449.37,652.99 C446.67,652.99 443.73,652.85 441.29,652.62 C440.58,652.54 439.89,652.43 439.20,652.29 C441.95,652.69 445.60,652.94 449.18,652.96 L 458.86 653.00 L 474.18 643.88 C499.68,628.70 540.63,601.07 574.06,576.50 C589.46,565.18 608.69,549.97 635.17,528.16 L 642.84 521.84 L 643.48 514.67 C643.49,514.61 643.49,514.54 643.50,514.46 L 643.50 520.76 L 646.33 518.38 C647.88,517.07 649.46,515.99 649.83,515.98 C650.20,515.97 653.42,513.23 657.00,509.89 C660.58,506.55 666.20,501.32 669.50,498.26 C683.75,485.05 706.74,462.96 712.86,456.61 C716.51,452.83 721.24,448.10 723.37,446.11 C725.50,444.13 732.87,436.20 739.76,428.50 C746.65,420.80 753.27,413.60 754.47,412.50 C756.87,410.31 770.92,393.70 775.38,387.79 L 778.17 384.09 L 778.15 379.97 L 778.18 379.95 L 778.14 377.74 L 778.11 370.82 C778.28,378.15 778.64,380.00 779.41,380.00 C782.68,380.00 801.47,353.32 812.87,332.48 C835.22,291.62 837.69,266.88 821.15,249.67 C812.95,241.14 802.62,237.34 785.00,236.36 C774.77,235.79 750.50,238.10 748.81,239.79 C748.42,240.18 750.14,243.65 752.64,247.50 C757.04,254.29 760.75,261.20 763.90,268.56 C763.34,267.27 762.77,266.00 762.18,264.73 C761.03,262.26 759.83,259.88 758.58,257.58 L 758.58 257.58 C756.80,254.29 754.87,251.04 752.79,247.78 C750.07,243.53 748.10,239.65 748.41,239.14 C748.73,238.63 747.30,236.45 745.24,234.29 C722.25,210.17 715.66,204.95 696.26,195.49 C688.06,191.50 686.10,190.13 686.44,188.67 C686.75,187.29 686.44,187.01 685.18,187.51 C684.02,187.96 682.87,188.28 681.64,188.47 C682.98,188.11 684.41,187.50 686.31,186.63 C691.13,184.43 700.14,180.81 724.00,171.48 C736.74,166.49 769.12,155.80 781.50,152.49 C801.94,147.02 810.10,145.06 820.67,143.08 C866.29,134.55 901.31,136.66 927.50,149.50 C956.65,163.80 970.01,190.29 966.83,227.50 C964.79,251.49 956.10,277.76 939.97,308.73 C927.29,333.08 918.62,346.99 895.55,380.00 C890.20,387.66 869.70,414.27 863.58,421.50 C840.94,448.26 822.56,468.41 798.79,492.56 L 782.00 509.63 L 781.98 555.06 C781.98,563.66 781.95,570.95 781.90,577.14 C781.92,572.16 781.90,566.48 781.86,559.90 L 781.86 559.90 C781.85,552.03 781.80,544.26 781.70,537.56 ZM 274.21 871.91 C276.59,871.40 279.42,870.88 282.50,870.38 C284.70,870.03 286.95,869.40 287.50,868.99 C288.05,868.57 290.08,867.90 292.00,867.49 C303.53,865.03 332.38,855.82 349.50,849.14 L 359.50 845.23 L 360.04 837.76 C360.78,827.49 364.43,821.92 373.50,817.20 C389.33,808.95 408.27,820.03 409.74,838.40 C410.40,846.62 408.82,851.21 403.27,857.15 C397.51,863.30 391.96,865.49 384.20,864.68 C377.10,863.94 372.26,861.99 369.08,858.59 C365.99,855.29 363.89,855.34 352.11,858.94 C333.73,864.57 308.96,869.89 286.73,873.01 C292.19,872.04 293.75,871.00 291.62,869.81 C290.75,869.32 286.44,869.65 281.31,870.60 C278.86,871.05 276.32,871.52 274.21,871.91 ZM 701.98 163.75 C697.33,166.56 695.69,166.99 690.04,166.96 C679.39,166.90 672.36,162.46 667.33,152.63 C665.21,148.47 664.91,146.79 665.32,141.13 C666.03,131.16 666.55,129.36 669.93,125.08 C675.28,118.34 686.36,114.67 694.67,116.91 C698.28,117.88 700.08,118.94 707.62,124.49 C709.56,125.93 710.29,125.86 716.62,123.64 C733.17,117.83 753.19,112.39 767.00,109.94 C770.58,109.30 774.18,108.45 775.01,108.03 C775.85,107.62 780.57,106.74 785.51,106.08 C786.77,105.92 788.12,105.73 789.49,105.53 C788.48,105.93 788.32,106.40 788.27,107.12 C788.16,108.49 788.54,109.07 790.58,108.82 L 790.00 108.97 C787.42,109.65 784.99,110.30 782.67,110.93 C783.97,110.39 785.00,109.56 785.00,109.02 C785.00,107.91 777.89,107.65 774.23,108.64 C772.09,109.21 772.06,109.33 773.73,110.59 C775.22,111.72 777.20,112.14 779.46,111.81 C763.55,116.24 752.65,120.02 734.88,127.04 C720.30,132.80 716.03,134.23 714.64,137.08 C713.93,138.53 713.98,140.36 713.79,143.34 C713.17,153.07 709.67,159.11 701.98,163.75 ZM 131.60 596.60 C127.85,600.35 124.66,600.86 119.38,598.56 C115.11,596.70 113.00,593.34 113.00,588.38 C113.00,584.83 113.54,583.73 116.66,580.99 C119.99,578.07 120.78,577.82 125.35,578.26 C131.82,578.88 134.99,582.36 135.00,588.85 C135.00,592.47 134.43,593.77 131.60,596.60 ZM 427.75 786.60 C434.16,787.14 454.63,787.52 479.02,787.73 C497.78,787.92 518.78,787.99 537.47,787.94 C494.78,788.14 440.51,787.81 431.05,786.94 C430.03,786.85 428.92,786.73 427.75,786.60 ZM 803.21 105.47 C805.51,104.81 807.52,104.22 808.50,103.93 C810.80,103.26 810.21,103.16 806.00,103.53 C802.83,103.81 800.24,104.04 798.10,104.25 C798.79,104.13 799.41,104.03 799.92,103.94 C802.90,103.42 806.72,103.05 808.42,103.10 L 811.50 103.20 L 808.50 104.05 C807.79,104.25 805.86,104.77 803.21,105.47 ZM 774.58 634.52 L 774.58 634.52 C774.87,633.64 775.15,632.77 775.43,631.90 C772.09,643.14 767.72,653.05 762.01,662.27 C762.10,662.11 762.19,661.96 762.28,661.81 C763.79,659.22 765.26,656.49 766.75,653.50 C769.87,647.26 772.45,641.03 774.58,634.52 ZM 282.08 617.93 C282.36,626.68 282.67,634.14 282.98,639.89 C282.49,633.20 282.20,625.93 282.08,617.93 ZM 776.77 320.01 C777.55,326.73 777.87,333.52 777.96,345.02 C777.82,333.96 777.50,327.07 776.83,320.77 C776.81,320.51 776.79,320.26 776.77,320.01 ZM 288.38 673.48 C288.79,674.87 289.22,676.25 289.67,677.63 C292.17,685.52 295.31,692.73 299.40,700.11 C294.63,691.51 291.03,682.98 288.38,673.48 ZM 423.56 642.32 C422.97,641.53 422.44,640.74 422.00,639.95 L 419.50 635.50 L 422.00 639.91 C422.47,640.73 422.99,641.54 423.56,642.32 ZM 780.88 606.72 C780.78,607.57 780.68,608.32 780.57,609.00 C780.44,609.79 780.31,610.56 780.17,611.34 C780.20,611.17 780.22,611.00 780.25,610.83 C780.47,609.48 780.68,608.11 780.88,606.72 ZM 670.37 187.35 C670.07,187.27 669.76,187.20 669.44,187.12 C666.66,186.40 662.69,185.57 658.97,184.89 C658.76,184.85 658.55,184.81 658.35,184.77 C662.17,185.45 666.30,186.31 669.11,187.03 C669.55,187.14 669.97,187.25 670.37,187.35 ZM 781.40 599.34 C781.44,598.68 781.47,598.01 781.51,597.32 C781.45,598.70 781.39,599.96 781.33,601.11 C781.35,600.55 781.37,599.96 781.40,599.34 ZM 267.53 874.77 C267.15,874.65 267.00,874.46 267.00,874.21 C267.00,874.16 267.03,874.11 267.08,874.05 C266.98,874.33 267.12,874.59 267.53,874.77 ZM 275.15 874.48 C273.78,874.63 272.63,874.75 271.66,874.82 C272.64,874.73 273.84,874.62 275.15,874.48 Z" fill="rgb(215,111,43)"/>\n</g>\n</svg>'}),k=(0,r.forwardRef)(({apiService:e,notebookTracker:t},n)=>{const[o,a]=(0,r.useState)([]),[s,i]=(0,r.useState)(""),[d,p]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[g,h]=(0,r.useState)(null),[y,b]=(0,r.useState)(""),[x,v]=(0,r.useState)(!1),[E,k]=(0,r.useState)(null),[S,L]=(0,r.useState)(!1),[j,N]=(0,r.useState)(null),[A,T]=(0,r.useState)("normal"),[P,$]=(0,r.useState)(()=>{try{const e=localStorage.getItem("hdsp-agent-input-mode");return"agent"===e||"chat"===e?e:"chat"}catch{return"chat"}}),[_,M]=(0,r.useState)(!1);(0,r.useEffect)(()=>{try{localStorage.setItem("hdsp-agent-input-mode",P)}catch{}},[P]);const I=(0,r.useRef)(null),O=(0,r.useRef)(null),R=(0,r.useRef)([]),F=(0,r.useRef)(null),z=(0,r.useRef)(null),D=(0,r.useRef)(null);(0,r.useImperativeHandle)(n,()=>({handleSendMessage:async()=>{await G()},setInput:e=>{i(e)},setLlmPrompt:e=>{O.current=e;const t=I.current?.parentElement?.querySelector(".jp-agent-input");t&&t.setAttribute("data-llm-prompt",e)},setCurrentCellId:e=>{console.log("[AgentPanel] setCurrentCellId called with:",e),F.current=e},setCurrentCellIndex:e=>{console.log("[AgentPanel] setCurrentCellIndex called with:",e),z.current=e}})),(0,r.useEffect)(()=>{H()},[]),(0,r.useEffect)(()=>{const n=t?.currentWidget,o=n?.sessionContext;if(n&&o){const t={...f,executionSpeed:A};D.current=new C(n,o,e,t)}return()=>{D.current=null}},[t?.currentWidget,e,A]);const B=(0,r.useCallback)(async e=>{const n=t?.currentWidget;if(!D.current||!n){const e={id:Date.now().toString(),role:"assistant",content:"ë…¸íŠ¸ë¶ì„ ë¨¼ì € ì—´ì–´ì£¼ì„¸ìš”. Agent ì‹¤í–‰ì€ í™œì„± ë…¸íŠ¸ë¶ì´ í•„ìš”í•©ë‹ˆë‹¤.",timestamp:Date.now()};return void a(t=>[...t,e])}const o=`agent-${Date.now()}`,s={id:o,type:"agent_execution",request:e,status:{phase:"planning",message:"ì‹¤í–‰ ê³„íš ìƒì„± ì¤‘..."},plan:null,result:null,completedSteps:[],failedSteps:[],timestamp:Date.now()};a(e=>[...e,s]),N(o),L(!0);try{const t=await D.current.executeTask(e,n,e=>{a(t=>t.map(t=>t.id===o&&"type"in t&&"agent_execution"===t.type?{...t,status:e,plan:e.plan||t.plan,completedSteps:e.currentStep&&e.currentStep>1?Array.from({length:e.currentStep-1},(e,t)=>t+1):t.completedSteps,failedSteps:"failed"===e.phase&&e.currentStep?[...t.failedSteps,e.currentStep]:t.failedSteps}:t))});a(e=>e.map(e=>e.id===o&&"type"in e&&"agent_execution"===e.type?{...e,status:{phase:t.success?"completed":"failed",message:t.finalAnswer||(t.success?"ì‘ì—… ì™„ë£Œ":"ì‘ì—… ì‹¤íŒ¨")},result:t,completedSteps:t.plan?.steps.map(e=>e.stepNumber)||[]}:e))}catch(e){a(t=>t.map(t=>t.id===o&&"type"in t&&"agent_execution"===t.type?{...t,status:{phase:"failed",message:e.message||"ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ"}}:t))}finally{L(!1),N(null)}},[t,e]),H=async()=>{try{const t=await e.getConfig();if(!t||!t.provider)return console.warn("Config missing provider, using default"),void k({provider:"gemini",gemini:{apiKey:"",model:"gemini-2.5-pro"},vllm:{endpoint:"http://localhost:8000",apiKey:"test",model:"gpt-oss-120b"},openai:{apiKey:"",model:"gpt-4"}});k(t);const n=t;console.log("=== HDSP Agent Model Configuration ==="),console.log("Provider:",n.provider),"gemini"===n.provider?(console.log("Gemini Model:",n.gemini?.model||"gemini-pro (default)"),console.log("Gemini API Key:",n.gemini?.apiKey?"âœ“ Configured":"âœ— Not configured")):"vllm"===n.provider?(console.log("vLLM Model:",n.vllm?.model||"default"),console.log("vLLM Endpoint:",n.vllm?.endpoint||"http://localhost:8000"),console.log("vLLM API Key:",n.vllm?.apiKey?"âœ“ Configured":"âœ— Not configured")):"openai"===n.provider&&(console.log("OpenAI Model:",n.openai?.model||"gpt-4"),console.log("OpenAI API Key:",n.openai?.apiKey?"âœ“ Configured":"âœ— Not configured")),console.log("=====================================")}catch(e){console.error("Failed to load config:",e)}};(0,r.useEffect)(()=>{I.current?.scrollIntoView({behavior:"smooth"})},[o]),(0,r.useEffect)(()=>{const e=setTimeout(()=>{const e=document.querySelector(".jp-agent-messages")||I.current?.parentElement||document.querySelector('[class*="jp-agent-messages"]');if(!e)return void console.log("[AgentPanel] Messages container not found");const t=[],n=e.querySelectorAll(".code-block-container");console.log(`[AgentPanel] Found ${n.length} code block containers`),n.forEach(e=>{const n=e.getAttribute("data-block-id");if(!n)return void console.warn("[AgentPanel] Code block container missing data-block-id");const o=e.querySelector(`#${n}`);if(!o)return void console.warn(`[AgentPanel] Code element #${n} not found`);const a=o.textContent||"",s=e.querySelector(".code-block-language"),r=s?.textContent?.toLowerCase()||"python";t.push({id:n,code:a,language:r})}),R.current=t,console.log(`[AgentPanel] Stored ${t.length} code blocks`);const o=async e=>{const t=e.target;if(t.classList.contains("code-block-copy")||t.closest(".code-block-copy")){const n=t.classList.contains("code-block-copy")?t:t.closest(".code-block-copy");e.stopPropagation(),e.preventDefault();const o=n.getAttribute("data-block-id");if(!o)return;const a=R.current.find(e=>e.id===o);if(!a)return;try{await navigator.clipboard.writeText(a.code);const e=n.textContent;n.textContent="ë³µì‚¬ë¨!",setTimeout(()=>{n.textContent=e||"ë³µì‚¬"},2e3)}catch(e){console.error("Failed to copy code:",e),Z("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error")}return}if(t.classList.contains("code-block-apply")||t.closest(".code-block-apply")){const n=t.classList.contains("code-block-apply")?t:t.closest(".code-block-apply");e.stopPropagation(),e.preventDefault();const o=n.getAttribute("data-block-id");if(console.log(`[AgentPanel] Apply button clicked via delegation, blockId: ${o}`),!o)return void Z("ì½”ë“œ ë¸”ë¡ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","error");const a=R.current.find(e=>e.id===o);return a?(console.log(`[AgentPanel] Applying code to cell via delegation, code length: ${a.code.length}`),void await q(a.code,o,n)):void Z("ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","error")}};e.addEventListener("click",o),e._agentPanelClickHandler=o},100);return()=>{clearTimeout(e);const t=document.querySelector(".jp-agent-messages")||I.current?.parentElement||document.querySelector('[class*="jp-agent-messages"]');t&&t._agentPanelClickHandler&&(t.removeEventListener("click",t._agentPanelClickHandler),delete t._agentPanelClickHandler)}},[o]);const Z=(e,t="info")=>{const n=((e,t)=>{const n=document.createElement("div");return n.style.cssText=`\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      padding: 12px 16px;\n      border-radius: 6px;\n      color: white;\n      font-size: 14px;\n      font-weight: 500;\n      z-index: 10001;\n      opacity: 0;\n      transition: opacity 0.3s ease;\n      max-width: 300px;\n      word-wrap: break-word;\n      background: ${t};\n    `,n.textContent=e,n})(e,(e=>{switch(e){case"error":return"#f56565";case"warning":return"#ed8936";default:return"#4299e1"}})(t));document.body.appendChild(n),(e=>{setTimeout(()=>e.style.opacity="1",10),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)},3e3)})(n)},q=async(e,t,n)=>{console.log("[AgentPanel] applyCodeToCell called",{codeLength:e.length,blockId:t});const o=n.textContent;try{n.disabled=!0,n.textContent="ì ìš© ì¤‘...";const a=window.jupyterapp;if(!a)return console.error("[AgentPanel] jupyterapp not found in window"),Z("JupyterLabì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","error"),n.disabled=!1,void(n.textContent=o||"ì…€ì— ì ìš©");console.log("[AgentPanel] Found jupyterapp");const s=a.shell.currentWidget;if(s&&"content"in s){const a=s.content;if(a&&"model"in a&&a.model&&"cells"in a.model)return void await K(e,a,t,n,o)}V(e,n,o)}catch(e){console.error("Failed to apply code to cell:",e),Z("ì½”ë“œ ì ìš©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error"),n.disabled=!1,n.textContent=o||"ì…€ì— ì ìš©"}},W=(e,t)=>{if(e.sharedModel&&"function"==typeof e.sharedModel.setSource)e.sharedModel.setSource(t);else if(e.setSource&&"function"==typeof e.setSource)e.setSource(t);else if(e.value&&"function"==typeof e.value.setText)e.value.setText(t);else{if(!e.value||void 0===e.value.text)throw new Error("Unable to set cell source - no compatible method found");e.value.text=t}},U=(e,t)=>{e.disabled=!1,e.textContent=t||"ì…€ì— ì ìš©"},K=async(e,t,n,o,a)=>{try{if(console.log("[AgentPanel] applyCodeToNotebookCell called",{currentCellIndex:z.current,currentCellId:F.current,blockId:n}),null!==z.current&&void 0!==z.current){console.log("[AgentPanel] Using cell index:",z.current);const n=t.widgets||[];if(!(z.current>=0&&z.current<n.length))return console.error("[AgentPanel] Cell index out of bounds:",z.current,"cells.length:",n.length),Z("ëŒ€ìƒ ì…€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì…€ì´ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì´ë™í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.","error"),U(o,a),z.current=null,void(F.current=null);{const t=n[z.current],s=t.model||t;console.log("[AgentPanel] Found cell at index, applying code...");try{return W(s,e),console.log("[AgentPanel] Code applied successfully!"),Z("ì½”ë“œê°€ ì…€ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!","info"),U(o,a),z.current=null,void(F.current=null)}catch(e){return console.error("Failed to update cell content:",e),Z("ì…€ ë‚´ìš© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: "+e.message,"error"),void U(o,a)}}}console.log("[AgentPanel] No current cell index set, showing selector dialog"),V(e,o,a)}catch(e){console.error("Failed to apply code:",e),Z("ì½”ë“œ ì ìš©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error"),U(o,a)}},V=(e,t,n)=>{try{const o=window.jupyterapp;if(!o)return Z("JupyterLabì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","error"),t.disabled=!1,void(t.textContent=n||"ì…€ì— ì ìš©");const a=o.shell.currentWidget;if(!a||!("content"in a))return Z("í™œì„± ë…¸íŠ¸ë¶ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","warning"),t.disabled=!1,void(t.textContent=n||"ì…€ì— ì ìš©");const s=a.content;if(!(s&&"model"in s&&s.model&&"cells"in s.model))return Z("í™œì„± ë…¸íŠ¸ë¶ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","warning"),t.disabled=!1,void(t.textContent=n||"ì…€ì— ì ìš©");const r=s.widgets||[],l=[];if(r.forEach((e,t)=>{const n=e.model||e;if("code"===n.type){const o=n.metadata?.get?.("jupyterAgentCellId")||n.id||`cell-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{n.metadata?.get?.("jupyterAgentCellId")||n.metadata?.set&&n.metadata.set("jupyterAgentCellId",o)}catch(e){}const a=(n.sharedModel?.getSource?.()||n.value?.text||"").toString().substring(0,100).replace(/\n/g," ");l.push({cell:e,index:t,id:o,preview:a})}}),0===l.length)return Z("ì½”ë“œ ì…€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.","warning"),t.disabled=!1,void(t.textContent=n||"ì…€ì— ì ìš©");const i=document.querySelector(".jp-agent-cell-selector-dialog");i&&i.remove();const c=document.createElement("div");c.className="jp-agent-cell-selector-dialog",c.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.3);\n        z-index: 10000;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      ";const d=document.createElement("div");d.style.cssText="\n        background: #fafafa;\n        border: 1px solid #e0e0e0;\n        border-radius: 4px;\n        padding: 24px;\n        max-width: 500px;\n        width: 90%;\n        max-height: 80vh;\n        overflow-y: auto;\n        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      ";const p=l.map(({index:e,id:t,preview:n})=>`\n          <div class="jp-agent-cell-selector-item" data-cell-id="${t}" style="\n            padding: 12px;\n            margin-bottom: 8px;\n            background: white;\n            border: 2px solid #e0e0e0;\n            border-radius: 4px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n          ">\n            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">\n              <span style="\n                background: #667eea;\n                color: white;\n                padding: 2px 8px;\n                border-radius: 12px;\n                font-size: 11px;\n                font-weight: 600;\n              ">ì…€ ${e+1}</span>\n            </div>\n            <div style="font-size: 12px; color: #757575; font-family: 'Menlo', monospace; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">\n              ${J(n)}${n.length>=100?"...":""}\n            </div>\n          </div>\n        `).join("");d.innerHTML=`\n        <div style="margin-bottom: 20px;">\n          <h3 style="margin: 0 0 8px 0; color: #424242; font-size: 16px; font-weight: 500;">\n            ì½”ë“œë¥¼ ì ìš©í•  ì…€ ì„ íƒ\n          </h3>\n          <p style="margin: 0; color: #757575; font-size: 13px;">\n            AIê°€ ìƒì„±í•œ ì½”ë“œë¥¼ ì ìš©í•  ì…€ì„ ì„ íƒí•˜ì„¸ìš”\n          </p>\n        </div>\n        <div class="jp-agent-cell-list" style="margin-bottom: 20px;">\n          ${p}\n        </div>\n        <div style="display: flex; gap: 12px; justify-content: flex-end;">\n          <button class="jp-agent-cell-selector-cancel-btn" style="\n            background: transparent;\n            color: #616161;\n            border: 1px solid #d1d5db;\n            border-radius: 3px;\n            padding: 8px 16px;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            transition: all 0.15s ease;\n          ">ì·¨ì†Œ</button>\n        </div>\n      `,c.appendChild(d),document.body.appendChild(c),d.querySelectorAll(".jp-agent-cell-selector-item").forEach(o=>{o.addEventListener("click",()=>{const a=o.getAttribute("data-cell-id");if(!a)return;const s=l.find(e=>e.id===a);if(!s)return;const r=s.cell.model||s.cell;try{W(r,e),Z("ì½”ë“œê°€ ì…€ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!","info"),c.remove(),U(t,n)}catch(e){console.error("Failed to apply code to cell:",e),Z("ì½”ë“œ ì ìš©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error"),U(t,n)}}),o.addEventListener("mouseenter",()=>{o.style.borderColor="#667eea",o.style.background="#f8f9ff"}),o.addEventListener("mouseleave",()=>{o.style.borderColor="#e0e0e0",o.style.background="white"})});const u=d.querySelector(".jp-agent-cell-selector-cancel-btn");u&&(u.addEventListener("click",()=>{c.remove(),t.disabled=!1,t.textContent=n||"ì…€ì— ì ìš©"}),u.addEventListener("mouseenter",()=>{u.style.background="#f5f5f5",u.style.borderColor="#9ca3af"}),u.addEventListener("mouseleave",()=>{u.style.background="transparent",u.style.borderColor="#d1d5db"})),c.addEventListener("click",e=>{e.target===c&&(c.remove(),t.disabled=!1,t.textContent=n||"ì…€ì— ì ìš©")});const m=e=>{"Escape"===e.key&&(c.remove(),document.removeEventListener("keydown",m),t.disabled=!1,t.textContent=n||"ì…€ì— ì ìš©")};document.addEventListener("keydown",m)}catch(e){console.error("Failed to show cell selector:",e),Z("ì…€ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error"),t.disabled=!1,t.textContent=n||"ì…€ì— ì ìš©"}},J=e=>{const t=document.createElement("div");return t.textContent=e,t.innerHTML},G=async()=>{const t=I.current?.parentElement?.querySelector(".jp-agent-input"),n=O.current||t?.getAttribute("data-llm-prompt");if(!s.trim()&&!n||d||u||S)return;const o=s.trim();if("agent"===P){const e={id:Date.now().toString(),role:"user",content:`@agent ${o}`,timestamp:Date.now()};return a(t=>[...t,e]),i(""),void await B(o)}if((e=>{const t=e.trim().toLowerCase();return t.startsWith("/run ")||t.startsWith("@agent ")||t.startsWith("/agent ")||t.startsWith("/execute ")})(o)){const e=(e=>{const t=e.trim();return t.toLowerCase().startsWith("/run ")?t.slice(5).trim():t.toLowerCase().startsWith("@agent ")||t.toLowerCase().startsWith("/agent ")?t.slice(7).trim():t.toLowerCase().startsWith("/execute ")?t.slice(9).trim():t})(o);if(e){const t={id:Date.now().toString(),role:"user",content:o,timestamp:Date.now()};return a(e=>[...e,t]),i(""),void await B(e)}}if(E||await H(),!(()=>{if(!E||!E.provider)return!1;const e=E.provider;return"gemini"===e?!(!E.gemini?.apiKey||!E.gemini.apiKey.trim()):"vllm"===e?!(!E.vllm?.endpoint||!E.vllm.endpoint.trim()):"openai"===e&&!(!E.openai?.apiKey||!E.openai.apiKey.trim())})()){const e=E?.provider||"LLM",t={id:Date.now().toString(),role:"assistant",content:`API Keyê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\n${"gemini"===e?"Gemini":"openai"===e?"OpenAI":"vLLM"} API Keyë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.\n\nì„¤ì • ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”.`,timestamp:Date.now()};return a(e=>[...e,t]),void v(!0)}const r=o||(n?"ì…€ ë¶„ì„ ìš”ì²­":""),l={id:Date.now().toString(),role:"user",content:r,timestamp:Date.now()};a(e=>[...e,l]),o&&i(""),p(!0),m(!0),t&&n&&(t.removeAttribute("data-llm-prompt"),O.current=null);const c=Date.now().toString()+"-assistant";let g="";h(c);const f={id:c,role:"assistant",content:"",timestamp:Date.now()};a(e=>[...e,f]);try{const t=n||r;await e.sendMessageStream({message:t,conversationId:y||void 0},e=>{g+=e,a(e=>e.map(e=>e.id===c&&X(e)?{...e,content:g}:e))},e=>{e.conversationId&&!y&&b(e.conversationId),(e.provider||e.model)&&a(t=>t.map(t=>t.id===c&&X(t)?{...t,metadata:{...t.metadata,provider:e.provider,model:e.model}}:t))})}catch(e){a(t=>t.map(t=>t.id===c&&X(t)?{...t,content:g+`\n\nError: ${e instanceof Error?e.message:"Failed to send message"}`}:t))}finally{p(!1),m(!1),h(null)}},X=e=>!("type"in e)||"agent_execution"!==e.type;return l().createElement("div",{className:"jp-agent-panel"},x&&l().createElement(c,{onClose:()=>v(!1),onSave:async t=>{try{console.log("=== handleSaveConfig ì‹œì‘ ==="),console.log("ì „ì†¡í•  config:",JSON.stringify(t,null,2)),console.log("Provider:",t.provider),console.log("Gemini API Key:",t.gemini?.apiKey?`${t.gemini.apiKey.substring(0,10)}...`:"empty"),await e.saveConfig(t),console.log("ì„œë²„ ì €ì¥ ì™„ë£Œ, state ì—…ë°ì´íŠ¸ ì¤‘..."),k(t),await H(),console.log("=== handleSaveConfig ì™„ë£Œ ==="),alert("ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")}catch(e){console.error("=== handleSaveConfig ì‹¤íŒ¨ ==="),console.error("Error:",e),alert("ì„¤ì • ì €ì¥ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")}},currentConfig:E||void 0}),l().createElement("div",{className:"jp-agent-header"},l().createElement("div",{className:"jp-agent-header-logo",dangerouslySetInnerHTML:{__html:'<svg xmlns="http://www.w3.org/2000/svg" width="1280" height="552" viewBox="0 0 1280 552">\n<g>\n<path d="M 509.50 487.44 C489.07,492.66 475.03,491.17 456.90,481.84 C443.64,475.02 431.71,461.09 425.78,445.49 L 423.50 439.50 L 423.50 352.50 C423.50,270.60 423.61,265.16 425.35,259.64 C429.92,245.21 434.83,237.05 444.80,227.32 C451.11,221.16 454.21,219.17 490.50,198.02 C499.30,192.89 511.23,185.89 517.00,182.47 C524.42,178.07 529.21,175.00 534.39,172.87 C546.27,167.97 560.17,167.97 612.52,168.00 C616.39,168.00 620.47,168.00 624.77,168.00 C696.61,168.00 696.69,168.00 698.60,170.10 C700.45,172.15 700.51,176.37 700.76,326.52 L 701.02 480.84 L 698.37 482.92 C695.82,484.93 694.64,485.00 662.87,485.00 C660.58,485.00 658.44,485.00 656.43,485.01 C635.73,485.03 629.05,485.04 626.93,481.94 C625.92,480.46 625.95,478.27 625.98,475.05 C625.99,474.40 626.00,473.70 626.00,472.95 C626.00,464.61 624.48,459.78 621.50,458.64 C619.31,457.80 613.27,459.19 584.00,467.25 C548.33,477.08 520.07,484.73 509.50,487.44 ZM 101.50 483.17 L 95.89 488.00 L 61.94 488.00 C29.33,488.00 27.92,487.92 26.00,486.00 C24.01,484.01 24.00,482.67 24.00,280.45 L 24.00 76.91 L 28.98 71.92 L 62.97 72.21 C96.81,72.50 96.96,72.51 99.22,74.78 L 101.50 77.05 L 102.00 159.37 C102.39,224.31 102.77,242.02 103.78,243.24 C106.88,246.97 108.55,247.04 192.33,246.77 L 274.16 246.50 L 280.00 239.97 L 280.00 159.53 C280.00,102.71 280.33,78.38 281.11,76.66 C283.11,72.27 285.27,72.00 318.40,72.00 C350.66,72.00 355.11,72.47 357.02,76.04 C357.65,77.22 358.00,150.36 358.00,280.86 L 358.00 483.85 L 355.37 485.93 C352.82,487.93 351.61,488.00 318.98,488.00 C287.23,488.00 285.08,487.89 282.86,486.09 L 280.50 484.18 L 280.00 398.62 C279.50,313.37 279.49,313.05 277.40,310.96 C276.25,309.80 273.55,308.45 271.40,307.95 C265.89,306.67 113.48,306.74 108.86,308.02 C106.86,308.58 104.61,309.77 103.86,310.67 C102.75,312.01 102.41,327.79 102.00,397.74 ZM 803.53 486.27 L 804.22 489.00 L 787.86 488.99 C776.68,488.98 770.71,488.57 769.00,487.71 L 766.50 486.44 L 766.25 262.22 C766.00,39.09 766.01,37.99 768.00,36.00 C769.92,34.08 771.32,34.00 802.44,34.00 L 834.89 34.00 L 837.69 36.41 L 840.50 38.83 L 839.87 387.35 L 834.03 395.42 C820.62,413.96 809.00,435.96 804.66,451.00 C800.58,465.15 800.32,473.46 803.53,486.27 ZM 503.02 426.72 C506.36,428.40 615.07,428.57 619.88,426.89 C620.83,426.56 621.63,426.38 622.31,425.99 C626.01,423.85 626.01,415.30 626.00,340.32 C626.00,336.25 626.00,331.99 626.00,327.52 C626.00,248.50 625.79,234.42 624.54,231.43 C624.09,230.36 623.73,229.47 623.18,228.73 C620.38,225.00 612.60,225.00 563.70,225.01 L 562.28 225.01 C528.10,225.01 507.13,225.39 504.75,226.05 C503.57,226.38 502.60,226.49 501.79,226.92 C497.98,228.96 497.98,238.13 498.01,311.07 C498.01,315.99 498.01,321.19 498.01,326.70 C498.02,329.49 498.02,332.20 498.02,334.83 C498.03,416.15 498.03,423.53 501.47,425.89 C501.92,426.20 502.44,426.42 503.02,426.72 ZM 807.50 386.63 C809.71,390.01 815.16,389.94 817.00,386.51 C818.51,383.68 817.20,379.40 814.51,378.36 C809.40,376.40 804.55,382.13 807.50,386.63 Z" fill="rgb(33,33,33)"/>\n<path d="M 920.88 447.94 C918.34,448.49 915.13,449.38 913.74,449.91 C910.57,451.11 908.44,449.01 904.19,440.50 C899.91,431.92 898.22,426.31 897.06,416.83 C896.19,409.61 894.33,331.10 894.94,327.00 C895.06,326.17 895.51,308.62 895.93,288.00 C896.77,246.77 896.82,246.38 903.51,234.42 C909.99,222.84 915.87,217.34 946.50,194.31 C966.26,179.45 975.52,173.41 982.84,170.64 C988.30,168.58 990.25,168.49 1037.00,168.20 C1070.48,167.98 1087.98,168.25 1093.50,169.07 C1097.90,169.71 1103.07,170.46 1105.00,170.72 C1111.37,171.59 1127.50,180.68 1133.24,186.65 C1134.74,188.22 1137.78,191.34 1139.99,193.59 C1142.19,195.85 1144.00,198.04 1144.00,198.46 C1144.00,198.89 1145.53,201.77 1147.39,204.87 C1155.34,218.08 1158.67,233.11 1159.17,258.00 L 1159.50 274.50 L 1154.09 281.00 C1143.99,293.15 1136.53,301.15 1121.14,316.34 L 1104.14 333.12 C1099.09,338.11 1090.51,345.00 1089.34,345.00 C1088.24,345.00 1088.00,335.76 1088.00,292.25 C1087.99,241.70 1087.91,239.37 1086.04,236.30 C1082.06,229.77 1083.02,229.88 1028.67,229.68 L 1025.26 229.67 C983.83,229.51 976.61,229.49 973.18,233.08 C972.36,233.93 971.76,234.99 970.96,236.30 C969.06,239.41 969.01,241.96 969.00,324.18 C969.00,375.59 969.38,409.86 969.96,411.38 C971.30,414.91 975.10,417.10 981.24,417.89 L 986.50 418.57 L 982.22 421.31 C969.10,429.74 933.62,445.14 920.88,447.94 ZM 1065.75 487.50 C1060.71,488.69 1051.19,488.95 1016.50,488.86 C976.07,488.76 961.65,488.05 959.65,486.05 C959.18,485.58 964.81,482.19 972.15,478.51 C979.49,474.83 985.95,471.47 986.50,471.06 C987.05,470.65 992.00,467.93 997.50,465.04 C1006.02,460.55 1010.72,457.80 1025.42,448.69 C1051.66,432.43 1059.19,427.34 1080.42,411.50 C1083.37,409.30 1087.05,406.60 1088.60,405.50 C1091.66,403.33 1101.28,395.70 1104.50,392.90 C1105.60,391.94 1109.65,388.56 1113.50,385.38 C1117.35,382.21 1123.19,377.34 1126.49,374.56 C1132.44,369.53 1134.33,367.82 1151.50,352.03 L 1160.50 343.74 L 1161.29 354.12 C1162.30,367.25 1161.38,391.47 1159.55,400.14 C1157.35,410.57 1152.30,421.50 1146.04,429.36 C1140.26,436.61 1123.66,450.88 1104.00,465.48 C1098.22,469.77 1091.90,474.51 1089.95,476.03 C1084.46,480.28 1072.67,485.87 1065.75,487.50 ZM 1169.50 127.53 C1167.30,128.25 1163.93,128.83 1162.00,128.80 C1158.73,128.77 1158.83,128.68 1163.50,127.48 C1170.40,125.70 1174.92,125.74 1169.50,127.53 Z" fill="rgb(106,105,93)"/>\n<path d="M 803.53 486.27 C800.32,473.46 800.58,465.15 804.66,451.00 C809.00,435.96 820.62,413.96 834.03,395.42 L 839.87 387.35 L 840.12 246.32 C840.05,327.94 840.28,384.00 840.74,384.00 C841.22,384.00 844.07,381.00 847.06,377.33 C856.97,365.17 869.10,351.67 882.38,338.00 L 895.04 324.98 C895.00,326.15 894.96,326.85 894.94,327.00 C894.43,330.45 895.66,386.60 896.59,408.61 C896.39,405.17 896.24,401.34 896.12,397.00 C895.78,385.17 895.15,375.50 894.73,375.50 C893.01,375.50 878.71,396.18 873.64,406.00 C868.53,415.89 864.99,426.58 865.01,432.06 C865.03,443.07 873.07,451.12 885.79,452.87 C888.93,453.30 892.85,453.52 894.50,453.35 C904.27,452.39 908.17,452.12 908.83,450.52 C909.20,449.61 908.51,448.25 907.25,446.08 C909.67,449.91 911.43,450.79 913.74,449.91 C915.13,449.38 918.34,448.49 920.88,447.94 C933.62,445.14 969.10,429.74 982.22,421.31 L 986.50 418.57 L 981.24,417.89 C979.60,417.68 978.13,417.37 976.82,416.96 C978.94,417.62 981.71,418.00 984.58,418.00 C990.13,418.00 991.42,417.55 999.08,412.92 C1015.33,403.11 1046.98,381.37 1060.00,371.06 C1070.76,362.54 1086.56,349.47 1087.23,348.53 C1087.64,347.96 1087.97,323.20 1087.98,293.50 C1087.99,248.96 1087.93,241.00 1086.73,237.69 C1087.93,240.98 1087.99,248.80 1088.00,292.25 C1088.00,335.76 1088.24,345.00 1089.34,345.00 C1090.51,345.00 1099.09,338.11 1104.14,333.12 L 1121.14 316.34 C1136.53,301.15 1143.99,293.15 1154.09,281.00 L 1159.50 274.50 L 1159.29 264.13 C1159.39,265.95 1159.51,267.46 1159.64,268.39 C1160.27,272.96 1160.32,273.02 1162.27,271.28 C1165.00,268.83 1174.79,254.08 1179.70,245.00 C1185.69,233.94 1188.00,226.29 1188.00,217.57 C1188.00,210.72 1187.75,209.82 1184.70,205.83 C1180.11,199.80 1174.31,196.83 1165.98,196.23 C1157.47,195.62 1144.00,196.83 1144.00,198.20 C1144.00,198.77 1145.53,201.77 1147.39,204.87 C1145.53,201.77 1144.00,198.89 1144.00,198.46 C1144.00,198.04 1142.19,195.85 1139.99,193.59 C1137.78,191.34 1134.74,188.22 1133.24,186.65 C1127.62,180.81 1112.05,171.97 1105.41,170.78 C1107.93,170.84 1112.45,169.46 1121.24,166.00 C1138.23,159.32 1157.80,152.80 1170.50,149.59 C1218.80,137.37 1251.17,146.42 1258.57,174.24 C1267.44,207.55 1234.44,267.03 1171.32,331.50 L 1161.53 341.50 L 1161.48 357.12 C1161.43,356.07 1161.37,355.07 1161.29,354.12 L 1160.50 343.74 L 1151.50 352.03 C1134.33,367.82 1132.44,369.53 1126.49,374.56 C1123.19,377.34 1117.35,382.21 1113.50,385.38 C1109.65,388.56 1105.60,391.94 1104.50,392.90 C1101.28,395.70 1091.66,403.33 1088.60,405.50 C1087.05,406.60 1083.37,409.30 1080.42,411.50 C1059.19,427.34 1051.66,432.43 1025.42,448.69 C1010.72,457.80 1006.02,460.55 997.50,465.04 C992.00,467.93 987.05,470.65 986.50,471.06 C985.95,471.47 979.49,474.83 972.15,478.51 C964.81,482.19 959.18,485.58 959.65,486.05 C960.30,486.69 962.24,487.21 965.94,487.61 C963.89,487.44 962.44,487.26 961.50,487.06 L 955.50 485.76 L 943.50 490.80 C921.92,499.86 902.62,505.99 883.00,510.03 C871.45,512.40 842.75,513.62 835.50,512.04 C822.79,509.28 813.50,503.48 807.62,494.62 L 803.98 489.13 L 796.50 488.99 L 804.22 489.00 ZM 905.64 533.57 C896.06,535.25 896.00,535.25 896.00,534.14 C896.00,533.66 899.26,532.48 903.25,531.52 C909.70,529.96 927.81,524.08 935.25,521.14 C937.53,520.23 938.00,519.44 938.00,516.48 C938.00,509.26 943.29,504.00 950.53,504.00 C955.94,504.00 961.54,508.58 963.07,514.25 C966.26,526.10 953.28,534.63 942.95,527.47 C939.79,525.28 938.91,525.08 936.40,526.04 C931.87,527.76 914.62,531.98 905.64,533.57 ZM 1119.13 157.43 C1117.46,158.30 1114.22,159.00 1111.93,159.00 C1108.42,159.00 1107.15,158.39 1103.88,155.12 C1100.32,151.55 1100.00,150.79 1100.00,145.75 C1100.00,139.49 1102.04,136.05 1106.98,134.01 C1110.91,132.38 1117.21,133.23 1120.54,135.85 C1122.67,137.53 1123.62,137.71 1125.82,136.87 C1133.46,133.92 1155.51,128.64 1166.41,126.80 C1165.51,126.99 1164.53,127.21 1163.50,127.48 C1158.83,128.68 1158.73,128.77 1162.00,128.80 C1163.35,128.82 1165.43,128.54 1167.30,128.12 C1166.23,128.41 1165.05,128.72 1163.79,129.02 C1154.63,131.26 1133.67,138.57 1127.94,141.53 C1125.68,142.70 1125.00,143.74 1125.00,146.06 C1125.00,150.77 1122.45,155.72 1119.13,157.43 ZM 807.50 386.63 C804.55,382.13 809.40,376.40 814.51,378.36 C817.20,379.40 818.51,383.68 817.00,386.51 C815.16,389.94 809.71,390.01 807.50,386.63 ZM 766.48 471.20 C766.05,448.49 766.00,393.72 766.00,261.88 C766.00,103.18 766.01,56.97 766.73,42.79 C766.02,56.96 766.07,103.22 766.25,262.22 ZM 1156.09 227.13 C1157.94,234.97 1158.95,243.50 1159.00,252.26 C1158.60,242.47 1157.67,234.29 1156.09,227.13 ZM 1161.13 385.96 C1160.55,399.03 1159.02,404.69 1154.94,414.49 C1153.90,417.00 1152.25,420.08 1150.43,423.03 C1154.62,416.14 1157.89,408.00 1159.55,400.14 C1160.21,397.02 1160.75,391.88 1161.13,385.96 ZM 1032.93 488.87 C1052.58,488.83 1060.25,488.53 1064.58,487.74 C1060.13,488.66 1053.62,488.94 1032.93,488.87 ZM 905.87 443.73 C902.29,437.54 900.07,432.51 898.65,426.02 C899.80,430.82 901.47,435.06 904.19,440.50 C904.79,441.70 905.34,442.77 905.87,443.73 ZM 975.01 416.25 C975.42,416.45 975.88,416.64 976.38,416.82 C973.05,415.68 970.90,413.86 969.96,411.38 C969.80,410.99 969.67,408.38 969.55,403.84 C969.73,408.97 969.97,411.38 970.28,412.00 C970.97,413.38 973.10,415.29 975.01,416.25 ZM 969.00 324.18 C969.01,257.37 969.04,243.16 970.08,238.52 C969.05,243.17 969.01,257.42 969.02,324.50 C969.02,334.90 969.03,344.15 969.04,352.36 C969.02,343.71 969.00,334.28 969.00,324.18 ZM 1170.13 127.31 C1172.20,126.57 1172.32,126.19 1171.17,126.17 C1171.98,126.12 1172.49,126.15 1172.62,126.29 C1172.75,126.42 1171.79,126.80 1170.13,127.31 ZM 769.01 487.71 C768.36,487.54 767.92,487.35 767.65,487.13 C767.60,487.09 767.55,487.03 767.51,486.95 L 769.00 487.71 Z" fill="rgb(216,112,44)"/>\n</g>\n</svg>'}}),l().createElement("div",{className:"jp-agent-header-buttons"},l().createElement("button",{className:"jp-agent-clear-button",onClick:()=>{a([]),b("")},title:"ëŒ€í™” ì´ˆê¸°í™”"},l().createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l().createElement("polyline",{points:"3 6 5 6 21 6"}),l().createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),l().createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),l().createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"}))),l().createElement("button",{className:"jp-agent-settings-button-icon",onClick:()=>v(!0),title:"ì„¤ì •"},l().createElement("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l().createElement("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),l().createElement("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),l().createElement("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),l().createElement("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),l().createElement("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),l().createElement("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),l().createElement("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),l().createElement("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),l().createElement("line",{x1:"17",y1:"16",x2:"23",y2:"16"}))))),l().createElement("div",{className:"jp-agent-messages"},0===o.length?l().createElement("div",{className:"jp-agent-empty-state"},l().createElement("p",null,"ì•ˆë…•í•˜ì„¸ìš”! HDSP Agentì…ë‹ˆë‹¤."),l().createElement("p",{className:"jp-agent-empty-hint"},"agent"===P?'ë…¸íŠ¸ë¶ ì‘ì—…ì„ ìì—°ì–´ë¡œ ìš”ì²­í•˜ì„¸ìš”. ì˜ˆ: "ë°ì´í„° ì‹œê°í™” í•´ì¤˜"':"ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ Agent ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.")):o.map(e=>X(e)?l().createElement("div",{key:e.id,className:`jp-agent-message jp-agent-message-${e.role}`},l().createElement("div",{className:"jp-agent-message-header"},l().createElement("span",{className:"jp-agent-message-role"},"user"===e.role?"ì‚¬ìš©ì":"Agent"),l().createElement("span",{className:"jp-agent-message-time"},new Date(e.timestamp).toLocaleTimeString())),l().createElement("div",{className:"jp-agent-message-content"+(g===e.id?" streaming":"")},"assistant"===e.role?l().createElement("div",{className:"jp-RenderedHTMLCommon",style:{padding:"0 5px"},dangerouslySetInnerHTML:{__html:w(e.content)}}):l().createElement("div",{style:{whiteSpace:"pre-wrap"}},e.content))):l().createElement("div",{key:e.id,className:"jp-agent-message jp-agent-message-agent-execution"},(e=>{const{status:t,plan:n,result:o,completedSteps:a,failedSteps:s,request:r}=e,i=["planning","executing","tool_calling","self_healing","replanning","validating","reflecting"].includes(t.phase),c=n?a.length/n.totalSteps*100:0;return l().createElement("div",{className:"jp-agent-execution-message"},l().createElement("div",{className:"jp-agent-execution-header"},l().createElement("div",{className:"jp-agent-execution-badge"},l().createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor",width:"12",height:"12"},l().createElement("path",{d:"M8 0a8 8 0 100 16A8 8 0 008 0zm0 14.5a6.5 6.5 0 110-13 6.5 6.5 0 010 13z"}),l().createElement("path",{d:"M8 3a.75.75 0 01.75.75v3.5h2.5a.75.75 0 010 1.5h-3.25a.75.75 0 01-.75-.75v-4.25A.75.75 0 018 3z"})),"Agent"),l().createElement("span",{className:"jp-agent-execution-request"},r)),l().createElement("div",{className:`jp-agent-execution-status jp-agent-execution-status--${t.phase}`},i&&l().createElement("div",{className:"jp-agent-execution-spinner"}),"completed"===t.phase&&l().createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor",className:"jp-agent-execution-icon--success"},l().createElement("path",{d:"M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"})),"failed"===t.phase&&l().createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor",className:"jp-agent-execution-icon--error"},l().createElement("path",{d:"M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"})),l().createElement("span",{className:"jp-agent-execution-status-text"},t.message||t.phase)),n&&l().createElement("div",{className:"jp-agent-execution-plan"},l().createElement("div",{className:"jp-agent-execution-plan-header"},l().createElement("span",null,"ì‹¤í–‰ ê³„íš"),l().createElement("span",{className:"jp-agent-execution-plan-progress"},a.length," / ",n.totalSteps)),l().createElement("div",{className:"jp-agent-execution-progress-bar"},l().createElement("div",{className:"jp-agent-execution-progress-fill",style:{width:`${c}%`}})),l().createElement("div",{className:"jp-agent-execution-steps"},n.steps.map(e=>{const n=(o=e.stepNumber,s.includes(o)?"failed":a.includes(o)?"completed":t.currentStep===o?"current":"pending");var o;return l().createElement("div",{key:e.stepNumber,className:`jp-agent-execution-step jp-agent-execution-step--${n}`,ref:e=>{"current"===n&&e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}},l().createElement("div",{className:"jp-agent-execution-step-indicator"},"completed"===n&&l().createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor"},l().createElement("path",{d:"M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"})),"failed"===n&&l().createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor"},l().createElement("path",{d:"M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"})),"current"===n&&l().createElement("div",{className:"jp-agent-execution-step-spinner"}),"pending"===n&&l().createElement("span",null,e.stepNumber)),l().createElement("div",{className:"jp-agent-execution-step-content"},l().createElement("span",{className:"jp-agent-execution-step-desc "+("completed"===n?"jp-agent-execution-step-desc--done":"")},e.description),l().createElement("div",{className:"jp-agent-execution-step-tools"},e.toolCalls.map((e,t)=>l().createElement("span",{key:t,className:"jp-agent-execution-tool-tag"},e.tool)))))}))),o&&l().createElement("div",{className:"jp-agent-execution-result jp-agent-execution-result--"+(o.success?"success":"error")},o.finalAnswer&&l().createElement("div",{className:"jp-agent-execution-result-message jp-RenderedHTMLCommon",dangerouslySetInnerHTML:{__html:w(o.finalAnswer)}}),o.error&&l().createElement("p",{className:"jp-agent-execution-result-error"},o.error),l().createElement("div",{className:"jp-agent-execution-result-stats"},l().createElement("span",null,o.createdCells.length,"ê°œ ì…€ ìƒì„±"),l().createElement("span",null,o.modifiedCells.length,"ê°œ ì…€ ìˆ˜ì •"),o.executionTime&&l().createElement("span",null,(o.executionTime/1e3).toFixed(1),"ì´ˆ"))))})(e))),d&&!u&&!S&&l().createElement("div",{className:"jp-agent-message jp-agent-message-assistant"},l().createElement("div",{className:"jp-agent-message-header"},l().createElement("span",{className:"jp-agent-message-role"},"Agent")),l().createElement("div",{className:"jp-agent-message-content jp-agent-loading"},l().createElement("span",{className:"jp-agent-loading-dot"},"."),l().createElement("span",{className:"jp-agent-loading-dot"},"."),l().createElement("span",{className:"jp-agent-loading-dot"},"."))),l().createElement("div",{ref:I})),l().createElement("div",{className:"jp-agent-input-container"},l().createElement("div",{className:"jp-agent-input-wrapper"},l().createElement("textarea",{className:"jp-agent-input "+("agent"===P?"jp-agent-input--agent-mode":""),value:s,onChange:e=>i(e.target.value),onKeyDown:e=>{if("Enter"!==e.key||e.shiftKey||(e.preventDefault(),G()),"Tab"===e.key&&e.shiftKey)return e.preventDefault(),void $(e=>"chat"===e?"agent":"chat");"."===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),$(e=>"chat"===e?"agent":"chat")),"Tab"!==e.key||e.shiftKey||"agent"!==P||(e.preventDefault(),M(e=>!e))},placeholder:"agent"===P?"ë…¸íŠ¸ë¶ ì‘ì—…ì„ ì…ë ¥í•˜ì„¸ìš”... (ì˜ˆ: ë°ì´í„° ì‹œê°í™” í•´ì¤˜)":"ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...",rows:3,disabled:d||S}),l().createElement("button",{className:"jp-agent-send-button",onClick:G,disabled:!s.trim()||d||u||S,title:"ì „ì†¡ (Enter)"},S?"ì‹¤í–‰ ì¤‘...":"ì „ì†¡")),l().createElement("div",{className:"jp-agent-mode-bar"},l().createElement("div",{className:"jp-agent-mode-toggle-container"},l().createElement("button",{className:"jp-agent-mode-toggle "+("agent"===P?"jp-agent-mode-toggle--active":""),onClick:()=>{$(e=>"chat"===e?"agent":"chat"),M(!1)},title:("agent"===P?"Agent":"Chat")+" ëª¨ë“œ (â‡§Tab)"},l().createElement("svg",{className:"jp-agent-mode-icon",viewBox:"0 0 16 16",fill:"currentColor",width:"14",height:"14"},"agent"===P?l().createElement("path",{d:"M4.5 8c0-1.38 1.12-2.5 2.5-2.5.9 0 1.68.48 2.12 1.2L8 8l1.12 1.3c-.44.72-1.22 1.2-2.12 1.2-1.38 0-2.5-1.12-2.5-2.5zm6.88 1.3c.44-.72 1.22-1.2 2.12-1.2 1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5c-.9 0-1.68-.48-2.12-1.2L12.5 10.6c.3.24.68.4 1.1.4.83 0 1.5-.67 1.5-1.5S14.43 8 13.6 8c-.42 0-.8.16-1.1.4l-1.12 1.3zM7 9.5c-.42 0-.8-.16-1.1-.4L4.78 7.8c-.44.72-1.22 1.2-2.12 1.2C1.28 9 .17 7.88.17 6.5S1.29 4 2.67 4c.9 0 1.68.48 2.12 1.2L5.9 6.5c-.3-.24-.68-.4-1.1-.4C3.97 6.1 3.3 6.77 3.3 7.6s.67 1.5 1.5 1.5c.42 0 .8-.16 1.1-.4l1.12-1.3L8 8l-1 1.5z"}):l().createElement("path",{d:"M8 1C3.58 1 0 4.13 0 8c0 1.5.5 2.88 1.34 4.04L.5 15l3.37-.92A8.56 8.56 0 008 15c4.42 0 8-3.13 8-7s-3.58-7-8-7zM4.5 9a1 1 0 110-2 1 1 0 010 2zm3.5 0a1 1 0 110-2 1 1 0 010 2zm3.5 0a1 1 0 110-2 1 1 0 010 2z"})),l().createElement("span",{className:"jp-agent-mode-label"},"agent"===P?"Agent":"Chat"),l().createElement("svg",{className:"jp-agent-mode-chevron",viewBox:"0 0 16 16",fill:"currentColor",width:"12",height:"12"},l().createElement("path",{d:"M4.47 5.47a.75.75 0 011.06 0L8 7.94l2.47-2.47a.75.75 0 111.06 1.06l-3 3a.75.75 0 01-1.06 0l-3-3a.75.75 0 010-1.06z"}))),_&&l().createElement("div",{className:"jp-agent-mode-dropdown"},l().createElement("button",{className:"jp-agent-mode-option "+("chat"===P?"jp-agent-mode-option--selected":""),onClick:()=>{$("chat"),M(!1)}},l().createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor",width:"14",height:"14"},l().createElement("path",{d:"M8 1C3.58 1 0 4.13 0 8c0 1.5.5 2.88 1.34 4.04L.5 15l3.37-.92A8.56 8.56 0 008 15c4.42 0 8-3.13 8-7s-3.58-7-8-7zM4.5 9a1 1 0 110-2 1 1 0 010 2zm3.5 0a1 1 0 110-2 1 1 0 010 2zm3.5 0a1 1 0 110-2 1 1 0 010 2z"})),l().createElement("span",null,"Chat"),l().createElement("span",{className:"jp-agent-mode-shortcut"},"ì¼ë°˜ ëŒ€í™”")),l().createElement("button",{className:"jp-agent-mode-option "+("agent"===P?"jp-agent-mode-option--selected":""),onClick:()=>{$("agent"),M(!1)}},l().createElement("svg",{viewBox:"0 0 16 16",fill:"currentColor",width:"14",height:"14"},l().createElement("path",{d:"M4.5 8c0-1.38 1.12-2.5 2.5-2.5.9 0 1.68.48 2.12 1.2L8 8l1.12 1.3c-.44.72-1.22 1.2-2.12 1.2-1.38 0-2.5-1.12-2.5-2.5z"})),l().createElement("span",null,"Agent"),l().createElement("span",{className:"jp-agent-mode-shortcut"},"ë…¸íŠ¸ë¶ ìë™ ì‹¤í–‰")))),l().createElement("div",{className:"jp-agent-mode-hints"},l().createElement("span",{className:"jp-agent-mode-hint"},"â‡§Tab ëª¨ë“œ ì „í™˜")))))});k.displayName="ChatPanel";class S extends i.ReactWidget{constructor(e,t){super(),this.chatPanelRef=l().createRef(),this.apiService=e,this.notebookTracker=t,this.id="hdsp-agent-panel",this.title.caption="HDSP Agent Assistant",this.title.icon=E,this.addClass("jp-agent-widget")}render(){return l().createElement(k,{ref:this.chatPanelRef,apiService:this.apiService,notebookTracker:this.notebookTracker})}addCellActionMessage(e,t,n,o,a,s){console.log("[AgentPanel] Cell action:",e),console.log("[AgentPanel] Display prompt:",n),console.log("[AgentPanel] LLM prompt:",o),console.log("[AgentPanel] Cell ID:",a),console.log("[AgentPanel] Cell Index:",s),this.chatPanelRef.current?(void 0!==s&&this.chatPanelRef.current.setCurrentCellIndex&&this.chatPanelRef.current.setCurrentCellIndex(s),a&&this.chatPanelRef.current.setCurrentCellId&&this.chatPanelRef.current.setCurrentCellId(a),this.chatPanelRef.current.setInput(n),this.chatPanelRef.current.setLlmPrompt(o),setTimeout(()=>{this.chatPanelRef.current&&this.chatPanelRef.current.handleSendMessage().catch(e=>{console.error("[AgentPanel] Failed to send message automatically:",e)})},100)):console.error("[AgentPanel] ChatPanel ref not available")}analyzeNotebook(e,t){if(console.log("[AgentPanel] analyzeNotebook called with",e.length,"cells"),!this.chatPanelRef.current)return console.error("[AgentPanel] ChatPanel ref not available"),void t();const n=e.length,o=`ì „ì²´ ë…¸íŠ¸ë¶ ê²€ìˆ˜ ìš”ì²­ (${n}ê°œ ì…€)`;let a=`ë‹¤ìŒì€ ì €ì¥í•˜ê¸° ì „ì˜ Jupyter ë…¸íŠ¸ë¶ ì „ì²´ ë‚´ìš©ì…ë‹ˆë‹¤. ëª¨ë“  ì…€ì„ ê²€í† í•˜ê³  ê°œì„  ì‚¬í•­ì„ ì œì•ˆí•´ì£¼ì„¸ìš”.\n\n## ë…¸íŠ¸ë¶ ìš”ì•½\n- ì „ì²´ ì…€ ìˆ˜: ${n}ê°œ\n- ì—ëŸ¬ê°€ ìˆëŠ” ì…€: ${e.filter(e=>e.output&&(e.output.includes("Error")||e.output.includes("Traceback")||e.output.includes("Exception"))).length}ê°œ\n- Importê°€ ìˆëŠ” ì…€: ${e.filter(e=>e.imports&&e.imports.length>0).length}ê°œ\n- ë¡œì»¬ ëª¨ë“ˆ import: ${e.reduce((e,t)=>t.imports?e+t.imports.filter(e=>e.isLocal).length:e,0)}ê°œ\n\n## ì „ì²´ ì…€ ë‚´ìš©\n\n`;e.forEach((e,t)=>{a+=`### ì…€ ${t+1} (ID: ${e.id})\n\`\`\`python\n${e.content}\n\`\`\`\n`,e.output&&(a+=`\n**ì‹¤í–‰ ê²°ê³¼:**\n\`\`\`\n${e.output}\n\`\`\`\n`),e.imports&&e.imports.length>0&&(a+="\n**Imports:**\n",e.imports.forEach(e=>{a+=`- \`${e.module}\` (${e.isLocal?"ë¡œì»¬":"í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬"})\n`})),a+="\n---\n\n"}),a+="\n## ê²€ìˆ˜ ìš”ì²­ ì‚¬í•­\n\në‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:\n\n### 1. ì „ë°˜ì ì¸ ì½”ë“œ í’ˆì§ˆ í‰ê°€\n(ë…¸íŠ¸ë¶ ì „ì²´ì˜ ì½”ë“œ í’ˆì§ˆ, êµ¬ì¡°, ì¼ê´€ì„± ë“±ì„ í‰ê°€)\n\n### 2. ë°œê²¬ëœ ì£¼ìš” ì´ìŠˆ\n(ì—ëŸ¬, ê²½ê³ , ì ì¬ì  ë¬¸ì œì  ë“±ì„ ë‚˜ì—´)\n\n### 3. ì…€ë³„ ê°œì„  ì œì•ˆ\nê° ì…€ì— ëŒ€í•´ êµ¬ì²´ì ì¸ ê°œì„  ì‚¬í•­ì´ ìˆë‹¤ë©´:\n- **ì…€ X**: (ê°œì„  ì‚¬í•­)\n  ```python\n  (ê°œì„ ëœ ì½”ë“œ)\n  ```\n\n### 4. ì „ë°˜ì ì¸ ê°œì„  ê¶Œì¥ì‚¬í•­\n(ë…¸íŠ¸ë¶ ì „ì²´ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•œ ì¼ë°˜ì ì¸ ì œì•ˆ)\n\n### 5. ì €ì¥ ê¶Œì¥ ì—¬ë¶€\n- âœ… **ì €ì¥ ê¶Œì¥**: (ì´ìœ )\n- âš ï¸ **ìˆ˜ì • í›„ ì €ì¥ ê¶Œì¥**: (ì´ìœ )\n- âŒ **ì €ì¥ ë¹„ê¶Œì¥**: (ì´ìœ )\n",this.chatPanelRef.current.setInput(o),this.chatPanelRef.current.setLlmPrompt(a),setTimeout(()=>{this.chatPanelRef.current&&this.chatPanelRef.current.handleSendMessage().catch(e=>{console.error("[AgentPanel] Failed to send message automatically:",e)}).finally(()=>{console.log("[AgentPanel] Analysis complete, executing onComplete callback"),t()})},100)}}const L="hdsp-agent:toggle-sidebar",j={id:"@hdsp-agent/sidebar",autoStart:!0,requires:[],optional:[o.ILayoutRestorer,a.ICommandPalette,s.INotebookTracker],activate:(e,t,n,o)=>{console.log("[SidebarPlugin] Activating Jupyter Agent Sidebar");try{const s=new p,r=new S(s,o);if(t){const e=new a.WidgetTracker({namespace:"hdsp-agent"});e.add(r),t.restore(e,{command:L,name:()=>"hdsp-agent"})}e.shell.add(r,"right",{rank:100}),e.commands.addCommand(L,{label:"HALO Agent ì‚¬ì´ë“œë°” í† ê¸€",caption:"HALO Agent íŒ¨ë„ í‘œì‹œ/ìˆ¨ê¸°ê¸°",execute:()=>{r.isVisible?r.close():e.shell.activateById(r.id)}}),n&&n.addItem({command:L,category:"HALO Agent",args:{}}),window._hdspAgentPanel=r,console.log("[SidebarPlugin] HALO Agent Sidebar activated successfully")}catch(e){console.error("[SidebarPlugin] Failed to activate:",e)}}};var N,A;!function(e){e.EXPLAIN="explain",e.FIX="fix",e.CUSTOM_PROMPT="custom_prompt"}(N||(N={})),function(e){e.CELL_ACTION="hdsp-agent:cell-action",e.CONFIG_CHANGED="hdsp-agent:config-changed",e.MESSAGE_SENT="hdsp-agent:message-sent",e.MESSAGE_RECEIVED="hdsp-agent:message-received"}(A||(A={}));const T={id:"@hdsp-agent/cell-buttons",autoStart:!0,requires:[s.INotebookTracker],activate:(e,t)=>{console.log("[CellButtonsPlugin] Activated"),window.jupyterapp=e,t.widgetAdded.connect((e,t)=>{console.log("[CellButtonsPlugin] Notebook widget added:",t.id),t.sessionContext.ready.then(()=>{P(t)}).catch(e=>{console.error("[CellButtonsPlugin] Error waiting for session:",e)})}),t.currentWidget&&P(t.currentWidget),t.currentChanged.connect((e,t)=>{t&&P(t)})}};function P(e){const t=e.content;setTimeout(()=>{$(t,e),setTimeout(()=>{$(t,e)},500)},200);const n=()=>{setTimeout(()=>{$(t,e)},100)};try{t.model?.cells.changed.disconnect(n)}catch{}t.model?.cells.changed.connect(n)}function $(e,t){for(let t=0;t<e.widgets.length;t++)_(e.widgets[t])}function _(e,t){if(!e||!e.model)return;const n=e.node;if(!n||!n.classList.contains("jp-Cell"))return;if(n.querySelector(".jp-hdsp-cell-buttons"))return;const o=n.querySelector(".jp-InputPrompt, .jp-OutputPrompt"),a=o?o.getBoundingClientRect().width:64,s=n.querySelector(".jp-Cell-inputWrapper");if(!s)return;const r=document.createElement("div");r.className="jp-hdsp-cell-buttons",r.style.cssText=`\n    display: flex;\n    gap: 4px;\n    padding: 4px 8px;\n    padding-left: ${a}px;\n    background: transparent;\n  `;const l=M("E","ì„¤ëª… ìš”ì²­",()=>{I(N.EXPLAIN,e)}),i=M("F","ìˆ˜ì • ì œì•ˆ ìš”ì²­",()=>{I(N.FIX,e)}),c=M("?","ì§ˆë¬¸í•˜ê¸°",()=>{I(N.CUSTOM_PROMPT,e)});r.appendChild(l),r.appendChild(i),r.appendChild(c),s.parentNode?.insertBefore(r,s)}function M(e,t,n){const o=document.createElement("button");return o.className="jp-agent-button",o.textContent=e,o.title=t,o.setAttribute("aria-label",t),o.onclick=n,o.style.cssText="\n    width: 24px !important;\n    height: 24px !important;\n    border: 1px solid #ddd !important;\n    border-radius: 4px !important;\n    background: white !important;\n    cursor: pointer !important;\n    display: inline-flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    font-size: 12px !important;\n    font-weight: bold !important;\n    color: #333 !important;\n    padding: 0 !important;\n    margin: 0 2px !important;\n    opacity: 1 !important;\n    visibility: visible !important;\n  ",o}async function I(e,t){const n=t?.model?.sharedModel?.getSource()||"";if(!n.trim())return void Z("ì…€ ë‚´ìš©ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.","warning");const o=O(t);if(e===N.CUSTOM_PROMPT)!function(e){const t=e?.model?.sharedModel?.getSource()||"",n=O(e),o=F(e);console.log("ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ",n,o),z("jp-agent-custom-prompt-dialog");const a=D("jp-agent-custom-prompt-dialog"),s=B("500px");s.innerHTML=`\n    <div style="margin-bottom: 20px;">\n      <h3 style="margin: 0 0 8px 0; color: #424242; font-size: 16px; font-weight: 500;">\n        ì…€ì— ëŒ€í•´ ì§ˆë¬¸í•˜ê¸°\n      </h3>\n      <p style="margin: 0; color: #757575; font-size: 13px;">\n        ë¬¼ë¦¬ì  ìœ„ì¹˜: ì…€ ${n+1}ë²ˆì§¸ (ìœ„ì—ì„œ ì•„ë˜ë¡œ ì¹´ìš´íŠ¸)\n      </p>\n    </div>\n    <div style="margin-bottom: 20px;">\n      <textarea class="jp-agent-custom-prompt-input"\n        placeholder="ì´ ì…€ì— ëŒ€í•´ ì§ˆë¬¸í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."\n        style="\n          width: 100%;\n          min-height: 100px;\n          padding: 12px;\n          border: 1px solid #d1d5db;\n          border-radius: 4px;\n          font-size: 14px;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n          resize: vertical;\n          box-sizing: border-box;\n        "\n      ></textarea>\n    </div>\n    <div style="display: flex; gap: 12px; justify-content: flex-end;">\n      <button class="jp-agent-custom-prompt-cancel-btn" style="\n        background: transparent;\n        color: #616161;\n        border: 1px solid #d1d5db;\n        border-radius: 3px;\n        padding: 8px 16px;\n        font-size: 13px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n      ">ì·¨ì†Œ</button>\n      <button class="jp-agent-custom-prompt-submit-btn" style="\n        background: transparent;\n        color: #1976d2;\n        border: 1px solid #1976d2;\n        border-radius: 3px;\n        padding: 8px 16px;\n        font-size: 13px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.15s ease;\n      ">ì§ˆë¬¸</button>\n    </div>\n  `,a.appendChild(s),document.body.appendChild(a);const r=s.querySelector(".jp-agent-custom-prompt-input");setTimeout(()=>r?.focus(),100);const l=s.querySelector(".jp-agent-custom-prompt-cancel-btn"),i=s.querySelector(".jp-agent-custom-prompt-submit-btn");l.addEventListener("click",()=>{a.remove()}),l.addEventListener("mouseenter",()=>{l.style.background="#f5f5f5",l.style.borderColor="#9ca3af"}),l.addEventListener("mouseleave",()=>{l.style.background="transparent",l.style.borderColor="#d1d5db"});const c=async()=>{const s=r?.value.trim()||"";if(!s)return void Z("ì§ˆë¬¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.","warning");a.remove();const l=R(e),i=`${n}ë²ˆì§¸ ì…€: ${s}`;let c=`${s}\n\nì…€ ë‚´ìš©:\n\`\`\`\n${t}\n\`\`\``;l&&(c+=`\n\nì‹¤í–‰ ê²°ê³¼:\n\`\`\`\n${l}\n\`\`\``);const d=window._hdspAgentPanel;if(d){const e=window.jupyterapp;if(e&&e.shell.activateById(d.id),d.addCellActionMessage){const e=n-1;d.addCellActionMessage(N.CUSTOM_PROMPT,t,i,c,o,e)}}};i.addEventListener("click",c),i.addEventListener("mouseenter",()=>{i.style.background="rgba(25, 118, 210, 0.1)"}),i.addEventListener("mouseleave",()=>{i.style.background="transparent"}),r?.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),c())}),a.addEventListener("click",e=>{e.target===a&&a.remove()});const d=e=>{"Escape"===e.key&&(a.remove(),document.removeEventListener("keydown",d))};document.addEventListener("keydown",d)}(t);else{const a=R(t);let s="",r="";switch(e){case N.EXPLAIN:s=`ì…€ ${o}ë²ˆì§¸: ì„¤ëª… ìš”ì²­`,r="ì´ ì…€ì˜ ì½”ë“œ ì„¤ëª…ì„ ë³´ì‹œê² ìŠµë‹ˆê¹Œ?";break;case N.FIX:s=`ì…€ ${o}ë²ˆì§¸: ìˆ˜ì • ì œì•ˆ ìš”ì²­`,r="ì´ ì…€ì˜ ì½”ë“œ ê°œì„  ì œì•ˆì„ ë°›ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?"}const l=await function(e,t){return new Promise(n=>{z("jp-agent-confirm-dialog");const o=D("jp-agent-confirm-dialog"),a=B();a.innerHTML=`\n      <div style="margin-bottom: 20px;">\n        <h3 style="margin: 0 0 12px 0; color: #424242; font-size: 16px; font-weight: 500;">\n          ${H(e)}\n        </h3>\n        <p style="margin: 0; color: #616161; font-size: 14px; line-height: 1.5;">\n          ${H(t)}\n        </p>\n      </div>\n      <div style="display: flex; gap: 12px; justify-content: flex-end;">\n        <button class="jp-agent-confirm-cancel-btn" style="\n          background: transparent;\n          color: #616161;\n          border: 1px solid #d1d5db;\n          border-radius: 3px;\n          padding: 8px 16px;\n          font-size: 13px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.15s ease;\n        ">ì·¨ì†Œ</button>\n        <button class="jp-agent-confirm-submit-btn" style="\n          background: #1976d2;\n          color: white;\n          border: 1px solid #1976d2;\n          border-radius: 3px;\n          padding: 8px 16px;\n          font-size: 13px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.15s ease;\n        ">í™•ì¸</button>\n      </div>\n    `,o.appendChild(a),document.body.appendChild(o);const s=a.querySelector(".jp-agent-confirm-cancel-btn"),r=a.querySelector(".jp-agent-confirm-submit-btn");s.addEventListener("click",()=>{o.remove(),n(!1)}),s.addEventListener("mouseenter",()=>{s.style.background="#f5f5f5"}),s.addEventListener("mouseleave",()=>{s.style.background="transparent"}),r.addEventListener("click",()=>{r.disabled=!0,r.textContent="ì²˜ë¦¬ ì¤‘...",setTimeout(()=>{o.remove(),n(!0)},100)}),r.addEventListener("mouseenter",()=>{r.disabled||(r.style.background="#1565c0")}),r.addEventListener("mouseleave",()=>{r.disabled||(r.style.background="#1976d2")});const l=e=>{"Escape"===e.key&&(o.remove(),document.removeEventListener("keydown",l),n(!1))};document.addEventListener("keydown",l),o.addEventListener("click",e=>{e.target===o&&(o.remove(),document.removeEventListener("keydown",l),n(!1))})})}(s,r);l&&function(e,t,n,o,a){const s=window._hdspAgentPanel;if(!s)return void console.error("[CellButtonsPlugin] Agent panel not found. Make sure sidebar plugin is loaded.");const r=F(t),l=window.jupyterapp;l&&l.shell.activateById(s.id);let i="",c="";switch(e){case N.EXPLAIN:i=`${o}ë²ˆì§¸ ì…€: ì„¤ëª… ìš”ì²­`,c=`ë‹¤ìŒ Jupyter ì…€ì˜ ë‚´ìš©ì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”:\n\n\`\`\`python\n${n}\n\`\`\``;break;case N.FIX:a&&(a.includes("Error")||a.includes("Traceback")||a.includes("Exception")||a.includes("ì—ëŸ¬")||a.includes("ì˜¤ë¥˜"))&&a?(i=`${o}ë²ˆì§¸ ì…€: ì—ëŸ¬ ìˆ˜ì • ìš”ì²­`,c=`ë‹¤ìŒ Jupyter ì…€ ì½”ë“œì— ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì›ë³¸ ì½”ë“œ:\n\`\`\`python\n${n}\n\`\`\`\n\nì—ëŸ¬:\n\`\`\`\n${a}\n\`\`\`\n\në‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:\n\n## ì—ëŸ¬ ì›ì¸\n(ì—ëŸ¬ê°€ ë°œìƒí•œ ì›ì¸ì„ ê°„ë‹¨íˆ ì„¤ëª…)\n\n## ìˆ˜ì • ë°©ë²•\n\n### ë°©ë²• 1: (ìˆ˜ì • ë°©ë²• ì œëª©)\n(ì´ ë°©ë²•ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…)\n\`\`\`python\n(ìˆ˜ì •ëœ ì½”ë“œ)\n\`\`\`\n\n### ë°©ë²• 2: (ìˆ˜ì • ë°©ë²• ì œëª©)\n(ì´ ë°©ë²•ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…)\n\`\`\`python\n(ìˆ˜ì •ëœ ì½”ë“œ)\n\`\`\`\n\n### ë°©ë²• 3: (ìˆ˜ì • ë°©ë²• ì œëª©) (ìˆëŠ” ê²½ìš°)\n(ì´ ë°©ë²•ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…)\n\`\`\`python\n(ìˆ˜ì •ëœ ì½”ë“œ)\n\`\`\`\n\nìµœì†Œ 2ê°œ, ìµœëŒ€ 3ê°œì˜ ë‹¤ì–‘í•œ ìˆ˜ì • ë°©ë²•ì„ ì œì•ˆí•´ì£¼ì„¸ìš”.`):(i=`${o}ë²ˆì§¸ ì…€: ê°œì„  ì œì•ˆ ìš”ì²­`,c=`ë‹¤ìŒ Jupyter ì…€ ì½”ë“œë¥¼ ë¦¬ë·°í•˜ê³  ê°œì„  ë°©ë²•ì„ ì œì•ˆí•´ì£¼ì„¸ìš”.\n\nì½”ë“œ:\n\`\`\`python\n${n}\n\`\`\`\n\në‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:\n\n## ì½”ë“œ ë¶„ì„\n(í˜„ì¬ ì½”ë“œì˜ ê¸°ëŠ¥ê³¼ íŠ¹ì§•ì„ ê°„ë‹¨íˆ ì„¤ëª…)\n\n## ê°œì„  ë°©ë²•\n\n### ë°©ë²• 1: (ê°œì„  ë°©ë²• ì œëª©)\n(ì´ ë°©ë²•ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…)\n\`\`\`python\n(ê°œì„ ëœ ì½”ë“œ)\n\`\`\`\n\n### ë°©ë²• 2: (ê°œì„  ë°©ë²• ì œëª©)\n(ì´ ë°©ë²•ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…)\n\`\`\`python\n(ê°œì„ ëœ ì½”ë“œ)\n\`\`\`\n\n### ë°©ë²• 3: (ê°œì„  ë°©ë²• ì œëª©) (ìˆëŠ” ê²½ìš°)\n(ì´ ë°©ë²•ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…)\n\`\`\`python\n(ê°œì„ ëœ ì½”ë“œ)\n\`\`\`\n\nìµœì†Œ 2ê°œ, ìµœëŒ€ 3ê°œì˜ ë‹¤ì–‘í•œ ê°œì„  ë°©ë²•ì„ ì œì•ˆí•´ì£¼ì„¸ìš”.`)}if(s.addCellActionMessage){const t=o-1;s.addCellActionMessage(e,n,i,c,r,t)}}(e,t,n,o,a)}}function O(e){const t=window.jupyterapp,n=t?.shell?.currentWidget?.content;if(!n)return-1;const o=n.widgets;for(let t=0;t<o.length;t++)if(o[t]===e)return t+1;return-1}function R(e){if(!e?.model||"code"!==e.model.type)return"";const t=e,n=t.model?.outputs;if(!n||0===n.length)return"";const o=[];for(let e=0;e<n.length;e++){const t=n.get(e),a=t.type;if("stream"===a){const e=t.text;Array.isArray(e)?o.push(e.join("")):o.push(e)}else if("execute_result"===a||"display_data"===a){const e=t.data;if(e["text/plain"]){const t=e["text/plain"];Array.isArray(t)?o.push(t.join("")):o.push(t)}}else if("error"===a){const e=t.traceback;Array.isArray(e)&&o.push(e.join("\n"))}}return o.join("\n")}function F(e){const t=e.model;let n;try{t.metadata&&"function"==typeof t.metadata.get?n=t.metadata.get("jupyterAgentCellId"):t.metadata?.jupyterAgentCellId&&(n=t.metadata.jupyterAgentCellId)}catch(e){}if(!n){n=`cell-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{t.metadata&&"function"==typeof t.metadata.set?t.metadata.set("jupyterAgentCellId",n):t.metadata&&(t.metadata.jupyterAgentCellId=n)}catch(e){}}return n}function z(e){const t=document.querySelector(`.${e}`);t&&t.remove()}function D(e){const t=document.createElement("div");return t.className=e,t.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.3);\n    z-index: 10000;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  ",t}function B(e="400px"){const t=document.createElement("div");return t.style.cssText=`\n    background: #fafafa;\n    border: 1px solid #e0e0e0;\n    border-radius: 4px;\n    padding: 24px;\n    max-width: ${e};\n    width: 90%;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  `,t}function H(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Z(e,t="info"){const n=function(e,t){const n=document.createElement("div");return n.style.cssText=`\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    padding: 12px 16px;\n    border-radius: 6px;\n    color: white;\n    font-size: 14px;\n    font-weight: 500;\n    z-index: 10001;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    max-width: 300px;\n    word-wrap: break-word;\n    background: ${t};\n  `,n.textContent=e,n}(e,function(e){switch(e){case"error":return"#f56565";case"warning":return"#ed8936";default:return"#4299e1"}}(t));document.body.appendChild(n),function(e){setTimeout(()=>e.style.opacity="1",10),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)},3e3)}(n)}var q=n(8477),W=n(3070),U=n(1247),K=n(6661),V=n(561),J=n(4848);const G=(0,V.A)((0,J.jsx)("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.996.996 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixHigh"),X=["íƒ€ì´íƒ€ë‹‰ ìƒì¡´ì ì˜ˆì¸¡ì„ daskì™€ lgbmìœ¼ë¡œ ìƒì„±í•´ì¤˜","ì£¼ì‹ ë°ì´í„° ë¶„ì„ ë° ì‹œê°í™” ë…¸íŠ¸ë¶ ë§Œë“¤ì–´ì¤˜","Iris ë°ì´í„°ì…‹ìœ¼ë¡œ ë¶„ë¥˜ ëª¨ë¸ í•™ìŠµí•˜ê¸°","ì‹œê³„ì—´ ë°ì´í„° ë¶„ì„ ë° ì˜ˆì¸¡ ëª¨ë¸ ë§Œë“¤ê¸°"],Q=({open:e,onClose:t,onGenerate:n})=>{const[o,a]=(0,r.useState)(""),[s,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(0),[p,u]=(0,r.useState)(""),m=()=>{o.trim()&&(i(!0),n(o.trim()),a(""),i(!1),t())};return l().createElement(K.Dialog,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2,minHeight:"400px"}}},l().createElement(K.DialogTitle,null,l().createElement(K.Box,{display:"flex",alignItems:"center",gap:1},l().createElement(G,{color:"primary"}),l().createElement(K.Typography,{variant:"h6"},"HALO í”„ë¡¬í”„íŠ¸ë¡œ ë…¸íŠ¸ë¶ ìƒì„±"))),l().createElement(K.DialogContent,null,l().createElement(K.Box,{display:"flex",flexDirection:"column",gap:2,mt:1},l().createElement(K.Typography,{variant:"body2",color:"text.secondary"},"ì›í•˜ëŠ” ë…¸íŠ¸ë¶ì˜ ë‚´ìš©ì„ ìì—°ì–´ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”. AIê°€ ìë™ìœ¼ë¡œ ë…¸íŠ¸ë¶ì„ ìƒì„±í•©ë‹ˆë‹¤."),l().createElement(K.TextField,{autoFocus:!0,multiline:!0,rows:6,fullWidth:!0,variant:"outlined",placeholder:"ì˜ˆ: íƒ€ì´íƒ€ë‹‰ ìƒì¡´ì ì˜ˆì¸¡ì„ daskì™€ lgbmìœ¼ë¡œ ìƒì„±í•´ì¤˜",value:o,onChange:e=>a(e.target.value),onKeyPress:e=>{"Enter"===e.key&&e.ctrlKey&&m()},disabled:s,sx:{"& .MuiOutlinedInput-root":{fontSize:"14px"}}}),l().createElement(K.Box,null,l().createElement(K.Typography,{variant:"caption",color:"text.secondary",display:"block",mb:1},"ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ (í´ë¦­í•˜ì—¬ ì‚¬ìš©):"),l().createElement(K.Box,{display:"flex",flexWrap:"wrap",gap:1},X.map((e,t)=>l().createElement(K.Chip,{key:t,label:e,variant:"outlined",size:"small",onClick:()=>(e=>{a(e)})(e),sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}}})))),l().createElement(K.Box,{sx:{backgroundColor:"action.hover",borderRadius:1,padding:2}},l().createElement(K.Typography,{variant:"caption",color:"text.secondary"},"ğŸ’¡ ",l().createElement("strong",null,"íŒ:"),l().createElement("br",null),"â€¢ ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ëª…ì‹œí•˜ë©´ ë” ì •í™•í•©ë‹ˆë‹¤",l().createElement("br",null),"â€¢ ë¶„ì„ ëª©ì ê³¼ ë°ì´í„°ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”",l().createElement("br",null),"â€¢ Ctrl + Enterë¡œ ë¹ ë¥´ê²Œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤",l().createElement("br",null),"â€¢ ìƒì„±ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì§„í–‰ë˜ë©°, ì™„ë£Œë˜ë©´ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤")))),l().createElement(K.DialogActions,{sx:{padding:2,paddingTop:0}},l().createElement(K.Button,{onClick:t,disabled:s},"ì·¨ì†Œ"),l().createElement(K.Button,{onClick:m,variant:"contained",disabled:!o.trim()||s,startIcon:l().createElement(G,null)},"ìƒì„± ì‹œì‘")))},Y=(0,V.A)((0,J.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),ee=(0,V.A)((0,J.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),te=(0,V.A)((0,J.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),ne=(0,V.A)((0,J.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),oe=(0,V.A)((0,J.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),ae=(0,V.A)((0,J.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),se=({taskStatus:e,onClose:t,onCancel:n,onOpenNotebook:o})=>{const[a,s]=(0,r.useState)(!0),[i,c]=(0,r.useState)(!1),{status:d,progress:p,message:u,prompt:m,error:g,notebookPath:h}=e,f="completed"===d,C="failed"===d,y="running"===d,b=f||C||"cancelled"===d;return l().createElement(K.Card,{sx:{position:"fixed",bottom:20,right:20,width:a?380:320,maxWidth:"90vw",boxShadow:3,zIndex:1300,transition:"all 0.3s ease"}},l().createElement(K.CardContent,{sx:{padding:2,"&:last-child":{paddingBottom:2}}},l().createElement(K.Box,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},l().createElement(K.Box,{display:"flex",alignItems:"center",gap:1},l().createElement(K.Typography,{variant:"subtitle2",fontWeight:"bold"},"ë…¸íŠ¸ë¶ ìƒì„±"),l().createElement(K.Chip,{label:(x=d,{pending:"ëŒ€ê¸° ì¤‘",running:"ìƒì„± ì¤‘",completed:"ì™„ë£Œ",failed:"ì‹¤íŒ¨",cancelled:"ì·¨ì†Œë¨"}[x]||x),size:"small",color:(e=>{switch(e){case"completed":return"success";case"failed":return"error";case"cancelled":return"default";default:return"primary"}})(d),icon:(e=>{switch(e){case"completed":return l().createElement(ne,{fontSize:"small"});case"failed":return l().createElement(oe,{fontSize:"small"});case"cancelled":return l().createElement(ae,{fontSize:"small"});default:return null}})(d)||void 0})),l().createElement(K.Box,{display:"flex"},l().createElement(K.IconButton,{size:"small",onClick:()=>c(!i)},i?l().createElement(te,{fontSize:"small"}):l().createElement(ee,{fontSize:"small"})),l().createElement(K.IconButton,{size:"small",onClick:t},l().createElement(Y,{fontSize:"small"})))),!b&&l().createElement(K.Box,{mb:2},l().createElement(K.LinearProgress,{variant:"determinate",value:p,sx:{height:6,borderRadius:1}}),l().createElement(K.Box,{display:"flex",justifyContent:"space-between",mt:.5},l().createElement(K.Typography,{variant:"caption",color:"text.secondary"},u),l().createElement(K.Typography,{variant:"caption",color:"text.secondary"},p,"%"))),f&&l().createElement(K.Box,{mb:2},l().createElement(K.Typography,{variant:"body2",color:"success.main"},"âœ“ ",u)),C&&g&&l().createElement(K.Box,{mb:2},l().createElement(K.Typography,{variant:"body2",color:"error.main"},"âœ— ",g)),l().createElement(K.Collapse,{in:i},l().createElement(K.Box,{sx:{backgroundColor:"action.hover",borderRadius:1,padding:1.5,mb:2}},l().createElement(K.Typography,{variant:"caption",color:"text.secondary",display:"block",mb:.5},"í”„ë¡¬í”„íŠ¸:"),l().createElement(K.Typography,{variant:"body2",sx:{wordBreak:"break-word"}},m),h&&l().createElement(l().Fragment,null,l().createElement(K.Typography,{variant:"caption",color:"text.secondary",display:"block",mt:1,mb:.5},"ì €ì¥ ìœ„ì¹˜:"),l().createElement(K.Typography,{variant:"caption",sx:{wordBreak:"break-all",fontFamily:"monospace"}},h)))),l().createElement(K.Box,{display:"flex",gap:1,justifyContent:"flex-end"},y&&l().createElement(K.Button,{size:"small",variant:"outlined",onClick:n},"ì·¨ì†Œ"),f&&h&&l().createElement(K.Button,{size:"small",variant:"contained",onClick:o},"ë…¸íŠ¸ë¶ ì—´ê¸°"),b&&l().createElement(K.Button,{size:"small",variant:"text",onClick:t},"ë‹«ê¸°"))));var x};class re{constructor(e="/hdsp-agent"){this.baseUrl=e,this.eventSources=new Map}getCookie(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length&&t.pop()?.split(";").shift()||""}getCsrfToken(){return this.getCookie("_xsrf")}getHeaders(){return{"Content-Type":"application/json","X-XSRFToken":this.getCsrfToken()}}async generateNotebook(e){const t=await fetch(`${this.baseUrl}/notebook/generate`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({message:"Failed to start notebook generation"}));throw new Error(e.message||"Failed to start notebook generation")}return t.json()}async getTaskStatus(e){const t=await fetch(`${this.baseUrl}/task/${e}/status`);if(!t.ok){const e=await t.json().catch(()=>({message:"Failed to get task status"}));throw new Error(e.message||"Failed to get task status")}return t.json()}subscribeToTaskProgress(e,t,n,o){this.unsubscribeFromTask(e);const a=new EventSource(`${this.baseUrl}/task/${e}/stream`);return a.onmessage=a=>{try{const n=JSON.parse(a.data);t(n),["completed","failed","cancelled"].includes(n.status)&&(this.unsubscribeFromTask(e),o&&o())}catch(e){console.error("Failed to parse SSE message:",e),n&&n(e)}},a.onerror=t=>{console.error("SSE connection error:",t),this.unsubscribeFromTask(e),n&&n(new Error("Connection to server lost"))},this.eventSources.set(e,a),()=>this.unsubscribeFromTask(e)}unsubscribeFromTask(e){const t=this.eventSources.get(e);t&&(t.close(),this.eventSources.delete(e))}async cancelTask(e){const t=await fetch(`${this.baseUrl}/task/${e}/cancel`,{method:"POST",headers:this.getHeaders()});if(!t.ok){const e=await t.json().catch(()=>({message:"Failed to cancel task"}));throw new Error(e.message||"Failed to cancel task")}this.unsubscribeFromTask(e)}dispose(){for(const[e,t]of this.eventSources)this.unsubscribeFromTask(e)}}const le="hdsp-agent:generate-from-prompt",ie=new i.LabIcon({name:"hdsp-agent:hdsp-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 60">\n  \x3c!-- H --\x3e\n  <text x="0" y="48" font-family="Arial Black, Arial, sans-serif" font-size="52" font-weight="900" fill="#333333">H</text>\n  \x3c!-- a --\x3e\n  <text x="38" y="48" font-family="Arial Black, Arial, sans-serif" font-size="52" font-weight="900" fill="#333333">a</text>\n  \x3c!-- l --\x3e\n  <text x="76" y="48" font-family="Arial Black, Arial, sans-serif" font-size="52" font-weight="900" fill="#333333">l</text>\n  \x3c!-- o with planet ring --\x3e\n  <g transform="translate(100, 30)">\n    \x3c!-- o letter (circuit pattern style) --\x3e\n    <circle cx="18" cy="0" r="16" fill="none" stroke="#888888" stroke-width="5"/>\n    \x3c!-- Orange Saturn ring --\x3e\n    <ellipse cx="18" cy="0" rx="32" ry="12" fill="none" stroke="#E07020" stroke-width="3" transform="rotate(-20)"/>\n    \x3c!-- Small orange dot --\x3e\n    <circle cx="48" cy="10" r="3" fill="#E07020"/>\n  </g>\n</svg>\n'});class ce extends a.ReactWidget{constructor(e,t){super(),this.app=e,this.docManager=t,this.taskService=new re,this.activeTasks=new Map,this.addClass("jp-TaskManagerWidget")}async startGeneration(e){try{const t=(await this.taskService.generateNotebook({prompt:e})).taskId;this.taskService.subscribeToTaskProgress(t,e=>{this.activeTasks.set(t,e),this.update(),"completed"===e.status&&e.notebookPath?a.Notification.success(`ë…¸íŠ¸ë¶ ìƒì„± ì™„ë£Œ: ${e.notebookPath.split("/").pop()}`,{autoClose:5e3}):"failed"===e.status&&a.Notification.error(`ë…¸íŠ¸ë¶ ìƒì„± ì‹¤íŒ¨: ${e.error}`,{autoClose:1e4})},e=>{console.error("Task progress error:",e),a.Notification.error("ì§„í–‰ìƒí™© ì—°ê²° ì‹¤íŒ¨",{autoClose:5e3})},()=>{this.update()}),a.Notification.info("ë…¸íŠ¸ë¶ ìƒì„±ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤",{autoClose:3e3}),this.update()}catch(e){console.error("Failed to start generation:",e),a.Notification.error(`ìƒì„± ì‹œì‘ ì‹¤íŒ¨: ${e.message}`,{autoClose:5e3})}}async cancelTask(e){try{await this.taskService.cancelTask(e),this.activeTasks.delete(e),this.update(),a.Notification.info("ì‘ì—…ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤",{autoClose:3e3})}catch(e){console.error("Failed to cancel task:",e),a.Notification.error(`ì·¨ì†Œ ì‹¤íŒ¨: ${e.message}`,{autoClose:5e3})}}closeTask(e){this.taskService.unsubscribeFromTask(e),this.activeTasks.delete(e),this.update()}async openNotebook(e,t){try{const n=e.split("/").pop()||e;await this.docManager.openOrReveal(n),this.closeTask(t),a.Notification.success(`ë…¸íŠ¸ë¶ì„ ì—´ì—ˆìŠµë‹ˆë‹¤: ${n}`,{autoClose:3e3})}catch(e){console.error("Failed to open notebook:",e),a.Notification.error(`ë…¸íŠ¸ë¶ ì—´ê¸° ì‹¤íŒ¨: ${e.message}`,{autoClose:5e3})}}render(){const e=(0,K.createTheme)(),t=Array.from(this.activeTasks.entries());return l().createElement(K.ThemeProvider,{theme:e},l().createElement("div",{style:{position:"fixed",bottom:0,right:0,zIndex:1300}},t.map(([e,n],o)=>l().createElement("div",{key:e,style:{marginBottom:o<t.length-1?"10px":"0"}},l().createElement(se,{taskStatus:n,onClose:()=>this.closeTask(e),onCancel:()=>this.cancelTask(e),onOpenNotebook:()=>n.notebookPath&&this.openNotebook(n.notebookPath,e)})))))}dispose(){this.taskService.dispose(),super.dispose()}}class de extends a.ReactWidget{constructor(e,t){super(),this._onGenerate=e,this._onClose=t}render(){const e=(0,K.createTheme)();return l().createElement(K.ThemeProvider,{theme:e},l().createElement(Q,{open:!0,onClose:this._onClose,onGenerate:this._onGenerate}))}}async function pe(e,t,n,o,a,s){const r=await new Promise(e=>{const t=document.querySelector(".jp-agent-save-confirm-modal");t&&t.remove();const n=document.createElement("div");n.className="jp-agent-save-confirm-modal",n.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.3);\n      z-index: 10000;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ";const o=document.createElement("div");o.style.cssText="\n      background: var(--jp-layout-color1);\n      border: 1px solid var(--jp-border-color1);\n      border-radius: 4px;\n      padding: 24px;\n      max-width: 400px;\n      width: 90%;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n      font-family: var(--jp-ui-font-family);\n    ",o.innerHTML='\n      <div style="margin-bottom: 20px;">\n        <h3 style="margin: 0 0 12px 0; color: var(--jp-ui-font-color1); font-size: 16px; font-weight: 500;">\n          ì €ì¥ ì „ì— ì½”ë“œ ê²€ìˆ˜ë¥¼ í•˜ê² ìŠµë‹ˆê¹Œ?\n        </h3>\n        <p style="margin: 0; color: var(--jp-ui-font-color2); font-size: 14px; line-height: 1.5;">\n          ë…¸íŠ¸ë¶ì„ ì €ì¥í•˜ê¸° ì „ì— ëª¨ë“  ì…€ì˜ ì½”ë“œì™€ ì¶œë ¥ì„ ë¶„ì„í•˜ì—¬ ìµœì í™” ì œì•ˆì„ ë°›ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?\n        </p>\n      </div>\n      <div style="display: flex; gap: 12px; justify-content: flex-end;">\n        <button class="jp-agent-save-direct-btn" style="\n          background: transparent;\n          color: var(--jp-ui-font-color2);\n          border: 1px solid var(--jp-border-color2);\n          border-radius: 3px;\n          padding: 8px 16px;\n          font-size: 13px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.15s ease;\n        ">ê·¸ëƒ¥ ì €ì¥í•˜ê¸°</button>\n        <button class="jp-agent-save-analysis-btn" style="\n          background: var(--jp-brand-color1);\n          color: white;\n          border: 1px solid var(--jp-brand-color1);\n          border-radius: 3px;\n          padding: 8px 16px;\n          font-size: 13px;\n          font-weight: 500;\n          cursor: pointer;\n          transition: all 0.15s ease;\n        ">ê²€ìˆ˜ í›„ ì €ì¥í•˜ê¸°</button>\n      </div>\n    ',n.appendChild(o),document.body.appendChild(n);const a=o.querySelector(".jp-agent-save-direct-btn"),s=o.querySelector(".jp-agent-save-analysis-btn");a.addEventListener("click",()=>{console.log("[SaveInterceptorPlugin] User chose direct save"),n.remove(),e(!1)}),a.addEventListener("mouseenter",()=>{a.style.background="var(--jp-layout-color2)"}),a.addEventListener("mouseleave",()=>{a.style.background="transparent"}),s.addEventListener("click",()=>{console.log("[SaveInterceptorPlugin] User chose analysis save"),n.remove(),e(!0)}),s.addEventListener("mouseenter",()=>{s.style.opacity="0.9"}),s.addEventListener("mouseleave",()=>{s.style.opacity="1"}),n.addEventListener("click",t=>{t.target===n&&(console.log("[SaveInterceptorPlugin] User cancelled save"),n.remove(),e(null))});const r=t=>{"Escape"===t.key&&(console.log("[SaveInterceptorPlugin] User cancelled save with ESC"),n.remove(),document.removeEventListener("keydown",r),e(null))};document.addEventListener("keydown",r)});null!==r?r?await async function(e,t,n,o,a,s){console.log("[SaveInterceptorPlugin] Performing analysis save");try{const r=await async function(e){const t=e.content,n=[];for(let e=0;e<t.widgets.length;e++){const o=t.widgets[e];if(!o?.model||"code"!==o.model.type)continue;const a=o.model.sharedModel?.getSource()||"";if(!a.trim())continue;const s=me(o),r=ge(o),l=he(a),i=l.filter(e=>e.isLocal),c={};for(const e of i)e.module.startsWith(".")||(c[e.module]=`# Source for ${e.module} would be fetched from kernel`);n.push({index:e,id:s,content:a,type:"code",output:r,imports:l,localModuleSources:Object.keys(c).length>0?c:void 0})}return console.log(`[SaveInterceptorPlugin] Collected ${n.length} code cells`),n}(e);if(0===r.length)return Ce("ë¶„ì„í•  ì½”ë“œ ì…€ì´ ì—†ìŠµë‹ˆë‹¤. ê·¸ëƒ¥ ì €ì¥í•©ë‹ˆë‹¤.","warning"),void await ue(e,0,n,o,a,s);Ce("ì½”ë“œ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...","info");const l=window._hdspAgentPanel;if(!l)return console.error("[SaveInterceptorPlugin] Agent panel not found"),Ce("Agent panelì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ëƒ¥ ì €ì¥í•©ë‹ˆë‹¤.","warning"),void await ue(e,0,n,o,a,s);t&&t.shell.activateById(l.id),l.analyzeNotebook?l.analyzeNotebook(r,async()=>{await ue(e,0,n,o,a,s)}):(console.error("[SaveInterceptorPlugin] analyzeNotebook method not found on AgentPanel"),Ce("ë¶„ì„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ëƒ¥ ì €ì¥í•©ë‹ˆë‹¤.","warning"),await ue(e,0,n,o,a,s))}catch(t){console.error("[SaveInterceptorPlugin] Analysis save failed:",t),Ce("ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê·¸ëƒ¥ ì €ì¥í•©ë‹ˆë‹¤.","warning"),await ue(e,0,n,o,a,s)}}(e,t,n,o,a,s):await ue(e,0,n,o,a,s):s()}async function ue(e,t,n,o,a,s){console.log("[SaveInterceptorPlugin] Performing direct save"),a();try{if(n)await n(o),Ce("ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.","success");else{const t=e.context;t&&(await t.save(),Ce("ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.","success"))}}catch(e){console.error("[SaveInterceptorPlugin] Save failed:",e),Ce("ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.","error")}finally{s()}}function me(e){const t=e.model;let n;try{t.metadata&&"function"==typeof t.metadata.get?n=t.metadata.get("jupyterAgentCellId"):t.metadata?.jupyterAgentCellId&&(n=t.metadata.jupyterAgentCellId)}catch(e){}if(!n){n=`cell-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;try{t.metadata&&"function"==typeof t.metadata.set?t.metadata.set("jupyterAgentCellId",n):t.metadata&&(t.metadata.jupyterAgentCellId=n)}catch(e){}}return n}function ge(e){if(!e?.model||"code"!==e.model.type)return"";const t=e,n=t.model?.outputs;if(!n||0===n.length)return"";const o=[];for(let e=0;e<n.length;e++){const t=n.get(e),a=t.type;if("stream"===a){const e=t.text;Array.isArray(e)?o.push(e.join("")):o.push(e)}else if("execute_result"===a||"display_data"===a){const e=t.data;if(e["text/plain"]){const t=e["text/plain"];Array.isArray(t)?o.push(t.join("")):o.push(t)}}else if("error"===a){const e=t.traceback;Array.isArray(e)&&o.push(e.join("\n"))}}return o.join("\n")}function he(e){const t=[],n=e.split("\n");for(const e of n){const n=e.trim();if(n.startsWith("#")||""===n)continue;const o=n.match(/^from\s+(\.+[\w.]*)\s+import\s+([\w,\s*]+)/);if(o){t.push({module:o[1],items:o[2],isLocal:!0});continue}const a=n.match(/^from\s+([\w.]+)\s+import\s+([\w,\s*]+)/);if(a){const e=a[1];t.push({module:e,items:a[2],isLocal:fe(e)});continue}const s=n.match(/^import\s+([\w,\s.]+)/);s&&s[1].split(",").map(e=>e.trim().split(" as ")[0]).forEach(e=>{t.push({module:e,items:e,isLocal:fe(e)})})}return t}function fe(e){if(e.startsWith("."))return!0;const t=e.split(".")[0];return!["numpy","np","pandas","pd","matplotlib","sklearn","scipy","torch","tensorflow","tf","keras","PIL","cv2","requests","json","os","sys","datetime","time","math","random","collections","itertools","functools","re","pathlib","typing","dataclasses","abc","argparse","logging","pickle","csv","sqlite3","http","urllib","email","plotly","seaborn","statsmodels","xgboost","lightgbm","transformers","datasets","accelerate","peft","openai","anthropic","langchain","llama_index"].includes(t)}function Ce(e,t="info"){const n=function(e,t){const n=document.createElement("div");return n.style.cssText=`\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    padding: 12px 20px;\n    border-radius: 8px;\n    color: white;\n    font-size: 14px;\n    font-weight: 500;\n    z-index: 10001;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n    max-width: 300px;\n    word-wrap: break-word;\n    background: ${t};\n  `,n.textContent=e,n}(e,function(e){const t={success:"#48bb78",error:"#f56565",warning:"#ed8936",info:"#4299e1"};return t[e]||t.info}(t));document.body.appendChild(n),function(e){setTimeout(()=>{e.style.opacity="1"},10),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)},3e3)}(n)}const ye=[j,T,{id:"@hdsp-agent/prompt-generation",autoStart:!0,requires:[W.IDocumentManager],optional:[q.ILauncher,a.ICommandPalette],activate:(e,t,n,o)=>{console.log("[PromptGenerationPlugin] Activating");try{const a=new ce(e,t);a.id="hdsp-agent-task-manager",a.title.label="Task Manager",U.Widget.attach(a,document.body),e.commands.addCommand(le,{label:"í”„ë¡¬í”„íŠ¸ë¡œ ë…¸íŠ¸ë¶ ë§Œë“¤ê¸°",caption:"í”„ë¡¬í”„íŠ¸ë¡œ ë…¸íŠ¸ë¶ ë§Œë“¤ê¸°",icon:ie,execute:()=>{let t=null;t=new de(async e=>{t&&(t.dispose(),t=null),await a.startGeneration(e)},()=>{t&&(t.dispose(),t=null)}),t.id="hdsp-agent-prompt-dialog",t.title.label="",e.shell.add(t,"main")}}),n&&n.add({command:le,category:"Notebook",rank:1}),o&&o.addItem({command:le,category:"HALO Agent"}),console.log("[PromptGenerationPlugin] Activated successfully")}catch(e){console.error("[PromptGenerationPlugin] Failed to activate:",e)}}},{id:"@hdsp-agent/save-interceptor",autoStart:!0,requires:[s.INotebookTracker],optional:[a.ICommandPalette],activate:(e,t,n)=>{console.log("[SaveInterceptorPlugin] Activated");let o=!1,a=null;if(e.commands.hasCommand("docmanager:save")){console.log("[SaveInterceptorPlugin] Found docmanager:save command");const n="docmanager:save",s=e.commands._commands.get(n);s?(a=s.execute.bind(s),console.log("[SaveInterceptorPlugin] Stored original save command"),s.execute=async n=>{const s=t.currentWidget;return console.log("[SaveInterceptorPlugin] Save command triggered",{hasCurrentWidget:!!s,isSaving:o,widgetType:s?.constructor?.name}),s?o?(console.log("[SaveInterceptorPlugin] Already in save process, executing actual save"),a(n)):(console.log("[SaveInterceptorPlugin] Intercepting save, showing modal"),void await pe(s,e,a,n,()=>o=!0,()=>o=!1)):(console.log("[SaveInterceptorPlugin] No current widget, allowing default save"),a(n))},console.log("[SaveInterceptorPlugin] Wrapped save command installed")):console.error("[SaveInterceptorPlugin] Could not find original save command")}document.addEventListener("keydown",async n=>{if((n.ctrlKey||n.metaKey)&&"s"===n.key){const s=t.currentWidget;if(!s)return;if(console.log("[SaveInterceptorPlugin] Save shortcut (Ctrl/Cmd+S) detected"),n.preventDefault(),n.stopPropagation(),o)return void console.log("[SaveInterceptorPlugin] Already saving, ignoring duplicate request");if(!a)return void console.error("[SaveInterceptorPlugin] No original save command stored");await pe(s,e,a,void 0,()=>o=!0,()=>o=!1)}},!0),console.log("[SaveInterceptorPlugin] Save interception enabled")}}]}}]);