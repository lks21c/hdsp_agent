# HDSP Agent - Plan-and-Execute ì•„í‚¤í…ì²˜ íë¦„

## ê°œìš”

HDSP AgentëŠ” HuggingFace Jupyter Agentì—ì„œ ì˜ê°ì„ ë°›ì€ **Plan-and-Execute íŒ¨í„´**ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
ì‚¬ìš©ì ìš”ì²­ì„ ë°›ì•„ ê³„íšì„ ìˆ˜ë¦½í•˜ê³ , ë‹¨ê³„ë³„ë¡œ ì‹¤í–‰í•˜ë©°, ì˜¤ë¥˜ ë°œìƒ ì‹œ ì ì‘ì ìœ¼ë¡œ ì¬ê³„íší•©ë‹ˆë‹¤.

### ì•„í‚¤í…ì²˜ ê°œìš”

HDSP AgentëŠ” **Agent Server ë¶„ë¦¬ ì•„í‚¤í…ì²˜**ë¥¼ ì±„íƒí•˜ë©°, ì„¸ ê°€ì§€ í†µì‹  ê²½ë¡œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              JupyterLab Extension                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Frontend (TypeScript/React)                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚   ApiService    â”‚  â”‚  ToolExecutor   â”‚  â”‚ AgentOrchestrator â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚ (REST API í˜¸ì¶œ)  â”‚  â”‚ (Jupyter API)   â”‚  â”‚   (ìƒíƒœ ë¨¸ì‹ )      â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚           â”‚ REST API           â”‚ HTTP/REST                                        â”‚  â”‚
â”‚  â”‚           â–¼                    â–¼                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                    â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               jupyter_ext (Python Backend - HTTP Proxy)                           â”‚  â”‚
â”‚  â”‚  /hdsp-agent/* â†’ Agent Server í¬ì›Œë”©                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Jupyter Server â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â€¢ Session Manager    â€¢ Kernel Manager    â€¢ Contents/Kernels API                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚ ZMQ                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Kernel (IPython) - ì½”ë“œ ì‹¤í–‰                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ HTTP/REST (Port 8000)
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         Agent Server              â”‚
                    â”‚          (FastAPI)                â”‚
                    â”‚  â”œâ”€â–¶ routers/agent.py            â”‚
                    â”‚  â”œâ”€â–¶ LLMService (Gemini/OpenAI)  â”‚
                    â”‚  â”œâ”€â–¶ ErrorClassifier (íŒ¨í„´+LLM)  â”‚
                    â”‚  â””â”€â–¶ StateVerifier (ê²°ì •ë¡ ì )    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í†µì‹  ê²½ë¡œ (2ê°€ì§€):**
- **A. REST API (í”„ë¡ì‹œ ê²½ìœ )**: Frontend â†’ jupyter_ext â†’ Agent Server â†’ LLM
  - ìš©ë„: ê³„íš ìƒì„±, ì½”ë“œ ê²€ì¦, ì—ëŸ¬ ë¶„ë¥˜, ë¦¬í”Œëœ
  - í”„ë¡ì‹œ ì‚¬ìš© ì´ìœ : CORS í•´ê²°, Jupyter ì„¸ì…˜ ì¸ì¦ ìë™ ì²˜ë¦¬, Agent Server ë‚´ë¶€ë§ ê²©ë¦¬
- **B. Jupyter API (ì§ì ‘ í˜¸ì¶œ)**: ToolExecutor â†’ Jupyter Server â†’ Kernel
  - ìš©ë„: ì…€ ìƒì„±/ì‹¤í–‰, íŒŒì¼ ì‘ì—…, ì¶œë ¥ ìº¡ì²˜
  - Agent Serverë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì§ì ‘ Jupyter Native API ì‚¬ìš©

**ì„¤ê³„ ì›ì¹™:**
- **í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ë¶„ë¦¬**: FrontendëŠ” ë„êµ¬ ì‹¤í–‰ë§Œ, Agent ServerëŠ” LLM í˜¸ì¶œ ë‹´ë‹¹
- **API í‚¤ ë³´ì•ˆ**: ì„œë²„ëŠ” API í‚¤ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŒ (ìš”ì²­ë§ˆë‹¤ í´ë¼ì´ì–¸íŠ¸ê°€ ì „ì†¡)
- **í•˜ì´ë¸Œë¦¬ë“œ ì„œë¸Œì‹œìŠ¤í…œ**: ì—ëŸ¬ ë¶„ë¥˜ëŠ” íŒ¨í„´ ë§¤ì¹­ ìš°ì„ , í•„ìš”ì‹œ LLM Fallback; ìƒíƒœ ê²€ì¦ì€ ê²°ì •ë¡ ì 
- **ìˆœìˆ˜ í”„ë¡ì‹œ**: jupyter_extëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì—†ì´ ìš”ì²­ë§Œ í¬ì›Œë”©

---

## ì „ì²´ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì‚¬ìš©ì ìš”ì²­ (User Request)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Knowledge Base ë™ì  ë¡œë”© (Local RAG)                                 â”‚
â”‚     - ìš”ì²­ì—ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í‚¤ì›Œë“œ ê°ì§€ (dask, polars, pyspark ë“±)            â”‚
â”‚     - Qdrant ë²¡í„° DBì—ì„œ ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰ (multilingual-e5-small ì„ë² ë”©)      â”‚
â”‚     - í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ API ê°€ì´ë“œ ìë™ ë¡œë“œ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Planning (ê³„íš ìˆ˜ë¦½) - POST /agent/plan                              â”‚
â”‚     - System Prompt + ì‚¬ìš©ì ìš”ì²­ + ë…¸íŠ¸ë¶ ì»¨í…ìŠ¤íŠ¸ + ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§€ì‹        â”‚
â”‚     - LLMì´ ì‹¤í–‰ ê³„íš(steps) ìƒì„±                                         â”‚
â”‚     - ê° stepì€ tool í˜¸ì¶œ ì •ì˜ í¬í•¨                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Pre-Validation (ì‚¬ì „ ê²€ì¦) - Ruff ê¸°ë°˜                                â”‚
â”‚     â”œâ”€â–¶ Pass 1: ruff check --fix (ìë™ ìˆ˜ì • ê°€ëŠ¥ ì´ìŠˆ ì²˜ë¦¬)                â”‚
â”‚     â”‚   - F401 (ë¯¸ì‚¬ìš© import), W (ìŠ¤íƒ€ì¼) ë“± ìë™ ìˆ˜ì •                    â”‚
â”‚     â”‚                                                                     â”‚
â”‚     â””â”€â–¶ Pass 2: ruff check (ê²€ì¦ ì „ìš©)                                    â”‚
â”‚         - ìë™ ìˆ˜ì • ë¶ˆê°€ ì´ìŠˆë§Œ ë°˜í™˜ (F821, S ë“±)                           â”‚
â”‚         - AST íŒŒì‹±ìœ¼ë¡œ êµ¬ë¬¸ ë¶„ì„ ë° ì˜ì¡´ì„± ì¶”ì¶œ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Step-by-Step Execution (ë‹¨ê³„ë³„ ì‹¤í–‰)                                  â”‚
â”‚     - jupyter_cell: ì…€ ìƒì„±/ìˆ˜ì •/ì‚½ì… ë° ì‹¤í–‰                              â”‚
â”‚     - markdown: ë§ˆí¬ë‹¤ìš´ ì…€ ìƒì„±                                          â”‚
â”‚     - í™•ì¥ ë„êµ¬: read_file, write_file, git_operations ë“±                 â”‚
â”‚     - final_answer: ìµœì¢… ë‹µë³€ ì œê³µ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   ì„±ê³µ (âœ“)    â”‚                â”‚   ì˜¤ë¥˜ (âœ—)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5a. State Verification        â”‚   â”‚  5b. Error Classification            â”‚
â”‚      (ìƒíƒœ ê²€ì¦)                â”‚   â”‚      (ì—ëŸ¬ ë¶„ë¥˜)                      â”‚
â”‚  - ê²°ì •ë¡ ì  ê²€ì¦ (LLM ì—†ìŒ)     â”‚   â”‚  - íŒ¨í„´ ë§¤ì¹­ ìš°ì„                       â”‚
â”‚  - ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°             â”‚   â”‚  - í•„ìš”ì‹œ LLM Fallback                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â”‚                               â–¼
                    â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚  6. Adaptive Replanning             â”‚
                    â”‚               â”‚     (ì ì‘ì  ì¬ê³„íš)                   â”‚
                    â”‚               â”‚  - refine: í˜„ì¬ step ì½”ë“œ ìˆ˜ì •        â”‚
                    â”‚               â”‚  - insert_steps: ìƒˆ step ì‚½ì…         â”‚
                    â”‚               â”‚  - replace_step: step êµì²´            â”‚
                    â”‚               â”‚  - replan_remaining: ì „ì²´ ì¬ê³„íš      â”‚
                    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â”‚                               â”‚ (ìˆ˜ì •ëœ step ì¬ì‹¤í–‰)
                    â”‚                               â”‚
                    â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚               â”‚
                    â–¼               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      ë‹¤ìŒ Step ì‹¤í–‰        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      ë˜ëŠ” ì™„ë£Œ             â”‚             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                    â”‚                                 â”‚
                    â”‚ (ë‚¨ì€ step ìˆìŒ)                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### Agent API (`/agent/*`)

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… | LLM í˜¸ì¶œ |
|------------|--------|------|----------|
| `/agent/plan` | POST | ì‹¤í–‰ ê³„íš ìƒì„± | âœ“ |
| `/agent/refine` | POST | ì½”ë“œ ìˆ˜ì • (Self-Healing) | âœ“ |
| `/agent/replan` | POST | ì ì‘ì  ì¬ê³„íš ê²°ì • | â–³ (íŒ¨í„´+LLM Fallback) |
| `/agent/verify-state` | POST | ìƒíƒœ ê²€ì¦ | âœ— (ê²°ì •ë¡ ì ) |
| `/agent/report-execution` | POST | ì‹¤í–‰ ê²°ê³¼ ë³´ê³  | âœ— |

### Chat API (`/chat/*`)

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… | LLM í˜¸ì¶œ |
|------------|--------|------|----------|
| `/chat/message` | POST | ì±„íŒ… ë©”ì‹œì§€ | âœ“ |
| `/chat/stream` | POST | ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (SSE) | âœ“ |

### ìš”ì²­ ì˜ˆì‹œ

```json
// POST /agent/plan
{
  "request": "pandasë¡œ CSV íŒŒì¼ì„ ì½ì–´ì„œ ë°ì´í„° ë¶„ì„í•´ì¤˜",
  "notebookContext": {
    "cellCount": 5,
    "importedLibraries": ["pandas", "numpy"],
    "definedVariables": ["df", "data"],
    "recentCells": [...]
  },
  "llmConfig": {
    "provider": "gemini",
    "gemini": {
      "apiKey": "AIza...",
      "model": "gemini-2.5-flash"
    }
  }
}
```

---

## ë‚´ì¥ ë„êµ¬ (Built-in Tools)

### jupyter_cell

Python ì½”ë“œ ì…€ì„ ìƒì„±, ìˆ˜ì •, ì‚½ì…í•©ë‹ˆë‹¤.

| ì•¡ì…˜ | íŒŒë¼ë¯¸í„° | ì„¤ëª… |
|------|----------|------|
| `CREATE` | `code` | ìƒˆ ì½”ë“œ ì…€ ìƒì„± ë° ì‹¤í–‰ |
| `MODIFY` | `code`, `cellId` | ê¸°ì¡´ ì…€ ë‚´ìš© ìˆ˜ì • |
| `INSERT_AFTER` | `code`, `cellId` | ì§€ì •ëœ ì…€ ë’¤ì— ìƒˆ ì…€ ì‚½ì… |
| `INSERT_BEFORE` | `code`, `cellId` | ì§€ì •ëœ ì…€ ì•ì— ìƒˆ ì…€ ì‚½ì… |

```json
{
  "tool": "jupyter_cell",
  "parameters": {
    "action": "CREATE",
    "code": "import pandas as pd\ndf = pd.read_csv('data.csv')"
  }
}
```

### markdown

ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ì„¤ëª… ì…€ì„ ìƒì„±í•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… |
|----------|------|
| `content` | ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ |

```json
{
  "tool": "markdown",
  "parameters": {
    "content": "## ë°ì´í„° ë¶„ì„ ê²°ê³¼\në¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
  }
}
```

### final_answer

ìµœì¢… ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤. ë³€ìˆ˜ ì¹˜í™˜ì„ ì§€ì›í•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… |
|----------|------|
| `answer` | ìµœì¢… ë‹µë³€ í…ìŠ¤íŠ¸ (`{{ë³€ìˆ˜ëª…}}` í˜•ì‹ìœ¼ë¡œ ì¹˜í™˜ ê°€ëŠ¥) |

```json
{
  "tool": "final_answer",
  "parameters": {
    "answer": "ë°ì´í„° ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ {{row_count}}ê°œì˜ í–‰ì´ ìˆìŠµë‹ˆë‹¤."
  }
}
```

### read_file

íŒŒì¼ ë‚´ìš©ì„ ì½ìŠµë‹ˆë‹¤. ì‘ì—… ë””ë ‰í† ë¦¬ ë‚´ íŒŒì¼ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `path` | íŒŒì¼ ê²½ë¡œ (ìƒëŒ€ ê²½ë¡œ) | í•„ìˆ˜ |
| `encoding` | íŒŒì¼ ì¸ì½”ë”© | `utf-8` |
| `maxLines` | ìµœëŒ€ ì½ì„ ë¼ì¸ ìˆ˜ | ì—†ìŒ (ì „ì²´) |

```json
{
  "tool": "read_file",
  "parameters": {
    "path": "data/config.json",
    "maxLines": 100
  }
}
```

### write_file

íŒŒì¼ì— ë‚´ìš©ì„ ì”ë‹ˆë‹¤. **í•­ìƒ ì‚¬ìš©ì ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.**

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `path` | íŒŒì¼ ê²½ë¡œ (ìƒëŒ€ ê²½ë¡œ) | í•„ìˆ˜ |
| `content` | ì‘ì„±í•  ë‚´ìš© | í•„ìˆ˜ |
| `overwrite` | ê¸°ì¡´ íŒŒì¼ ë®ì–´ì“°ê¸° | `false` |

```json
{
  "tool": "write_file",
  "parameters": {
    "path": "output/result.csv",
    "content": "col1,col2\n1,2",
    "overwrite": true
  }
}
```

### list_files

ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `path` | ë””ë ‰í† ë¦¬ ê²½ë¡œ | `.` (í˜„ì¬) |
| `recursive` | ì¬ê·€ì  íƒìƒ‰ | `false` |
| `pattern` | íŒŒì¼ íŒ¨í„´ (glob) | `*` |

```json
{
  "tool": "list_files",
  "parameters": {
    "path": "data",
    "recursive": true,
    "pattern": "*.csv"
  }
}
```

### execute_command

ì…¸ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. **ìœ„í—˜í•œ ëª…ë ¹ì€ ì‚¬ìš©ì ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.**

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `command` | ì‹¤í–‰í•  ëª…ë ¹ | í•„ìˆ˜ |
| `timeout` | íƒ€ì„ì•„ì›ƒ (ì´ˆ) | `30` |

```json
{
  "tool": "execute_command",
  "parameters": {
    "command": "pip install pandas",
    "timeout": 60
  }
}
```

**ìœ„í—˜ ëª…ë ¹ íŒ¨í„´ (ìŠ¹ì¸ í•„ìš”):**
- `rm`, `rm -rf`, `rmdir`
- `sudo`, `su`
- `chmod 777`, `chown`
- `> /dev`, `mkfs`, `dd`
- `curl | sh`, `wget | sh`

### search_files

íŒŒì¼ ë‚´ìš©ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `pattern` | ê²€ìƒ‰ íŒ¨í„´ (ì •ê·œì‹) | í•„ìˆ˜ |
| `path` | ê²€ìƒ‰ ì‹œì‘ ê²½ë¡œ | `.` |
| `maxResults` | ìµœëŒ€ ê²°ê³¼ ìˆ˜ | `50` |

```json
{
  "tool": "search_files",
  "parameters": {
    "pattern": "import pandas",
    "path": "src",
    "maxResults": 20
  }
}
```

---

## í™•ì¥ ë„êµ¬ (Extended Tools)

### install_package

pip íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. **ì‹œìŠ¤í…œ ë³€ê²½ì´ë¯€ë¡œ í•­ìƒ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.**

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `package` | íŒ¨í‚¤ì§€ ì´ë¦„ | í•„ìˆ˜ |
| `version` | ë²„ì „ ì§€ì • (optional) | ì—†ìŒ (ìµœì‹ ) |
| `upgrade` | ì—…ê·¸ë ˆì´ë“œ ì—¬ë¶€ | `false` |

```json
{
  "tool": "install_package",
  "parameters": {
    "package": "pandas",
    "version": "2.0.0",
    "upgrade": true
  }
}
```

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ  high (í•­ìƒ ìŠ¹ì¸ í•„ìš”)

### lint_file

Python íŒŒì¼ì˜ ë¦°íŠ¸ ê²€ì‚¬ ë° ìë™ ìˆ˜ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `path` | íŒŒì¼ ê²½ë¡œ | í•„ìˆ˜ |
| `fix` | ìë™ ìˆ˜ì • ì—¬ë¶€ | `false` |
| `linter` | ë¦°í„° ì¢…ë¥˜ | `ruff` |

```json
{
  "tool": "lint_file",
  "parameters": {
    "path": "src/utils.py",
    "fix": true,
    "linter": "ruff"
  }
}
```

**ì§€ì› ë¦°í„°:** `ruff`, `pylint`, `flake8`

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ¡ medium

### delete_cell

Jupyter ë…¸íŠ¸ë¶ì˜ íŠ¹ì • ì…€ì„ ì‚­ì œí•©ë‹ˆë‹¤. **ë˜ëŒë¦¬ê¸° ì–´ë ¤ìš°ë¯€ë¡œ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.**

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `cellId` | ì‚­ì œí•  ì…€ ID | í•„ìˆ˜ |

```json
{
  "tool": "delete_cell",
  "parameters": {
    "cellId": "cell-uuid-1234"
  }
}
```

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ¡ medium (ìŠ¹ì¸ í•„ìš”)

### get_cell_output

íŠ¹ì • ì…€ì˜ ì‹¤í–‰ ì¶œë ¥ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `cellId` | ì¡°íšŒí•  ì…€ ID | í•„ìˆ˜ |
| `outputType` | ì¶œë ¥ íƒ€ì… í•„í„° | ì—†ìŒ (ì „ì²´) |

```json
{
  "tool": "get_cell_output",
  "parameters": {
    "cellId": "cell-uuid-1234",
    "outputType": "execute_result"
  }
}
```

**ì¶œë ¥ íƒ€ì…:** `execute_result`, `stream`, `error`, `display_data`

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ¢ low (ì½ê¸° ì „ìš©)

### create_notebook

ìƒˆ Jupyter ë…¸íŠ¸ë¶ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `path` | ë…¸íŠ¸ë¶ ê²½ë¡œ | í•„ìˆ˜ |
| `kernel` | ì»¤ë„ ì´ë¦„ | `python3` |

```json
{
  "tool": "create_notebook",
  "parameters": {
    "path": "notebooks/analysis.ipynb",
    "kernel": "python3"
  }
}
```

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ¡ medium (ë¹„íŒŒê´´ì )

### create_folder

ìƒˆ í´ë”(ë””ë ‰í† ë¦¬)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `path` | í´ë” ê²½ë¡œ | í•„ìˆ˜ |

```json
{
  "tool": "create_folder",
  "parameters": {
    "path": "data/output"
  }
}
```

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ¢ low (ë¹„íŒŒê´´ì )

### delete_file

íŒŒì¼ ë˜ëŠ” í´ë”ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤. **ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í•­ìƒ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.**

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `path` | ì‚­ì œí•  ê²½ë¡œ | í•„ìˆ˜ |
| `recursive` | í´ë” ì¬ê·€ ì‚­ì œ | `false` |

```json
{
  "tool": "delete_file",
  "parameters": {
    "path": "temp/old_data.csv",
    "recursive": false
  }
}
```

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸ”´ critical (í•­ìƒ ìŠ¹ì¸ í•„ìš”)

### git_operations

Git ë²„ì „ ê´€ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. **push/commit ì‘ì—…ì€ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.**

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `operation` | Git ì‘ì—… ì¢…ë¥˜ | í•„ìˆ˜ |
| `files` | ëŒ€ìƒ íŒŒì¼ë“¤ | `[]` |
| `message` | ì»¤ë°‹ ë©”ì‹œì§€ | ì—†ìŒ |
| `branch` | ë¸Œëœì¹˜ ì´ë¦„ | ì—†ìŒ |
| `count` | ë¡œê·¸ ê°œìˆ˜ | `10` |
| `all` | ëª¨ë“  íŒŒì¼ ëŒ€ìƒ | `false` |

**ì§€ì› ì‘ì—…:**

| operation | ì„¤ëª… | ìŠ¹ì¸ í•„ìš” |
|-----------|------|----------|
| `status` | ë³€ê²½ ìƒíƒœ ì¡°íšŒ | âœ— |
| `diff` | ë³€ê²½ ë‚´ìš© ë¹„êµ | âœ— |
| `log` | ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ì¡°íšŒ | âœ— |
| `add` | ìŠ¤í…Œì´ì§• ì¶”ê°€ | âœ— |
| `commit` | ì»¤ë°‹ ìƒì„± | âœ“ |
| `push` | ì›ê²© í‘¸ì‹œ | âœ“ |
| `pull` | ì›ê²© í’€ | âœ— |
| `branch` | ë¸Œëœì¹˜ ìƒì„±/ì¡°íšŒ | âœ— |
| `checkout` | ë¸Œëœì¹˜ ì „í™˜ | âœ— |
| `stash` | ì„ì‹œ ì €ì¥ | âœ— |

```json
{
  "tool": "git_operations",
  "parameters": {
    "operation": "commit",
    "message": "feat: add data processing module",
    "all": true
  }
}
```

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ  high (push/commitë§Œ ìŠ¹ì¸ í•„ìš”)

### run_tests

pytest ë˜ëŠ” unittestë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `path` | í…ŒìŠ¤íŠ¸ ê²½ë¡œ | `tests/` |
| `pattern` | í…ŒìŠ¤íŠ¸ íŒŒì¼ íŒ¨í„´ | `test_*.py` |
| `verbose` | ìƒì„¸ ì¶œë ¥ | `false` |
| `coverage` | ì»¤ë²„ë¦¬ì§€ ì¸¡ì • | `false` |
| `framework` | í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ | `pytest` |

```json
{
  "tool": "run_tests",
  "parameters": {
    "path": "tests/unit",
    "verbose": true,
    "coverage": true,
    "framework": "pytest"
  }
}
```

**ì‘ë‹µ ì˜ˆì‹œ:**
```json
{
  "success": true,
  "output": "...",
  "stats": {
    "passed": 15,
    "failed": 2,
    "skipped": 1,
    "total": 18,
    "duration": 3.45
  }
}
```

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ¡ medium (ì½ê¸° ìœ„ì£¼)

### refactor_code

ì½”ë“œ ë¦¬íŒ©í† ë§ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. **ì½”ë“œ ë³€ê²½ì´ë¯€ë¡œ í•­ìƒ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.**

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | ê¸°ë³¸ê°’ |
|----------|------|--------|
| `operation` | ë¦¬íŒ©í† ë§ ì¢…ë¥˜ | í•„ìˆ˜ |
| `path` | íŒŒì¼ ê²½ë¡œ | í•„ìˆ˜ |
| `oldName` | ê¸°ì¡´ ì´ë¦„ | í•„ìˆ˜ (rename ì‹œ) |
| `newName` | ìƒˆ ì´ë¦„ | í•„ìˆ˜ (rename/extract ì‹œ) |
| `lineStart` | ì‹œì‘ ë¼ì¸ | í•„ìˆ˜ (extract ì‹œ) |
| `lineEnd` | ì¢…ë£Œ ë¼ì¸ | í•„ìˆ˜ (extract ì‹œ) |

**ì§€ì› ì‘ì—…:**

| operation | ì„¤ëª… |
|-----------|------|
| `rename_variable` | ë³€ìˆ˜ ì´ë¦„ ë³€ê²½ |
| `rename_function` | í•¨ìˆ˜ ì´ë¦„ ë³€ê²½ |
| `extract_function` | ì½”ë“œ ë¸”ë¡ì„ í•¨ìˆ˜ë¡œ ì¶”ì¶œ |
| `inline_variable` | ë³€ìˆ˜ë¥¼ ì¸ë¼ì¸ìœ¼ë¡œ ëŒ€ì²´ |

```json
{
  "tool": "refactor_code",
  "parameters": {
    "operation": "rename_function",
    "path": "src/utils.py",
    "oldName": "process_data",
    "newName": "transform_dataset"
  }
}
```

```json
{
  "tool": "refactor_code",
  "parameters": {
    "operation": "extract_function",
    "path": "src/main.py",
    "lineStart": 45,
    "lineEnd": 60,
    "newName": "calculate_statistics"
  }
}
```

**ìœ„í—˜ ìˆ˜ì¤€:** ğŸŸ  high (í•­ìƒ ìŠ¹ì¸ í•„ìš”)

---

## ë„êµ¬ ìœ„í—˜ ìˆ˜ì¤€ ìš”ì•½

| ìœ„í—˜ ìˆ˜ì¤€ | ë„êµ¬ ëª©ë¡ |
|----------|----------|
| ğŸŸ¢ low | `markdown`, `final_answer`, `read_file`, `list_files`, `search_files`, `get_cell_output`, `create_folder` |
| ğŸŸ¡ medium | `jupyter_cell`, `lint_file`, `delete_cell`, `create_notebook`, `run_tests` |
| ğŸŸ  high | `write_file`, `git_operations`, `install_package`, `refactor_code` |
| ğŸ”´ critical | `execute_command`, `delete_file` |

**ìŠ¹ì¸ ì •ì±…:**
- ğŸŸ¢ low: ìŠ¹ì¸ ë¶ˆí•„ìš”
- ğŸŸ¡ medium: ì¡°ê±´ë¶€ ìŠ¹ì¸ (ì¼ë¶€ ì‘ì—…ë§Œ)
- ğŸŸ  high: ì¡°ê±´ë¶€ ìŠ¹ì¸ (ìœ„í—˜ ì‘ì—…ë§Œ) ë˜ëŠ” í•­ìƒ ìŠ¹ì¸
- ğŸ”´ critical: í•­ìƒ ìŠ¹ì¸ í•„ìš”

---

## ê²°ì •ë¡ ì  ì„œë¸Œì‹œìŠ¤í…œ

LLM í˜¸ì¶œ ì—†ì´ íŒ¨í„´ ë§¤ì¹­ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” ì„œë¸Œì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### ErrorClassifier

ì—ëŸ¬ ìœ í˜•ì„ íŒ¨í„´ ê¸°ë°˜ìœ¼ë¡œ ë¶„ë¥˜í•˜ì—¬ ì¬ê³„íš ê²°ì •ì„ ë‚´ë¦½ë‹ˆë‹¤.

```python
# agent-server/agent_server/core/error_classifier.py

class ReplanDecision(Enum):
    REFINE = "refine"           # í˜„ì¬ step ì½”ë“œë§Œ ìˆ˜ì •
    INSERT_STEPS = "insert_steps"  # ìƒˆ step ì‚½ì…
    REPLACE_STEP = "replace_step"  # step êµì²´
    REPLAN_REMAINING = "replan_remaining"  # ë‚˜ë¨¸ì§€ ì „ì²´ ì¬ê³„íš
    ABORT = "abort"             # ì¤‘ë‹¨
```

**ë¶„ë¥˜ ê·œì¹™ ì˜ˆì‹œ:**
| ì—ëŸ¬ íŒ¨í„´ | ê²°ì • |
|-----------|------|
| `SyntaxError`, `IndentationError` | REFINE |
| `ModuleNotFoundError`, `ImportError` | INSERT_STEPS (import ì¶”ê°€) |
| `NameError` (ë¯¸ì •ì˜ ë³€ìˆ˜) | REPLAN_REMAINING |
| `PermissionError`, `OSError` | ABORT |

#### LLM Fallback ë©”ì»¤ë‹ˆì¦˜

íŒ¨í„´ ë§¤ì¹­ë§Œìœ¼ë¡œ í•´ê²°ì´ ì–´ë ¤ìš´ ë³µì¡í•œ ì—ëŸ¬ì˜ ê²½ìš°, LLM ê¸°ë°˜ ë¶„ì„ìœ¼ë¡œ í´ë°±í•©ë‹ˆë‹¤.

**LLM Fallback íŠ¸ë¦¬ê±° ì¡°ê±´:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì—ëŸ¬ ë°œìƒ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¡°ê±´ #1: ë™ì¼ ì—ëŸ¬ë¡œ 2íšŒ ì´ìƒ ì‹¤íŒ¨?                                       â”‚
â”‚  (previousAttempts >= 2)                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Yes                           â”‚ No
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  LLM Fallback â”‚            â”‚  ì¡°ê±´ #2: ë¯¸ì§€ì˜ ì—ëŸ¬ íƒ€ì…?        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  (íŒ¨í„´ ë§¤í•‘ì— ì—†ìŒ)                â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Yes                           â”‚ No
                                    â–¼                               â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  LLM Fallback â”‚        â”‚  ì¡°ê±´ #3: ë³µì¡í•œ íŠ¸ë ˆì´ìŠ¤ë°±?       â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  (2ê°œ ì´ìƒ Exception í¬í•¨)        â”‚
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                â”‚
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚ Yes                           â”‚ No
                                                â–¼                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  LLM Fallback â”‚            â”‚  íŒ¨í„´ ë§¤ì¹­    â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API ì‘ë‹µ í™•ì¥:**
```python
class ReplanResponse:
    decision: str       # refine/insert_steps/replace_step/replan_remaining
    analysis: Dict      # ë¶„ì„ ìƒì„¸ ì •ë³´
    reasoning: str      # ê²°ì • ì´ìœ 
    changes: Dict       # ì œì•ˆëœ ë³€ê²½ì‚¬í•­
    usedLlm: bool       # LLM í´ë°± ì‚¬ìš© ì—¬ë¶€ (NEW)
    confidence: float   # ë¶„ì„ ì‹ ë¢°ë„ 0.0~1.0 (NEW)
```

**ì‹ ë¢°ë„ ì ìˆ˜:**
- `1.0`: íŒ¨í„´ ë§¤ì¹­ (ê²°ì •ë¡ ì )
- `0.8~0.95`: LLM ë¶„ì„ (ë†’ì€ ì‹ ë¢°ë„)
- `0.3~0.7`: LLM ë¶„ì„ (ë‚®ì€ ì‹ ë¢°ë„, íŒŒì‹± ì‹¤íŒ¨ ë“±)

### StateVerifier

ì‹¤í–‰ ê²°ê³¼ì˜ ìƒíƒœë¥¼ ê²€ì¦í•˜ê³  ì‹ ë¢°ë„ ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.

```python
# agent-server/agent_server/core/state_verifier.py

class VerificationResult:
    verified: bool           # ê²€ì¦ í†µê³¼ ì—¬ë¶€
    confidence: float        # ì‹ ë¢°ë„ (0.0 ~ 1.0)
    discrepancies: List[str] # ë¶ˆì¼ì¹˜ í•­ëª©
```

**ì‹ ë¢°ë„ ê³„ì‚° ê¸°ì¤€:**
- ì¶œë ¥ ì¡´ì¬ ì—¬ë¶€
- ì˜ˆìƒ ë³€ìˆ˜ ì •ì˜ ì—¬ë¶€
- ì—ëŸ¬ ë°œìƒ ì—¬ë¶€
- ì‹¤í–‰ ì‹œê°„ ì •ìƒ ë²”ìœ„ ì—¬ë¶€

### LibraryDetector

ìš”ì²­ í…ìŠ¤íŠ¸ì—ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í‚¤ì›Œë“œë¥¼ ê°ì§€í•©ë‹ˆë‹¤.

```python
# agent-server/agent_server/knowledge/loader.py

# í‚¤ì›Œë“œ ìŠ¤ì½”ì–´ë§ìœ¼ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°ì§€
detected = detector.detect(
    request="daskë¡œ ëŒ€ìš©ëŸ‰ CSV ë³‘ë ¬ ì²˜ë¦¬",
    available_libraries=["dask", "polars", "pandas"],
    imported_libraries=["pandas"]
)
# ê²°ê³¼: ["dask"]
```

---

## Knowledge Base ë™ì  ë¡œë”© (Local RAG)

ì‚¬ìš©ì ìš”ì²­ì—ì„œ íŠ¹ì • ë¼ì´ë¸ŒëŸ¬ë¦¬ í‚¤ì›Œë“œë¥¼ ê°ì§€í•˜ë©´, í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ API ê°€ì´ë“œë¥¼ ìë™ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.

### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ì ìš”ì²­: "daskë¡œ ëŒ€ìš©ëŸ‰ CSV ë³‘ë ¬ ì²˜ë¦¬í•´ì¤˜"                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. í‚¤ì›Œë“œ ê°ì§€ (LibraryDetector)                                        â”‚
â”‚     - "dask" í‚¤ì›Œë“œ ë§¤ì¹­                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ì„ë² ë”© ìƒì„± (multilingual-e5-small)                                  â”‚
â”‚     - ìš”ì²­ í…ìŠ¤íŠ¸ â†’ 384ì°¨ì› ë²¡í„°                                          â”‚
â”‚     - CPUì—ì„œ ë¡œì»¬ inference (ì™¸ë¶€ API ì—†ìŒ)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ë²¡í„° ê²€ìƒ‰ (Qdrant)                                                   â”‚
â”‚     - ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê¸°ë°˜ ê²€ìƒ‰                                              â”‚
â”‚     - Top-K ìœ ì‚¬ ë¬¸ì„œ ë°˜í™˜                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±                                                         â”‚
â”‚     - ê²€ìƒ‰ëœ ë¬¸ì„œ ì²­í¬ + ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì´ë“œ ì¡°í•©                              â”‚
â”‚     - í”Œë˜ë‹ í”„ë¡¬í”„íŠ¸ì— ì£¼ì…                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### êµ¬ì„± ìš”ì†Œ

| ì»´í¬ë„ŒíŠ¸ | ê¸°ìˆ  | ì—­í•  |
|----------|------|------|
| **ì„ë² ë”© ëª¨ë¸** | `intfloat/multilingual-e5-small` | í…ìŠ¤íŠ¸ â†’ 384ì°¨ì› ë²¡í„° (í•œêµ­ì–´ ì§€ì›) |
| **ë²¡í„° DB** | Qdrant (Docker ë˜ëŠ” In-Memory) | ë²¡í„° ì €ì¥ ë° ìœ ì‚¬ë„ ê²€ìƒ‰ |
| **ë¬¸ì„œ ì²­í‚¹** | LangChain RecursiveCharacterTextSplitter | ë§ˆí¬ë‹¤ìš´ ë¬¸ì„œ ë¶„í•  (1000ì, 200 overlap) |

### ì§€ì› ë¼ì´ë¸ŒëŸ¬ë¦¬

| íŠ¸ë¦¬ê±° í‚¤ì›Œë“œ | ë¡œë“œë˜ëŠ” ê°€ì´ë“œ |
|--------------|----------------|
| `dask`, `dask.dataframe`, `dd.read` | `dask.md` |
| `polars`, `pl.read` | `polars.md` |
| `pyspark`, `spark` | `pyspark.md` |
| `vaex` | `vaex.md` |
| `modin` | `modin.md` |
| `ray` | `ray.md` |

### ì˜ˆì‹œ: Dask ìš”ì²­ ì²˜ë¦¬

```
ì‚¬ìš©ì: "daskë¡œ ëŒ€ìš©ëŸ‰ CSV íŒŒì¼ì„ ë³‘ë ¬ ì²˜ë¦¬í•´ì¤˜"
         â†“
1. "dask" í‚¤ì›Œë“œ ê°ì§€
2. ìš”ì²­ í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„± (multilingual-e5-small)
3. Qdrantì—ì„œ ìœ ì‚¬ ë¬¸ì„œ ì²­í¬ ê²€ìƒ‰
4. dask.md ê°€ì´ë“œ + ê²€ìƒ‰ëœ ì²­í¬ ê²°í•©
5. í”Œë˜ë‹ í”„ë¡¬í”„íŠ¸ì— ì»¨í…ìŠ¤íŠ¸ ì£¼ì…
6. LLMì´ ì˜¬ë°”ë¥¸ Dask ë¬¸ë²•ìœ¼ë¡œ ê³„íš ìƒì„±
```

### ì½”ë“œ ìœ„ì¹˜

| íŒŒì¼ | ì—­í•  |
|------|------|
| `agent-server/agent_server/knowledge/loader.py` | ì§€ì‹ ë¡œë” |
| `agent-server/agent_server/rag/embedding_manager.py` | ì„ë² ë”© ìƒì„± |
| `agent-server/agent_server/rag/qdrant_manager.py` | ë²¡í„° DB ê´€ë¦¬ |
| `agent-server/agent_server/knowledge/libraries/*.md` | ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì´ë“œ |

---

## Pre-Validation (ì‚¬ì „ ê²€ì¦)

ì‹¤í–‰ ì „ ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### ê²€ì¦ ë„êµ¬ ë¹„êµ

| ë„êµ¬ | íŠ¹ì§• | ê²€ì‚¬ ë²”ìœ„ |
|------|------|----------|
| **Ruff** | Rust ê¸°ë°˜ ì´ˆê³ ì† ë¦°í„° (700+ ê·œì¹™) | F (Pyflakes), E/W (ìŠ¤íƒ€ì¼), S (ë³´ì•ˆ), B (ë²„ê·¸ íŒ¨í„´) |
| **AST** | Python ë‚´ì¥ íŒŒì„œ | êµ¬ë¬¸ ë¶„ì„, ì˜ì¡´ì„± ì¶”ì¶œ |

### Ruff ê·œì¹™ ì¹´í…Œê³ ë¦¬

| ê·œì¹™ ì½”ë“œ | ì¹´í…Œê³ ë¦¬ | ì„¤ëª… | ì‹¬ê°ë„ |
|----------|---------|------|--------|
| F821 | undefined_name | ë¯¸ì •ì˜ ë³€ìˆ˜/í•¨ìˆ˜ | ERROR |
| F401 | unused_import | ë¯¸ì‚¬ìš© import | WARNING |
| S102 | security | `exec()` ì‚¬ìš© ê°ì§€ | WARNING |
| E9xx | syntax | ëŸ°íƒ€ì„ ì—ëŸ¬ | ERROR |

### Ruff ìë™ ìˆ˜ì • (--fix)

ì½”ë“œ ê²€ì¦ ì‹œ Ruffì˜ ìë™ ìˆ˜ì • ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ LLM í† í°ì„ ì ˆì•½í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì½”ë“œ ê²€ì¦ ìš”ì²­                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pass 1: ruff check --fix                                               â”‚
â”‚  - ìë™ ìˆ˜ì • ê°€ëŠ¥í•œ ì´ìŠˆ ìë™ ì²˜ë¦¬                                         â”‚
â”‚  - F401 (ë¯¸ì‚¬ìš© import), W (ìŠ¤íƒ€ì¼) ë“± ìë™ ìˆ˜ì •                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pass 2: ruff check (ê²€ì¦ ì „ìš©)                                          â”‚
â”‚  - ìë™ ìˆ˜ì • ë¶ˆê°€ëŠ¥í•œ ì´ìŠˆë§Œ ë°˜í™˜                                           â”‚
â”‚  - F821 (ë¯¸ì •ì˜ ë³€ìˆ˜), S (ë³´ì•ˆ) ë“±                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ì´ìŠˆ ì—†ìŒ    â”‚                â”‚  ì´ìŠˆ ìˆìŒ    â”‚
            â”‚  (ìˆ˜ì •ëœ ì½”ë“œ) â”‚                â”‚  (LLMì— ì „ë‹¬) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API ì‘ë‹µ í™•ì¥:**
```python
class ValidateResponse:
    valid: bool                     # ê²€ì¦ í†µê³¼ ì—¬ë¶€
    issues: List[ValidationIssue]   # ìë™ ìˆ˜ì • ë¶ˆê°€ ì´ìŠˆ
    fixedCode: Optional[str]        # ìë™ ìˆ˜ì •ëœ ì½”ë“œ (NEW)
    fixedCount: int                 # ìë™ ìˆ˜ì •ëœ ì´ìŠˆ ìˆ˜ (NEW)
```

**íš¨ê³¼:**
- ìŠ¤íƒ€ì¼/í¬ë§·íŒ… ì´ìŠˆëŠ” LLM í˜¸ì¶œ ì—†ì´ ì¦‰ì‹œ ìˆ˜ì •
- LLMì— ì „ë‹¬ë˜ëŠ” ì´ìŠˆ ìˆ˜ ê°ì†Œ â†’ í† í° ì ˆì•½
- ì‘ë‹µ ì†ë„ í–¥ìƒ

**ì½”ë“œ ìœ„ì¹˜:** `agent-server/agent_server/core/code_validator.py`

---

## Frontend ìƒíƒœ ë¨¸ì‹ 

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚    idle     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚ ì‚¬ìš©ì ìš”ì²­
                                           â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  planning   â”‚ â”€â”€â”€â”€ POST /agent/plan
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   planned   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”Œâ”€â”€â”€â”€ â”‚  executing  â”‚ â”€â”€â”€â”€â”
                              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                              â”‚ ì„±ê³µ                   ì˜¤ë¥˜ â”‚
                              â–¼                         â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ validating  â”‚          â”‚  reflecting â”‚
                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  verifying  â”‚          â”‚ replanning  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ completed â”‚                               â”‚  failed  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìƒíƒœ ì„¤ëª…

| ìƒíƒœ | ì„¤ëª… |
|------|------|
| `idle` | ëŒ€ê¸° ìƒíƒœ |
| `planning` | LLMì— ê³„íš ìš”ì²­ ì¤‘ |
| `planned` | ê³„íš ìˆ˜ë¦½ ì™„ë£Œ, ì‹¤í–‰ ëŒ€ê¸° |
| `executing` | í˜„ì¬ step ì‹¤í–‰ ì¤‘ |
| `validating` | ì½”ë“œ ì‚¬ì „ ê²€ì¦ ì¤‘ |
| `verifying` | ì‹¤í–‰ ê²°ê³¼ ìƒíƒœ ê²€ì¦ ì¤‘ |
| `reflecting` | ì˜¤ë¥˜ ë¶„ì„ ì¤‘ |
| `replanning` | ì¬ê³„íš ì¤‘ |
| `completed` | ëª¨ë“  step ì™„ë£Œ |
| `failed` | ë³µêµ¬ ë¶ˆê°€ ì˜¤ë¥˜ |

**ì½”ë“œ ìœ„ì¹˜:** `extensions/jupyter/frontend/services/AgentOrchestrator.ts`

---

## Rate Limit ì²˜ë¦¬

### ê°œìš”

API Rate Limit (429) ë°œìƒ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ API í‚¤ë¡œ êµì²´í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     429 ë°œìƒ      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API í˜¸ì¶œ     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  í‚¤ êµì²´       â”‚
â”‚   (Key #1)    â”‚                  â”‚  (Key #2)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚
       â”‚ ì„±ê³µ                             â”‚ ì¬ì‹œë„
       â–¼                                  â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   ì™„ë£Œ     â”‚                    â”‚  API ì¬í˜¸ì¶œ    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### fetchWithKeyRotation ë˜í¼

ëª¨ë“  LLM API í˜¸ì¶œì— ì „ì—­ìœ¼ë¡œ ì ìš©ë˜ëŠ” ë˜í¼ì…ë‹ˆë‹¤.

```typescript
// extensions/jupyter/frontend/services/ApiService.ts

private async fetchWithKeyRotation<T>(
  url: string,
  request: { llmConfig?: any; [key: string]: any },
  options?: {
    onKeyRotation?: (keyIndex: number, totalKeys: number) => void;
    defaultErrorMessage?: string;
  }
): Promise<T>
```

**íŠ¹ì§•:**
- ìµœëŒ€ 10íšŒ ì¬ì‹œë„
- ì„±ê³µ ì‹œ í‚¤ ë¡œí…Œì´ì…˜ ìƒíƒœ ë¦¬ì…‹
- ëª¨ë“  í‚¤ ì†Œì§„ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
- í”„ë¡ íŠ¸ì—”ë“œ ì „ìš© (ì„œë²„ëŠ” í‚¤ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŒ)

### ì ìš© API

- `generateExecutionPlan()`
- `refineStepCode()`
- `replanExecution()`
- `sendMessage()`
- `cellAction()`
- `fileAction()`
- `validateCode()`
- `reflectOnExecution()`
- `verifyState()`

**ì½”ë“œ ìœ„ì¹˜:**
- `extensions/jupyter/frontend/services/ApiService.ts`
- `extensions/jupyter/frontend/services/ApiKeyManager.ts`

---

## í•µì‹¬ íŒŒì¼ ìœ„ì¹˜

### Agent Server

| ì»´í¬ë„ŒíŠ¸ | íŒŒì¼ ê²½ë¡œ |
|----------|----------|
| API ë¼ìš°í„° | `agent-server/agent_server/routers/agent.py` |
| Chat ë¼ìš°í„° | `agent-server/agent_server/routers/chat.py` |
| í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ | `agent-server/agent_server/prompts/auto_agent_prompts.py` |
| Knowledge Base | `agent-server/agent_server/knowledge/loader.py` |
| ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì´ë“œ | `agent-server/agent_server/knowledge/libraries/*.md` |
| ì½”ë“œ ê²€ì¦ê¸° | `agent-server/agent_server/core/code_validator.py` |
| ì—ëŸ¬ ë¶„ë¥˜ê¸° | `agent-server/agent_server/core/error_classifier.py` |
| ìƒíƒœ ê²€ì¦ê¸° | `agent-server/agent_server/core/state_verifier.py` |
| LLM ì„œë¹„ìŠ¤ | `agent-server/agent_server/core/llm_service.py` |

### Frontend (JupyterLab Extension)

| ì»´í¬ë„ŒíŠ¸ | íŒŒì¼ ê²½ë¡œ |
|----------|----------|
| API ì„œë¹„ìŠ¤ | `extensions/jupyter/frontend/services/ApiService.ts` |
| API í‚¤ ê´€ë¦¬ | `extensions/jupyter/frontend/services/ApiKeyManager.ts` |
| ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° | `extensions/jupyter/frontend/services/AgentOrchestrator.ts` |
| ë„êµ¬ ì‹¤í–‰ê¸° | `extensions/jupyter/frontend/services/ToolExecutor.ts` |
| ì²´í¬í¬ì¸íŠ¸ ê´€ë¦¬ | `extensions/jupyter/frontend/services/CheckpointManager.ts` |
| ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ | `extensions/jupyter/frontend/services/ContextManager.ts` |
| íƒ€ì… ì •ì˜ | `extensions/jupyter/frontend/types/agent.ts` |

---

## ì•„í‚¤í…ì²˜ íŠ¹ì§•

1. **Self-Healing**: ì˜¤ë¥˜ ë°œìƒ ì‹œ ìë™ìœ¼ë¡œ ì½”ë“œ ìˆ˜ì • ì‹œë„
2. **Context-Aware**: ë…¸íŠ¸ë¶ ìƒíƒœë¥¼ ì§€ì†ì ìœ¼ë¡œ ì¶”ì 
3. **Knowledge-Enhanced**: ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ ì „ë¬¸ ì§€ì‹ ë™ì  ë¡œë”©
4. **Fail-Fast Validation**: ì‹¤í–‰ ì „ ì½”ë“œ í’ˆì§ˆ ì‚¬ì „ ê²€ì¦ + Ruff ìë™ ìˆ˜ì •
5. **Adaptive Planning**: ìƒí™©ì— ë”°ë¥¸ ìœ ì—°í•œ ê³„íš ìˆ˜ì •
6. **Deterministic Subsystems**: ì—ëŸ¬ ë¶„ë¥˜/ìƒíƒœ ê²€ì¦ì€ LLM ì—†ì´ ì²˜ë¦¬
7. **LLM Fallback**: íŒ¨í„´ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ LLM ê¸°ë°˜ ì—ëŸ¬ ë¶„ì„
8. **Extended Toolset**: 18ê°œ ë‚´ì¥ ë„êµ¬ (íŒŒì¼, ì…¸, Git, í…ŒìŠ¤íŠ¸, ë¦¬íŒ©í† ë§ ë“±)
9. **Rate Limit Resilience**: ìë™ API í‚¤ êµì²´ë¡œ ì„œë¹„ìŠ¤ ì—°ì†ì„± ë³´ì¥

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

### ë£¨íŠ¸ ë””ë ‰í† ë¦¬

```
hdsp_agent/
â”œâ”€â”€ agent-server/             # FastAPI ë°±ì—”ë“œ ì„œë²„ (ë…ë¦½ ì‹¤í–‰)
â”œâ”€â”€ extensions/
â”‚   â””â”€â”€ jupyter/              # JupyterLab í™•ì¥ (Thin Client)
â”œâ”€â”€ docs/                     # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â”œâ”€â”€ ui-tests/                 # Playwright E2E í…ŒìŠ¤íŠ¸
â”œâ”€â”€ .taskmaster/              # Task ê´€ë¦¬ ì„¤ì •
â”œâ”€â”€ .serena/                  # í”„ë¡œì íŠ¸ ë©”ëª¨ë¦¬
â”œâ”€â”€ pyproject.toml            # ë£¨íŠ¸ Poetry ì„¤ì •
â”œâ”€â”€ build.sh                  # ë¹Œë“œ ìë™í™” ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ CLAUDE.md                 # Claude Code ì§€ì¹¨
â””â”€â”€ README.md                 # ë©”ì¸ ë¬¸ì„œ
```

### Agent Server êµ¬ì¡°

```
agent-server/
â”œâ”€â”€ pyproject.toml                # FastAPI ì˜ì¡´ì„±
â””â”€â”€ agent_server/
    â”œâ”€â”€ main.py                   # FastAPI ì•± ì§„ì…ì 
    â”œâ”€â”€ routers/                  # API ì—”ë“œí¬ì¸íŠ¸
    â”‚   â”œâ”€â”€ agent.py              # /agent/* (Auto-Agent)
    â”‚   â”œâ”€â”€ chat.py               # /chat/* (ì±„íŒ…)
    â”‚   â””â”€â”€ health.py             # GET / (í—¬ìŠ¤ì²´í¬)
    â”œâ”€â”€ schemas/                  # Pydantic ë°ì´í„° ëª¨ë¸
    â”œâ”€â”€ core/                     # í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    â”‚   â”œâ”€â”€ llm_service.py        # LLM í”„ë¡œë°”ì´ë” (Gemini/OpenAI)
    â”‚   â”œâ”€â”€ code_validator.py     # ì½”ë“œ íŒŒì‹± ë° ê²€ì¦
    â”‚   â”œâ”€â”€ state_verifier.py     # ì‹¤í–‰ ìƒíƒœ ê²€ì¦
    â”‚   â””â”€â”€ error_classifier.py   # ì—ëŸ¬ ë¶„ë¥˜
    â”œâ”€â”€ prompts/                  # LLM í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
    â”œâ”€â”€ knowledge/                # Knowledge Base (ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì´ë“œ)
    â”œâ”€â”€ rag/                      # Local RAG (Qdrant + ì„ë² ë”©)
    â”‚   â”œâ”€â”€ embedding_manager.py  # ì„ë² ë”© ìƒì„±
    â”‚   â””â”€â”€ qdrant_manager.py     # ë²¡í„° DB ê´€ë¦¬
    â””â”€â”€ tests/                    # pytest í…ŒìŠ¤íŠ¸
```

### Jupyter Extension êµ¬ì¡°

```
extensions/jupyter/
â”œâ”€â”€ jupyter_ext/                  # Python ë°±ì—”ë“œ (í”„ë¡ì‹œ)
â”‚   â”œâ”€â”€ handlers.py               # í”„ë¡ì‹œ í•¸ë“¤ëŸ¬
â”‚   â””â”€â”€ config.py                 # Agent Server URL ì„¤ì •
â”‚
â””â”€â”€ frontend/                     # React/TypeScript UI
    â”œâ”€â”€ components/               # React ì»´í¬ë„ŒíŠ¸
    â”‚   â”œâ”€â”€ AgentPanel.tsx        # ë©”ì¸ ì—ì´ì „íŠ¸ ì¸í„°í˜ì´ìŠ¤
    â”‚   â”œâ”€â”€ AutoAgentPanel.tsx    # Auto-Agent ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
    â”‚   â””â”€â”€ ApprovalDialog.tsx    # ì‹¤í–‰ ìŠ¹ì¸ ë‹¤ì´ì–¼ë¡œê·¸
    â”œâ”€â”€ services/                 # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    â”‚   â”œâ”€â”€ ApiService.ts         # REST API í´ë¼ì´ì–¸íŠ¸
    â”‚   â”œâ”€â”€ AgentOrchestrator.ts  # ì›Œí¬í”Œë¡œìš° ê´€ë¦¬
    â”‚   â”œâ”€â”€ ToolRegistry.ts       # ë„êµ¬ ë“±ë¡
    â”‚   â””â”€â”€ ToolExecutor.ts       # ë„êµ¬ ì‹¤í–‰
    â”œâ”€â”€ types/                    # TypeScript íƒ€ì… ì •ì˜
    â””â”€â”€ plugins/                  # JupyterLab í”ŒëŸ¬ê·¸ì¸
```

---

## ë°ì´í„° íë¦„

### A. ê³„íš ìƒì„± íë¦„ (REST API ê²½ìœ )

```
ì‚¬ìš©ì ì…ë ¥ (AutoAgentPanel.tsx)
        â”‚
        â–¼
ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘ (ContextManager.ts)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApiService.ts                                                 â”‚
â”‚  â””â”€â–¶ POST /hdsp-agent/auto-agent/plan                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼  (jupyter_ext í”„ë¡ì‹œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  jupyter_ext/handlers.py                                       â”‚
â”‚  â””â”€â–¶ í¬ì›Œë”©: /hdsp-agent/* â†’ Agent Server                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼  HTTP (Port 8000)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent Server (FastAPI)                                        â”‚
â”‚  â”œâ”€â–¶ routers/agent.py (ìš”ì²­ íŒŒì‹±)                              â”‚
â”‚  â”œâ”€â–¶ rag/ (Local RAG - ì„ë² ë”© + ë²¡í„° ê²€ìƒ‰)                      â”‚
â”‚  â”œâ”€â–¶ knowledge/loader.py (ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§€ì‹ ë¡œë“œ)                 â”‚
â”‚  â””â”€â–¶ core/llm_service.py (LLM í˜¸ì¶œ)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    ê³„íš ë°˜í™˜ â†’ AgentOrchestrator.ts
```

### B. ë„êµ¬ ì‹¤í–‰ íë¦„ (Jupyter API)

```
AgentOrchestrator.executeStep()
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ToolExecutor.executeTool()                                    â”‚
â”‚  â””â”€â–¶ ë„êµ¬ ìœ í˜•ì— ë”°ë¼ ë¶„ê¸°                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼  (HTTP/REST - Jupyter API)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Jupyter Server                                                â”‚
â”‚  â”œâ”€â–¶ Contents API                    â†’ íŒŒì¼/ë…¸íŠ¸ë¶ ì¡°ì‘         â”‚
â”‚  â”œâ”€â–¶ Kernels API                     â†’ ì»¤ë„ ê´€ë¦¬               â”‚
â”‚  â””â”€â–¶ Sessions API                    â†’ ì„¸ì…˜ ê´€ë¦¬               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼  (ZMQ - ì»¤ë„ í†µì‹ )
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kernel (IPython)                                              â”‚
â”‚  â”œâ”€â–¶ model.sharedModel.insertCell()  â†’ ì…€ ìƒì„±                 â”‚
â”‚  â”œâ”€â–¶ NotebookActions.run()           â†’ ì…€ ì‹¤í–‰                 â”‚
â”‚  â””â”€â–¶ cell.model.outputs              â†’ ê²°ê³¼ ìº¡ì²˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë¹Œë“œ ë° ì‹¤í–‰

### Agent Server ì‹¤í–‰

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
cd agent-server
poetry install

# ì„œë²„ ì‹¤í–‰ (í¬íŠ¸ 8000)
poetry run uvicorn agent_server.main:app --host 0.0.0.0 --port 8000 --reload
```

### Jupyter Extension ë¹Œë“œ

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
cd extensions/jupyter
pip install -e .
jlpm install

# ê°œë°œ ëª¨ë“œ ë¹Œë“œ
jlpm build

# JupyterLabì— ì„¤ì¹˜
jupyter labextension develop . --overwrite
```

### JupyterLab ì‹¤í–‰

```bash
# Agent Serverê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•¨
jupyter lab
```

---

## í…ŒìŠ¤íŠ¸ ì „ëµ

### VCR.py ê¸°ë°˜ í…ŒìŠ¤íŠ¸

LLM API ì‘ë‹µì„ ë…¹í™”í•˜ì—¬ ì¬ìƒí•©ë‹ˆë‹¤ (í† í° ì†Œë¹„ 0).

```bash
# ìµœì´ˆ ë…¹í™” (í† í° ì†Œë¹„)
poetry run pytest tests/ --record-mode=once

# ì¬ìƒ (í† í° 0)
poetry run pytest tests/
```

### E2E í…ŒìŠ¤íŠ¸

Playwright + Galataë¡œ UI í…ŒìŠ¤íŠ¸:

```bash
cd extensions/jupyter
jlpm test:ui          # í—¤ë“œë¦¬ìŠ¤
jlpm test:ui:headed   # ë¸Œë¼ìš°ì € í‘œì‹œ
```

---

## ì°¸ê³  í”„ë¡œì íŠ¸

ê°œë°œ ê³¼ì •ì—ì„œ ë‹¤ìŒ ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¥¼ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤:
- [Roo Code](https://github.com/RooVetGit/Roo-Code)
- [Cline](https://github.com/cline/cline)
- [Continue](https://github.com/continuedev/continue)
- [Void](https://github.com/voideditor/void)
