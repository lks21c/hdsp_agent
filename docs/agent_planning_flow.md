# HDSP Agent - Plan-and-Execute ì•„í‚¤í…ì²˜ íë¦„

## ê°œìš”

HDSP AgentëŠ” HuggingFace Jupyter Agentì—ì„œ ì˜ê°ì„ ë°›ì€ **Plan-and-Execute íŒ¨í„´**ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
ì‚¬ìš©ì ìš”ì²­ì„ ë°›ì•„ ê³„íšì„ ìˆ˜ë¦½í•˜ê³ , ë‹¨ê³„ë³„ë¡œ ì‹¤í–‰í•˜ë©°, ì˜¤ë¥˜ ë°œìƒ ì‹œ ì ì‘ì ìœ¼ë¡œ ì¬ê³„íší•©ë‹ˆë‹¤.

### ì•„í‚¤í…ì²˜ ê°œìš”

HDSP AgentëŠ” **Agent Server ë¶„ë¦¬ ì•„í‚¤í…ì²˜**ë¥¼ ì±„íƒí•˜ë©°, ë‘ ê°€ì§€ í†µì‹  ê²½ë¡œ [A], [B]ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              JupyterLab Extension                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Frontend (TypeScript/React)                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚   ApiService    â”‚  â”‚  ToolExecutor   â”‚  â”‚ AgentOrchestrator â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚ (REST API í˜¸ì¶œ)  â”‚  â”‚ (Jupyter API)   â”‚  â”‚   (ìƒíƒœ ë¨¸ì‹ )      â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚       [A] â”‚ REST API       [B] â”‚ HTTP/REST                                        â”‚  â”‚
â”‚  â”‚           â–¼                    â–¼                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                    â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               jupyter_ext (Python Backend - HTTP Proxy)                           â”‚  â”‚
â”‚  â”‚  /hdsp-agent/* â†’ Agent Server í¬ì›Œë”© [A]                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Jupyter Server â—„â”€â”€â”€â”€â”€â”€â”€[B]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â€¢ Session Manager    â€¢ Kernel Manager    â€¢ Contents/Kernels API                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚ ZMQ                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Kernel (IPython) - ì½”ë“œ ì‹¤í–‰                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                [A] â”‚ HTTP/REST (Port 8000)
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         Agent Server              â”‚
                    â”‚          (FastAPI)                â”‚
                    â”‚  â”œâ”€â–¶ routers/agent.py            â”‚
                    â”‚  â”œâ”€â–¶ LLMService (Gemini/OpenAI)  â”‚
                    â”‚  â”œâ”€â–¶ ErrorClassifier (íŒ¨í„´+LLM)  â”‚
                    â”‚  â””â”€â–¶ StateVerifier (ê²°ì •ë¡ ì )    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í†µì‹  ê²½ë¡œ (2ê°€ì§€):**
- **A. REST API (í”„ë¡ì‹œ ê²½ìœ )**: Frontend â†’ jupyter_ext â†’ Agent Server â†’ LLM
  - ìš©ë„: ê³„íš ìƒì„±, ì½”ë“œ ê²€ì¦, ì—ëŸ¬ ë¶„ë¥˜, ë¦¬í”Œëœ
  - í”„ë¡ì‹œ ì‚¬ìš© ì´ìœ : CORS í•´ê²°, Jupyter ì„¸ì…˜ ì¸ì¦ ìë™ ì²˜ë¦¬, Agent Server ë‚´ë¶€ë§ ê²©ë¦¬
- **B. Jupyter API (ì§ì ‘ í˜¸ì¶œ)**: ToolExecutor â†’ Jupyter Server â†’ Kernel
  - ìš©ë„: ì…€ ìƒì„±/ì‹¤í–‰, íŒŒì¼ ì‘ì—…, ì¶œë ¥ ìº¡ì²˜
  - Agent Serverë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì§ì ‘ Jupyter Native API ì‚¬ìš©

**ì„¤ê³„ ì›ì¹™:**
- **í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ë¶„ë¦¬**: FrontendëŠ” ë„êµ¬ ì‹¤í–‰ë§Œ, Agent ServerëŠ” LLM í˜¸ì¶œ ë‹´ë‹¹
- **API í‚¤ ë³´ì•ˆ**: ì„œë²„ëŠ” API í‚¤ë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŒ (ìš”ì²­ë§ˆë‹¤ í´ë¼ì´ì–¸íŠ¸ê°€ ì „ì†¡)
- **í•˜ì´ë¸Œë¦¬ë“œ ì„œë¸Œì‹œìŠ¤í…œ**: ì—ëŸ¬ ë¶„ë¥˜ëŠ” íŒ¨í„´ ë§¤ì¹­ ìš°ì„ , í•„ìš”ì‹œ LLM Fallback; ìƒíƒœ ê²€ì¦ì€ ê²°ì •ë¡ ì 
- **ìˆœìˆ˜ í”„ë¡ì‹œ**: jupyter_extëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì—†ì´ ìš”ì²­ë§Œ í¬ì›Œë”©

---

## ì „ì²´ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì‚¬ìš©ì ìš”ì²­ (User Request)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Knowledge Base ë™ì  ë¡œë”© (Local RAG)                     [LLM: âœ—]    â”‚
â”‚     - ìš”ì²­ì—ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í‚¤ì›Œë“œ ê°ì§€ (dask, polars, pyspark ë“±)            â”‚
â”‚     - Qdrant ë²¡í„° DBì—ì„œ ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰ (multilingual-e5-small ì„ë² ë”©)      â”‚
â”‚     - í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ API ê°€ì´ë“œ ìë™ ë¡œë“œ                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Planning (ê³„íš ìˆ˜ë¦½) - POST /agent/plan                  [LLM: âœ“]    â”‚
â”‚     âœ¦ PLAN_GENERATION_PROMPT                                            â”‚
â”‚     - System Prompt + ì‚¬ìš©ì ìš”ì²­ + ë…¸íŠ¸ë¶ ì»¨í…ìŠ¤íŠ¸ + ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§€ì‹        â”‚
â”‚     - LLMì´ ì‹¤í–‰ ê³„íš(steps) ìƒì„±                                         â”‚
â”‚     - ê° stepì€ tool í˜¸ì¶œ ì •ì˜ í¬í•¨ (ì‹¤ì œ ì‹¤í–‰ì€ 4ë‹¨ê³„ì—ì„œ)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Pre-Validation (ì‚¬ì „ ê²€ì¦) - Ruff ê¸°ë°˜                   [LLM: âœ—]    â”‚
â”‚     â”œâ”€â–¶ Pass 1: ruff check --fix (ìë™ ìˆ˜ì • ê°€ëŠ¥ ì´ìŠˆ ì²˜ë¦¬)                â”‚
â”‚     â”‚   - F401 (ë¯¸ì‚¬ìš© import), W (ìŠ¤íƒ€ì¼) ë“± ìë™ ìˆ˜ì •                    â”‚
â”‚     â”‚                                                                     â”‚
â”‚     â””â”€â–¶ Pass 2: ruff check (ê²€ì¦ ì „ìš©)                                    â”‚
â”‚         - ìë™ ìˆ˜ì • ë¶ˆê°€ ì´ìŠˆë§Œ ë°˜í™˜ (F821, S ë“±)                           â”‚
â”‚         - AST íŒŒì‹±ìœ¼ë¡œ êµ¬ë¬¸ ë¶„ì„ ë° ì˜ì¡´ì„± ì¶”ì¶œ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Step-by-Step Execution (ë‹¨ê³„ë³„ ì‹¤í–‰)                     [LLM: âœ—]    â”‚
â”‚     ğŸ”§ ë„êµ¬ ì‹¤í–‰ (ToolExecutor) â† 18ê°œ ë„êµ¬ëŠ” ì—¬ê¸°ì„œë§Œ í˜¸ì¶œ!               â”‚
â”‚     â”œâ”€ jupyter_cell: ì…€ ìƒì„±/ìˆ˜ì •/ì‚½ì… ë° ì‹¤í–‰                             â”‚
â”‚     â”œâ”€ markdown: ë§ˆí¬ë‹¤ìš´ ì…€ ìƒì„±                                         â”‚
â”‚     â”œâ”€ í™•ì¥ ë„êµ¬: read_file, write_file, git_operations ë“±                â”‚
â”‚     â””â”€ final_answer: ìµœì¢… ë‹µë³€ ì œê³µ                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   ì„±ê³µ (âœ“)    â”‚                â”‚   ì˜¤ë¥˜ (âœ—)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5a. State Verification        â”‚   â”‚  5b. Error Classification  [LLM: â–³] â”‚
â”‚      (ìƒíƒœ ê²€ì¦)    [LLM: âœ—]   â”‚   â”‚      (ì—ëŸ¬ ë¶„ë¥˜)                      â”‚
â”‚  - ê²°ì •ë¡ ì  ê²€ì¦ (LLM ì—†ìŒ)     â”‚   â”‚  - íŒ¨í„´ ë§¤ì¹­ ìš°ì„  (LLM ì—†ìŒ)           â”‚
â”‚  - ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°             â”‚   â”‚  - í•„ìš”ì‹œ ERROR_ANALYSIS_PROMPT       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â”‚                               â–¼
                    â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚  6. Adaptive Replanning  [LLM: âœ“]   â”‚
                    â”‚               â”‚     âœ¦ ADAPTIVE_REPLAN_PROMPT         â”‚
                    â”‚               â”‚  - refine: í˜„ì¬ step ì½”ë“œ ìˆ˜ì •        â”‚
                    â”‚               â”‚  - insert_steps: ìƒˆ step ì‚½ì…         â”‚
                    â”‚               â”‚  - replace_step: step êµì²´            â”‚
                    â”‚               â”‚  - replan_remaining: ì „ì²´ ì¬ê³„íš      â”‚
                    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â”‚                               â”‚ (ìˆ˜ì •ëœ step â†’ 4ë‹¨ê³„ë¡œ)
                    â”‚                               â”‚
                    â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚               â”‚
                    â–¼               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      ë‹¤ìŒ Step ì‹¤í–‰        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      ë˜ëŠ” ì™„ë£Œ             â”‚             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                    â”‚                                 â”‚
                    â”‚ (ë‚¨ì€ step ìˆìŒ)                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë²”ë¡€**: `[LLM: âœ“]` LLM í˜¸ì¶œ í•„ìˆ˜ | `[LLM: â–³]` ì¡°ê±´ë¶€ LLM (íŒ¨í„´ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ) | `[LLM: âœ—]` LLM í˜¸ì¶œ ì—†ìŒ
**í”„ë¡¬í”„íŠ¸**: `âœ¦ PROMPT_NAME` - í•´ë‹¹ ë‹¨ê³„ì—ì„œ ì‚¬ìš©ë˜ëŠ” í”„ë¡¬í”„íŠ¸ ([ìƒì„¸ ë³´ê¸°](./agent_prompts.md))

---

## ğŸ“‘ ë¬¸ì„œ ëª©ì°¨

### ë³¸ ë¬¸ì„œ ì„¹ì…˜ (íë¦„ë„ 1~3ë‹¨ê³„ + ì•„í‚¤í…ì²˜)

| # | íë¦„ë„ ë‹¨ê³„ | ì„¹ì…˜ | ì„¤ëª… |
|---|------------|------|------|
| 1 | 1ë‹¨ê³„ | [Knowledge Base ë™ì  ë¡œë”©](#knowledge-base-ë™ì -ë¡œë”©-local-rag) | Local RAG, Qdrant, ì„ë² ë”© ëª¨ë¸ |
| 2 | 2ë‹¨ê³„ | [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸) | Planning API (/agent/plan) |
| 3 | 3ë‹¨ê³„ | [Pre-Validation](#pre-validation-ì‚¬ì „-ê²€ì¦) | Ruff ê¸°ë°˜ ì½”ë“œ ê²€ì¦, ìë™ ìˆ˜ì • |
| 4 | - | [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„) | A/B ê²½ë¡œë³„ ìƒì„¸ íë¦„ |
| 5 | - | [í•µì‹¬ íŒŒì¼ ìœ„ì¹˜](#í•µì‹¬-íŒŒì¼-ìœ„ì¹˜) | ì£¼ìš” ì½”ë“œ ìœ„ì¹˜ |
| 6 | - | [ì•„í‚¤í…ì²˜ íŠ¹ì§•](#ì•„í‚¤í…ì²˜-íŠ¹ì§•) | ì‹œìŠ¤í…œ ì„¤ê³„ ì›ì¹™ |
| 7 | - | [ì°¸ê³  í”„ë¡œì íŠ¸](#ì°¸ê³ -í”„ë¡œì íŠ¸) | ì˜¤í”ˆì†ŒìŠ¤ ë ˆí¼ëŸ°ìŠ¤ |

### ë³„ë„ ë¬¸ì„œ (íë¦„ë„ 4~6ë‹¨ê³„ + ì„¤ì •)

| íë¦„ë„ ë‹¨ê³„ | ë¬¸ì„œ | ì„¤ëª… |
|------------|------|------|
| 2, 6ë‹¨ê³„ | **[í”„ë¡¬í”„íŠ¸ ë ˆí¼ëŸ°ìŠ¤](./agent_prompts.md)** | ì „ì²´ LLM í”„ë¡¬í”„íŠ¸ ë°œì·Œ ë° í˜¸ì¶œ ì‹œì  |
| 4ë‹¨ê³„ | **[ë„êµ¬ ìƒì„¸](./agent_tools.md)** | 18ê°œ ë„êµ¬ ëª©ë¡, ìœ„í—˜ ìˆ˜ì¤€, ìŠ¹ì¸ ì •ì±… |
| 5a, 5b, 6ë‹¨ê³„ | **[ì„œë¸Œì‹œìŠ¤í…œ ìƒì„¸](./agent_subsystems.md)** | ErrorClassifier, StateVerifier, ìƒíƒœ ë¨¸ì‹  |
| - | **[í”„ë¡œì íŠ¸ ì„¤ì •](./project_setup.md)** | ë¹Œë“œ, ì‹¤í–‰, í…ŒìŠ¤íŠ¸ ì „ëµ |

---

## Knowledge Base ë™ì  ë¡œë”© (Local RAG)

ì‚¬ìš©ì ìš”ì²­ì—ì„œ íŠ¹ì • ë¼ì´ë¸ŒëŸ¬ë¦¬ í‚¤ì›Œë“œë¥¼ ê°ì§€í•˜ë©´, í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ API ê°€ì´ë“œë¥¼ ìë™ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.

### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ì ìš”ì²­: "daskë¡œ ëŒ€ìš©ëŸ‰ CSV ë³‘ë ¬ ì²˜ë¦¬í•´ì¤˜"                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. í‚¤ì›Œë“œ ê°ì§€ (LibraryDetector)                                        â”‚
â”‚     - "dask" í‚¤ì›Œë“œ ë§¤ì¹­                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ì„ë² ë”© ìƒì„± (multilingual-e5-small)                                  â”‚
â”‚     - ìš”ì²­ í…ìŠ¤íŠ¸ â†’ 384ì°¨ì› ë²¡í„°                                          â”‚
â”‚     - CPUì—ì„œ ë¡œì»¬ inference (ì™¸ë¶€ API ì—†ìŒ)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ë²¡í„° ê²€ìƒ‰ (Qdrant)                                                   â”‚
â”‚     - ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê¸°ë°˜ ê²€ìƒ‰                                              â”‚
â”‚     - Top-K ìœ ì‚¬ ë¬¸ì„œ ë°˜í™˜                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±                                                         â”‚
â”‚     - ê²€ìƒ‰ëœ ë¬¸ì„œ ì²­í¬ + ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì´ë“œ ì¡°í•©                              â”‚
â”‚     - í”Œë˜ë‹ í”„ë¡¬í”„íŠ¸ì— ì£¼ì…                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### êµ¬ì„± ìš”ì†Œ

| ì»´í¬ë„ŒíŠ¸ | ê¸°ìˆ  | ì—­í•  |
|----------|------|------|
| **ì„ë² ë”© ëª¨ë¸** | `intfloat/multilingual-e5-small` | í…ìŠ¤íŠ¸ â†’ 384ì°¨ì› ë²¡í„° (í•œêµ­ì–´ ì§€ì›) |
| **ë²¡í„° DB** | Qdrant (Docker ë˜ëŠ” In-Memory) | ë²¡í„° ì €ì¥ ë° ìœ ì‚¬ë„ ê²€ìƒ‰ |
| **ë¬¸ì„œ ì²­í‚¹** | LangChain RecursiveCharacterTextSplitter | ë§ˆí¬ë‹¤ìš´ ë¬¸ì„œ ë¶„í•  (1000ì, 200 overlap) |

### ì„ë² ë”© ëª¨ë¸ ìƒì„¸ ìŠ¤í™

| í•­ëª© | ê°’ |
|------|-----|
| **ëª¨ë¸ í¬ê¸°** | ~470MB (float16), ~235MB (int8 ì–‘ìí™”) |
| **ë²¡í„° ì°¨ì›** | 384 |
| **ìµœëŒ€ ì‹œí€€ìŠ¤ ê¸¸ì´** | 512 í† í° |
| **ì–¸ì–´ ì§€ì›** | 100+ ì–¸ì–´ (í•œêµ­ì–´ í¬í•¨) |

### ê¶Œì¥ ì„œë²„ ìŠ¤í™ (CPU ì „ìš©)

| í•­ëª© | ìµœì†Œ | ê¶Œì¥ |
|------|------|------|
| **CPU** | 2 cores | 4+ cores |
| **RAM** | 4GB | 8GB |
| **ë””ìŠ¤í¬** | 2GB | 5GB |
| **GPU** | ë¶ˆí•„ìš” | ë¶ˆí•„ìš” (CPU inference) |

> ğŸ“ **ì°¸ê³ **: ì„ë² ë”© ëª¨ë¸ì€ **GPU ì—†ì´ CPUì—ì„œ ì‹¤í–‰**ë©ë‹ˆë‹¤. ì´ˆê¸° ëª¨ë¸ ë¡œë“œì— ì•½ 5~10ì´ˆ ì†Œìš”ë˜ë©°, ì´í›„ ìš”ì²­ë‹¹ 50~200msì˜ ì§€ì—°ì‹œê°„ì„ ë³´ì…ë‹ˆë‹¤.

### ì§€ì› ë¼ì´ë¸ŒëŸ¬ë¦¬

| íŠ¸ë¦¬ê±° í‚¤ì›Œë“œ | ë¡œë“œë˜ëŠ” ê°€ì´ë“œ |
|--------------|----------------|
| `dask`, `dask.dataframe`, `dd.read` | `dask.md` |
| `polars`, `pl.read` | `polars.md` |
| `pyspark`, `spark` | `pyspark.md` |
| `vaex` | `vaex.md` |
| `modin` | `modin.md` |
| `ray` | `ray.md` |

### ì˜ˆì‹œ: Dask ìš”ì²­ ì²˜ë¦¬

```
ì‚¬ìš©ì: "daskë¡œ ëŒ€ìš©ëŸ‰ CSV íŒŒì¼ì„ ë³‘ë ¬ ì²˜ë¦¬í•´ì¤˜"
         â†“
1. "dask" í‚¤ì›Œë“œ ê°ì§€
2. ìš”ì²­ í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„± (multilingual-e5-small)
3. Qdrantì—ì„œ ìœ ì‚¬ ë¬¸ì„œ ì²­í¬ ê²€ìƒ‰
4. dask.md ê°€ì´ë“œ + ê²€ìƒ‰ëœ ì²­í¬ ê²°í•©
5. í”Œë˜ë‹ í”„ë¡¬í”„íŠ¸ì— ì»¨í…ìŠ¤íŠ¸ ì£¼ì…
6. LLMì´ ì˜¬ë°”ë¥¸ Dask ë¬¸ë²•ìœ¼ë¡œ ê³„íš ìƒì„±
```

### ì½”ë“œ ìœ„ì¹˜

| íŒŒì¼ | ì—­í•  |
|------|------|
| `agent-server/agent_server/knowledge/loader.py` | ì§€ì‹ ë¡œë” |
| `agent-server/agent_server/rag/embedding_manager.py` | ì„ë² ë”© ìƒì„± |
| `agent-server/agent_server/rag/qdrant_manager.py` | ë²¡í„° DB ê´€ë¦¬ |
| `agent-server/agent_server/knowledge/libraries/*.md` | ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì´ë“œ |

---

## API ì—”ë“œí¬ì¸íŠ¸

### Agent API (`/agent/*`)

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… | LLM í˜¸ì¶œ |
|------------|--------|------|----------|
| `/agent/plan` | POST | ì‹¤í–‰ ê³„íš ìƒì„± | âœ“ |
| `/agent/refine` | POST | ì½”ë“œ ìˆ˜ì • (Self-Healing) | âœ“ |
| `/agent/replan` | POST | ì ì‘ì  ì¬ê³„íš ê²°ì • | â–³ (íŒ¨í„´+LLM Fallback) |
| `/agent/verify-state` | POST | ìƒíƒœ ê²€ì¦ | âœ— (ê²°ì •ë¡ ì ) |
| `/agent/report-execution` | POST | ì‹¤í–‰ ê²°ê³¼ ë³´ê³  | âœ— |

### Chat API (`/chat/*`)

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… | LLM í˜¸ì¶œ |
|------------|--------|------|----------|
| `/chat/message` | POST | ì±„íŒ… ë©”ì‹œì§€ | âœ“ |
| `/chat/stream` | POST | ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (SSE) | âœ“ |

### ìš”ì²­ ì˜ˆì‹œ

```json
// POST /agent/plan
{
  "request": "pandasë¡œ CSV íŒŒì¼ì„ ì½ì–´ì„œ ë°ì´í„° ë¶„ì„í•´ì¤˜",
  "notebookContext": {
    "cellCount": 5,
    "importedLibraries": ["pandas", "numpy"],
    "definedVariables": ["df", "data"],
    "recentCells": [...]
  },
  "llmConfig": {
    "provider": "gemini",
    "gemini": {
      "apiKey": "AIza...",
      "model": "gemini-2.5-flash"
    }
  }
}
```

---

## Pre-Validation (ì‚¬ì „ ê²€ì¦)

ì‹¤í–‰ ì „ ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### ê²€ì¦ ë„êµ¬ ë¹„êµ

| ë„êµ¬ | íŠ¹ì§• | ê²€ì‚¬ ë²”ìœ„ |
|------|------|----------|
| **Ruff** | Rust ê¸°ë°˜ ì´ˆê³ ì† ë¦°í„° (700+ ê·œì¹™) | F (Pyflakes), E/W (ìŠ¤íƒ€ì¼), S (ë³´ì•ˆ), B (ë²„ê·¸ íŒ¨í„´) |
| **AST** | Python ë‚´ì¥ íŒŒì„œ | êµ¬ë¬¸ ë¶„ì„, ì˜ì¡´ì„± ì¶”ì¶œ |

### Ruff ê·œì¹™ ì¹´í…Œê³ ë¦¬

| ê·œì¹™ ì½”ë“œ | ì¹´í…Œê³ ë¦¬ | ì„¤ëª… | ì‹¬ê°ë„ |
|----------|---------|------|--------|
| F821 | undefined_name | ë¯¸ì •ì˜ ë³€ìˆ˜/í•¨ìˆ˜ | ERROR |
| F401 | unused_import | ë¯¸ì‚¬ìš© import | WARNING |
| S102 | security | `exec()` ì‚¬ìš© ê°ì§€ | WARNING |
| E9xx | syntax | ëŸ°íƒ€ì„ ì—ëŸ¬ | ERROR |

### Ruff ìë™ ìˆ˜ì • (--fix)

ì½”ë“œ ê²€ì¦ ì‹œ Ruffì˜ ìë™ ìˆ˜ì • ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ LLM í† í°ì„ ì ˆì•½í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì½”ë“œ ê²€ì¦ ìš”ì²­                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pass 1: ruff check --fix                                               â”‚
â”‚  - ìë™ ìˆ˜ì • ê°€ëŠ¥í•œ ì´ìŠˆ ìë™ ì²˜ë¦¬                                         â”‚
â”‚  - F401 (ë¯¸ì‚¬ìš© import), W (ìŠ¤íƒ€ì¼) ë“± ìë™ ìˆ˜ì •                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pass 2: ruff check (ê²€ì¦ ì „ìš©)                                          â”‚
â”‚  - ìë™ ìˆ˜ì • ë¶ˆê°€ëŠ¥í•œ ì´ìŠˆë§Œ ë°˜í™˜                                           â”‚
â”‚  - F821 (ë¯¸ì •ì˜ ë³€ìˆ˜), S (ë³´ì•ˆ) ë“±                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ì´ìŠˆ ì—†ìŒ    â”‚                â”‚  ì´ìŠˆ ìˆìŒ    â”‚
            â”‚  (ìˆ˜ì •ëœ ì½”ë“œ) â”‚                â”‚  (LLMì— ì „ë‹¬) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API ì‘ë‹µ í™•ì¥:**
```python
class ValidateResponse:
    valid: bool                     # ê²€ì¦ í†µê³¼ ì—¬ë¶€
    issues: List[ValidationIssue]   # ìë™ ìˆ˜ì • ë¶ˆê°€ ì´ìŠˆ
    fixedCode: Optional[str]        # ìë™ ìˆ˜ì •ëœ ì½”ë“œ (NEW)
    fixedCount: int                 # ìë™ ìˆ˜ì •ëœ ì´ìŠˆ ìˆ˜ (NEW)
```

**íš¨ê³¼:**
- ìŠ¤íƒ€ì¼/í¬ë§·íŒ… ì´ìŠˆëŠ” LLM í˜¸ì¶œ ì—†ì´ ì¦‰ì‹œ ìˆ˜ì •
- LLMì— ì „ë‹¬ë˜ëŠ” ì´ìŠˆ ìˆ˜ ê°ì†Œ â†’ í† í° ì ˆì•½
- ì‘ë‹µ ì†ë„ í–¥ìƒ

**ì½”ë“œ ìœ„ì¹˜:** `agent-server/agent_server/core/code_validator.py`

---

## ë°ì´í„° íë¦„

### A. ê³„íš ìƒì„± íë¦„ (REST API ê²½ìœ )

```
ì‚¬ìš©ì ì…ë ¥ (AutoAgentPanel.tsx)
        â”‚
        â–¼
ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘ (ContextManager.ts)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApiService.ts                                                 â”‚
â”‚  â””â”€â–¶ POST /hdsp-agent/auto-agent/plan                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼  (jupyter_ext í”„ë¡ì‹œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  jupyter_ext/handlers.py                                       â”‚
â”‚  â””â”€â–¶ í¬ì›Œë”©: /hdsp-agent/* â†’ Agent Server                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼  HTTP (Port 8000)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent Server (FastAPI)                                        â”‚
â”‚  â”œâ”€â–¶ routers/agent.py (ìš”ì²­ íŒŒì‹±)                              â”‚
â”‚  â”œâ”€â–¶ rag/ (Local RAG - ì„ë² ë”© + ë²¡í„° ê²€ìƒ‰)                      â”‚
â”‚  â”œâ”€â–¶ knowledge/loader.py (ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§€ì‹ ë¡œë“œ)                 â”‚
â”‚  â””â”€â–¶ core/llm_service.py (LLM í˜¸ì¶œ)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    ê³„íš ë°˜í™˜ â†’ AgentOrchestrator.ts
```

### B. ë„êµ¬ ì‹¤í–‰ íë¦„ (Jupyter API)

```
AgentOrchestrator.executeStep()
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ToolExecutor.executeTool()                                    â”‚
â”‚  â””â”€â–¶ ë„êµ¬ ìœ í˜•ì— ë”°ë¼ ë¶„ê¸°                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼  (HTTP/REST - Jupyter API)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Jupyter Server                                                â”‚
â”‚  â”œâ”€â–¶ Contents API                    â†’ íŒŒì¼/ë…¸íŠ¸ë¶ ì¡°ì‘         â”‚
â”‚  â”œâ”€â–¶ Kernels API                     â†’ ì»¤ë„ ê´€ë¦¬               â”‚
â”‚  â””â”€â–¶ Sessions API                    â†’ ì„¸ì…˜ ê´€ë¦¬               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼  (ZMQ - ì»¤ë„ í†µì‹ )
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kernel (IPython)                                              â”‚
â”‚  â”œâ”€â–¶ model.sharedModel.insertCell()  â†’ ì…€ ìƒì„±                 â”‚
â”‚  â”œâ”€â–¶ NotebookActions.run()           â†’ ì…€ ì‹¤í–‰                 â”‚
â”‚  â””â”€â–¶ cell.model.outputs              â†’ ê²°ê³¼ ìº¡ì²˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í•µì‹¬ íŒŒì¼ ìœ„ì¹˜

### Agent Server

| ì»´í¬ë„ŒíŠ¸ | íŒŒì¼ ê²½ë¡œ |
|----------|----------|
| API ë¼ìš°í„° | `agent-server/agent_server/routers/agent.py` |
| Chat ë¼ìš°í„° | `agent-server/agent_server/routers/chat.py` |
| í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ | `agent-server/agent_server/prompts/auto_agent_prompts.py` |
| Knowledge Base | `agent-server/agent_server/knowledge/loader.py` |
| ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì´ë“œ | `agent-server/agent_server/knowledge/libraries/*.md` |
| ì½”ë“œ ê²€ì¦ê¸° | `agent-server/agent_server/core/code_validator.py` |
| ì—ëŸ¬ ë¶„ë¥˜ê¸° | `agent-server/agent_server/core/error_classifier.py` |
| ìƒíƒœ ê²€ì¦ê¸° | `agent-server/agent_server/core/state_verifier.py` |
| LLM ì„œë¹„ìŠ¤ | `agent-server/agent_server/core/llm_service.py` |

### Frontend (JupyterLab Extension)

| ì»´í¬ë„ŒíŠ¸ | íŒŒì¼ ê²½ë¡œ |
|----------|----------|
| API ì„œë¹„ìŠ¤ | `extensions/jupyter/frontend/services/ApiService.ts` |
| API í‚¤ ê´€ë¦¬ | `extensions/jupyter/frontend/services/ApiKeyManager.ts` |
| ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° | `extensions/jupyter/frontend/services/AgentOrchestrator.ts` |
| ë„êµ¬ ì‹¤í–‰ê¸° | `extensions/jupyter/frontend/services/ToolExecutor.ts` |
| ì²´í¬í¬ì¸íŠ¸ ê´€ë¦¬ | `extensions/jupyter/frontend/services/CheckpointManager.ts` |
| ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ | `extensions/jupyter/frontend/services/ContextManager.ts` |
| íƒ€ì… ì •ì˜ | `extensions/jupyter/frontend/types/agent.ts` |

---

## ì•„í‚¤í…ì²˜ íŠ¹ì§•

1. **Self-Healing**: ì˜¤ë¥˜ ë°œìƒ ì‹œ ìë™ìœ¼ë¡œ ì½”ë“œ ìˆ˜ì • ì‹œë„
2. **Context-Aware**: ë…¸íŠ¸ë¶ ìƒíƒœë¥¼ ì§€ì†ì ìœ¼ë¡œ ì¶”ì 
3. **Knowledge-Enhanced**: ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ ì „ë¬¸ ì§€ì‹ ë™ì  ë¡œë”©
4. **Fail-Fast Validation**: ì‹¤í–‰ ì „ ì½”ë“œ í’ˆì§ˆ ì‚¬ì „ ê²€ì¦ + Ruff ìë™ ìˆ˜ì •
5. **Adaptive Planning**: ìƒí™©ì— ë”°ë¥¸ ìœ ì—°í•œ ê³„íš ìˆ˜ì •
6. **Deterministic Subsystems**: ì—ëŸ¬ ë¶„ë¥˜/ìƒíƒœ ê²€ì¦ì€ LLM ì—†ì´ ì²˜ë¦¬
7. **LLM Fallback**: íŒ¨í„´ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ LLM ê¸°ë°˜ ì—ëŸ¬ ë¶„ì„
8. **Extended Toolset**: 18ê°œ ë‚´ì¥ ë„êµ¬ (íŒŒì¼, ì…¸, Git, í…ŒìŠ¤íŠ¸, ë¦¬íŒ©í† ë§ ë“±)
9. **Rate Limit Resilience**: ìë™ API í‚¤ êµì²´ë¡œ ì„œë¹„ìŠ¤ ì—°ì†ì„± ë³´ì¥

---

## ì°¸ê³  í”„ë¡œì íŠ¸

ê°œë°œ ê³¼ì •ì—ì„œ ë‹¤ìŒ ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ë¥¼ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤:
- [Roo Code](https://github.com/RooVetGit/Roo-Code)
- [Cline](https://github.com/cline/cline)
- [Continue](https://github.com/continuedev/continue)
- [Void](https://github.com/voideditor/void)
