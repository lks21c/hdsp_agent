# HDSP Agent ì¸ìˆ˜ì¸ê³„ ë¬¸ì„œ

> ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-11-25
> ë²„ì „: 0.1.0

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [Backend ë””ë ‰í† ë¦¬ êµ¬ì¡°](#2-backend-ë””ë ‰í† ë¦¬-êµ¬ì¡°)
3. [Frontend ë””ë ‰í† ë¦¬ êµ¬ì¡°](#3-frontend-ë””ë ‰í† ë¦¬-êµ¬ì¡°)
4. [íŒŒì¼ë³„ ìƒì„¸ ì—­í• ](#4-íŒŒì¼ë³„-ìƒì„¸-ì—­í• )
5. [ë¹Œë“œ í”„ë¡œì„¸ìŠ¤](#5-ë¹Œë“œ-í”„ë¡œì„¸ìŠ¤)
6. [Wheel íŒŒì¼ êµ¬ì¡°](#6-wheel-íŒŒì¼-êµ¬ì¡°)
7. [JupyterHub on K8s ë°°í¬](#7-jupyterhub-on-k8s-ë°°í¬)
8. [ì„¤ì¹˜ ê²€ì¦](#8-ì„¤ì¹˜-ê²€ì¦)
9. [ì„¤ì • ë°©ë²•](#9-ì„¤ì •-ë°©ë²•)
10. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#10-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
11. [ê°œë°œ ê°€ì´ë“œ](#11-ê°œë°œ-ê°€ì´ë“œ)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ì†Œê°œ

**HDSP Agent**ëŠ” JupyterLab 4.0+ í™˜ê²½ì—ì„œ AI ê¸°ë°˜ ì½”ë“œ ì§€ì›ì„ ì œê³µí•˜ëŠ” Extensionì…ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**
- ğŸ¤– **ì±„íŒ… ì¸í„°í˜ì´ìŠ¤**: ì‚¬ì´ë“œë°”ì—ì„œ LLMê³¼ ëŒ€í™”
- ğŸ“ **ì…€ ìˆ˜ì¤€ ë¶„ì„**: ì½”ë“œ ì„¤ëª…(Explain), ì˜¤ë¥˜ ìˆ˜ì •(Fix), ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸
- ğŸ““ **ë…¸íŠ¸ë¶ ìƒì„±**: í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ ìë™ ë…¸íŠ¸ë¶ ìƒì„±
- ğŸ’¾ **ì €ì¥ ì¸í„°ì…‰ì…˜**: ë…¸íŠ¸ë¶ ì €ì¥ ì „ ë¶„ì„ ë° ê²€í† 

### 1.2 ê¸°ìˆ  ìŠ¤íƒ

| ë ˆì´ì–´ | ê¸°ìˆ  | ë²„ì „ |
|--------|------|------|
| **Frontend** | TypeScript + React | TS 5.1.6, React 18.2 |
| **UI Framework** | Material-UI + Emotion | MUI 5.14 |
| **JupyterLab** | JupyterLab Extensions API | 4.0+ |
| **Backend** | Python + Jupyter Server | Python 3.8+, Jupyter Server 2.0+ |
| **HTTP** | aiohttp (async) | 3.8+ |
| **LLM Providers** | Gemini, OpenAI, vLLM | - |

### 1.3 ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   JupyterLab UI                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Sidebar     â”‚  â”‚ Cell Buttons â”‚  â”‚ Save           â”‚ â”‚
â”‚  â”‚ Chat Panel  â”‚  â”‚ (E/F/?)      â”‚  â”‚ Interceptor    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ REST API (/hdsp-agent/*)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Jupyter Server Extension                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Handlers (10 endpoints)                          â”‚   â”‚
â”‚  â”‚  - ChatHandler (ì¼ë°˜/ìŠ¤íŠ¸ë¦¬ë°)                   â”‚   â”‚
â”‚  â”‚  - CellActionHandler (explain/fix/custom)        â”‚   â”‚
â”‚  â”‚  - ConfigHandler (ì„¤ì • ê´€ë¦¬)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ LLMService                                        â”‚   â”‚
â”‚  â”‚  - Gemini API (60s timeout, retry logic)         â”‚   â”‚
â”‚  â”‚  - OpenAI API (GPT-4)                            â”‚   â”‚
â”‚  â”‚  - vLLM API (local inference)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Backend ë””ë ‰í† ë¦¬ êµ¬ì¡°

### 2.1 ì „ì²´ êµ¬ì¡°

```
backend/
â”œâ”€â”€ __init__.py                    # Extension ì§„ì…ì 
â”œâ”€â”€ _version.py                    # ë²„ì „ ì •ë³´
â”œâ”€â”€ llm_service.py                 # í•µì‹¬ LLM í†µí•© ì„œë¹„ìŠ¤
â”œâ”€â”€ handlers/                      # REST API í•¸ë“¤ëŸ¬
â”‚   â”œâ”€â”€ __init__.py                # ë¼ìš°íŠ¸ ë“±ë¡
â”‚   â”œâ”€â”€ base.py                    # ê¸°ë³¸ í•¸ë“¤ëŸ¬ í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ chat.py                    # ì±„íŒ… API (ì¼ë°˜ + ìŠ¤íŠ¸ë¦¬ë°)
â”‚   â”œâ”€â”€ config.py                  # ì„¤ì • ê´€ë¦¬ API
â”‚   â”œâ”€â”€ cell_action.py             # ì…€ ë¶„ì„ API
â”‚   â”œâ”€â”€ status.py                  # ìƒíƒœ í™•ì¸ API
â”‚   â”œâ”€â”€ test_llm.py                # LLM í…ŒìŠ¤íŠ¸ API
â”‚   â””â”€â”€ notebook_generation.py     # ë…¸íŠ¸ë¶ ìƒì„± API
â”œâ”€â”€ services/                      # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config_manager.py          # ì„¤ì • íŒŒì¼ ê´€ë¦¬ (ì‹±ê¸€í†¤)
â”‚   â”œâ”€â”€ llm_client.py              # LLM í´ë¼ì´ì–¸íŠ¸ ë˜í¼
â”‚   â”œâ”€â”€ notebook_generator.py      # ë…¸íŠ¸ë¶ ìƒì„± ë¡œì§
â”‚   â”œâ”€â”€ prompt_builder.py          # í”„ë¡¬í”„íŠ¸ êµ¬ì¶•
â”‚   â””â”€â”€ task_manager.py            # ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ê´€ë¦¬
â”œâ”€â”€ etc/                           # ì„¤ì • íŒŒì¼
â”‚   â””â”€â”€ jupyter/
â”‚       â””â”€â”€ jupyter_server_config.d/
â”‚           â””â”€â”€ hdsp_agent.json    # Jupyter Server ìë™ ë“±ë¡
â””â”€â”€ labextension/                  # ë¹Œë“œëœ frontend (ìë™ ìƒì„±)
    â”œâ”€â”€ package.json
    â”œâ”€â”€ static/
    â”‚   â”œâ”€â”€ lib_index_js.*.js      # ë©”ì¸ í”ŒëŸ¬ê·¸ì¸
    â”‚   â”œâ”€â”€ remoteEntry.*.js       # Module Federation
    â”‚   â”œâ”€â”€ style_index_css.*.js   # ìŠ¤íƒ€ì¼
    â”‚   â””â”€â”€ vendors-*.js           # React, MUI ë“±
    â””â”€â”€ build_log.json
```

### 2.2 í•µì‹¬ íŒŒì¼ ìš”ì•½

| íŒŒì¼ | ì—­í•  | ì¤‘ìš”ë„ |
|------|------|--------|
| `__init__.py` | Extension ë“±ë¡, handler ì´ˆê¸°í™” | â­â­â­ |
| `llm_service.py` | 3ê°œ LLM provider í†µí•© | â­â­â­ |
| `handlers/__init__.py` | 10ê°œ API ë¼ìš°íŠ¸ ë“±ë¡ | â­â­â­ |
| `handlers/chat.py` | ì±„íŒ… ë©”ì‹œì§€ ì²˜ë¦¬ (ì¼ë°˜/ìŠ¤íŠ¸ë¦¬ë°) | â­â­â­ |
| `services/config_manager.py` | ì„¤ì • ì €ì¥/ë¡œë“œ (JSON íŒŒì¼) | â­â­ |
| `services/task_manager.py` | ë¹„ë™ê¸° ì‘ì—… ê´€ë¦¬ | â­â­ |

---

## 3. Frontend ë””ë ‰í† ë¦¬ êµ¬ì¡°

### 3.1 ì „ì²´ êµ¬ì¡°

```
frontend/
â”œâ”€â”€ index.ts                       # Extension manifest (4ê°œ í”ŒëŸ¬ê·¸ì¸ export)
â”œâ”€â”€ plugins/                       # JupyterLab í”ŒëŸ¬ê·¸ì¸
â”‚   â”œâ”€â”€ sidebar-plugin.ts          # ì‚¬ì´ë“œë°” íŒ¨ë„ ìƒì„±
â”‚   â”œâ”€â”€ cell-buttons-plugin.ts     # ì…€ì— E/F/? ë²„íŠ¼ ì£¼ì…
â”‚   â”œâ”€â”€ prompt-generation-plugin.tsx # ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ ë‹¤ì´ì–¼ë¡œê·¸
â”‚   â””â”€â”€ save-interceptor-plugin.ts # ë…¸íŠ¸ë¶ ì €ì¥ ì „ ë¶„ì„
â”œâ”€â”€ components/                    # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ AgentPanel.tsx             # ë©”ì¸ ì±„íŒ… UI (900ì¤„+)
â”‚   â”œâ”€â”€ SettingsPanel.tsx          # LLM ì„¤ì • UI
â”‚   â”œâ”€â”€ PromptGenerationDialog.tsx # í”„ë¡¬í”„íŠ¸ ì…ë ¥ ë‹¤ì´ì–¼ë¡œê·¸
â”‚   â””â”€â”€ TaskProgressWidget.tsx     # ì‘ì—… ì§„í–‰ ìƒíƒœ í‘œì‹œ
â”œâ”€â”€ services/                      # API í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ ApiService.ts              # REST API í†µì‹ 
â”‚   â””â”€â”€ TaskService.ts             # ì‘ì—… ì¶”ì 
â”œâ”€â”€ utils/                         # ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ markdownRenderer.ts        # Markdown â†’ HTML ë³€í™˜
â”œâ”€â”€ types/                         # TypeScript íƒ€ì… ì •ì˜
â”‚   â””â”€â”€ index.ts                   # ì¸í„°í˜ì´ìŠ¤ ë° Enum
â”œâ”€â”€ styles/                        # ìŠ¤íƒ€ì¼ì‹œíŠ¸
â”‚   â””â”€â”€ *.css
â””â”€â”€ svg.d.ts                       # SVG import íƒ€ì…
```

### 3.2 í”ŒëŸ¬ê·¸ì¸ ë¡œë”© ìˆœì„œ

**ì¤‘ìš”**: `frontend/index.ts`ì—ì„œ í”ŒëŸ¬ê·¸ì¸ì´ ë‹¤ìŒ ìˆœì„œë¡œ exportë˜ë©°, ì´ ìˆœì„œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤:

1. **sidebarPlugin** - ì‚¬ì´ë“œë°” íŒ¨ë„ ìƒì„± (ë¨¼ì € ìƒì„±ë˜ì–´ì•¼ í•¨)
2. **cellButtonsPlugin** - ì…€ ë²„íŠ¼ ì£¼ì… (ì‚¬ì´ë“œë°” ì°¸ì¡° í•„ìš”)
3. **promptGenerationPlugin** - í”„ë¡¬í”„íŠ¸ ë‹¤ì´ì–¼ë¡œê·¸
4. **saveInterceptorPlugin** - ì €ì¥ ì¸í„°ì…‰ì…˜

---

## 4. íŒŒì¼ë³„ ìƒì„¸ ì—­í• 

### 4.1 Backend í•µì‹¬ íŒŒì¼

#### 4.1.1 `backend/__init__.py`

**ì—­í• **: Extension ì§„ì…ì  ë° ë“±ë¡

```python
def _jupyter_labextension_paths():
    """JupyterLabì— extension ë“±ë¡"""
    return [{'src': 'labextension', 'dest': '@hdsp-agent/extension'}]

def _jupyter_server_extension_points():
    """Jupyter Serverì— extension ë“±ë¡"""
    return [{'module': 'backend'}]

def load_jupyter_server_extension(server_app):
    """ì„œë²„ ì‹œì‘ ì‹œ handler ì´ˆê¸°í™”"""
    from .handlers import setup_handlers
    web_app = server_app.web_app
    setup_handlers(web_app)  # ëª¨ë“  API ë¼ìš°íŠ¸ ë“±ë¡
```

**ì¤‘ìš” í¬ì¸íŠ¸**:
- Jupyter Serverê°€ ì‹œì‘í•  ë•Œ ìë™ í˜¸ì¶œ
- `setup_handlers()`ë¥¼ í†µí•´ 10ê°œ API ì—”ë“œí¬ì¸íŠ¸ ë“±ë¡
- ConfigManagerë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì—¬ `web_app.settings`ì— ì €ì¥

#### 4.1.2 `backend/llm_service.py`

**ì—­í• **: 3ê°œ LLM provider í†µí•© ì„œë¹„ìŠ¤

**ì§€ì› Provider**:
1. **Google Gemini** (ê¸°ë³¸)
   - ëª¨ë¸: `gemini-2.5-pro`
   - Timeout: 60s
   - Retry ë¡œì§: 503/429 ì—ëŸ¬ ì‹œ exponential backoff
   - ìµœëŒ€ ì¶œë ¥ í† í°: 4096

2. **OpenAI**
   - ëª¨ë¸: `gpt-4`, `gpt-3.5-turbo`
   - ìµœëŒ€ ì¶œë ¥ í† í°: 2000

3. **vLLM** (ë¡œì»¬ inference)
   - OpenAI í˜¸í™˜ API
   - ê¸°ë³¸ endpoint: `http://localhost:8000`

**ì£¼ìš” ë©”ì„œë“œ**:

```python
class LLMService:
    async def generate_response(self, prompt: str, context: str = None) -> str:
        """ë‹¨ì¼ ì‘ë‹µ ìƒì„± (ë¸”ë¡œí‚¹)"""

    async def generate_response_stream(self, prompt: str, context: str = None):
        """ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ìƒì„± (AsyncGenerator)"""
        # SSEë¡œ ì‹¤ì‹œê°„ ì²­í¬ ì „ì†¡
```

**Retry ë¡œì§**:
- **503 (Overload)**: 2ì´ˆ, 4ì´ˆ, 8ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)
- **429 (Rate Limit)**: 5ì´ˆ, 10ì´ˆ, 20ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ)

#### 4.1.3 `backend/handlers/__init__.py`

**ì—­í• **: API ë¼ìš°íŠ¸ ë“±ë¡

**ë“±ë¡ëœ ì—”ë“œí¬ì¸íŠ¸** (10ê°œ):

| Method | ê²½ë¡œ | Handler | ìš©ë„ |
|--------|------|---------|------|
| POST | `/hdsp-agent/config` | ConfigHandler | ì„¤ì • ì €ì¥ |
| GET | `/hdsp-agent/config` | ConfigHandler | ì„¤ì • ì¡°íšŒ |
| POST | `/hdsp-agent/cell/action` | CellActionHandler | ì…€ ë¶„ì„ |
| GET | `/hdsp-agent/status` | StatusHandler | ìƒíƒœ í™•ì¸ |
| POST | `/hdsp-agent/chat/message` | ChatHandler | ì±„íŒ… (ì¼ë°˜) |
| POST | `/hdsp-agent/chat/stream` | ChatStreamHandler | ì±„íŒ… (ìŠ¤íŠ¸ë¦¬ë°) |
| POST | `/hdsp-agent/test-llm` | TestLLMHandler | LLM ì—°ê²° í…ŒìŠ¤íŠ¸ |
| POST | `/hdsp-agent/notebook/generate` | NotebookGenerationHandler | ë…¸íŠ¸ë¶ ìƒì„± |
| GET | `/hdsp-agent/task/{id}/status` | TaskStatusHandler | ì‘ì—… ìƒíƒœ ì¡°íšŒ |
| GET | `/hdsp-agent/task/{id}/stream` | TaskStatusStreamHandler | ì‘ì—… ì§„í–‰ ìŠ¤íŠ¸ë¦¬ë° |
| POST | `/hdsp-agent/task/{id}/cancel` | TaskCancelHandler | ì‘ì—… ì·¨ì†Œ |

#### 4.1.4 `backend/handlers/chat.py`

**ì—­í• **: ì±„íŒ… ë©”ì‹œì§€ ì²˜ë¦¬

**`ChatHandler` (ì¼ë°˜ ì‘ë‹µ)**:
- ìš”ì²­: `{message: string, conversationId?: string}`
- ì‘ë‹µ: `{conversationId, messageId, content, metadata}`
- ëŒ€í™” ê¸°ë¡: ë©”ëª¨ë¦¬ì— ì €ì¥ (ìµœê·¼ 5ê°œ ë©”ì‹œì§€ë¥¼ contextë¡œ ì‚¬ìš©)

**`ChatStreamHandler` (ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ)**:
- SSE (Server-Sent Events) í”„ë¡œí† ì½œ ì‚¬ìš©
- ì‹¤ì‹œê°„ ì²­í¬ ì „ì†¡: `data: {"content": "...", "done": false}\n\n`
- ì™„ë£Œ ì‹œ: `data: {"content": "", "done": true, "metadata": {...}}\n\n`

**ëŒ€í™” ì»¨í…ìŠ¤íŠ¸**:
```python
# ìµœê·¼ 5ê°œ ë©”ì‹œì§€ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ í¬í•¨
context = "\n".join([
    f"{'User' if msg['role'] == 'user' else 'Assistant'}: {msg['content']}"
    for msg in history[-5:]
])
```

#### 4.1.5 `backend/handlers/cell_action.py`

**ì—­í• **: ì…€ ë¶„ì„ ìš”ì²­ ì²˜ë¦¬

**ì§€ì› ì•¡ì…˜**:
1. **explain**: ì½”ë“œ ì„¤ëª…
2. **fix**: ì˜¤ë¥˜ ìˆ˜ì • ì œì•ˆ
3. **custom**: ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸

**ìš”ì²­ í˜•ì‹**:
```json
{
  "cellId": "cell-123",
  "cellContent": "def foo():\n    print('hello')",
  "action": "explain",
  "customPrompt": "ì´ ì½”ë“œë¥¼ ìµœì í™”í•´ì¤˜" // custom ì•¡ì…˜ ì‹œ
}
```

**ì‘ë‹µ í˜•ì‹**:
```json
{
  "cellId": "cell-123",
  "response": "ì´ í•¨ìˆ˜ëŠ”...",
  "metadata": {
    "model": "gemini-2.5-pro",
    "tokens": 150,
    "duration": 1250  // ms
  },
  "fixedCode": "def foo():\n    ..."  // fix ì•¡ì…˜ ì‹œ
}
```

#### 4.1.6 `backend/services/config_manager.py`

**ì—­í• **: ì„¤ì • íŒŒì¼ ê´€ë¦¬ (ì‹±ê¸€í†¤ íŒ¨í„´)

**ì €ì¥ ìœ„ì¹˜**: `~/.jupyter/hdsp_agent_config.json`

**ê¸°ë³¸ ì„¤ì •**:
```json
{
  "provider": "gemini",
  "gemini": {
    "apiKey": "",
    "model": "gemini-2.5-pro"
  },
  "vllm": {
    "endpoint": "http://localhost:8000",
    "apiKey": "",
    "model": "meta-llama/Llama-2-7b-chat-hf"
  },
  "openai": {
    "apiKey": "",
    "model": "gpt-4"
  }
}
```

**ì£¼ìš” ë©”ì„œë“œ**:
```python
class ConfigManager:
    @classmethod
    def get_instance(cls): ...  # ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤

    def get_config(self) -> dict:
        """ì„¤ì • ë¡œë“œ (íŒŒì¼ì—ì„œ ìµœì‹  ìƒíƒœ ì½ê¸°)"""

    def save_config(self, config: dict):
        """ì„¤ì • ì €ì¥ (íŒŒì¼ì— JSON ì“°ê¸°)"""
```

#### 4.1.7 `backend/services/task_manager.py`

**ì—­í• **: ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ê´€ë¦¬ (ë¹„ë™ê¸° ì‹±ê¸€í†¤)

**ì‘ì—… ìƒíƒœ**:
- `PENDING` â†’ `RUNNING` â†’ `COMPLETED` / `FAILED` / `CANCELLED`

**Task ëª¨ë¸**:
```python
{
    "task_id": "uuid",
    "status": "running",
    "progress": 75,  # 0-100
    "message": "ë…¸íŠ¸ë¶ ì…€ ìƒì„± ì¤‘...",
    "result": None,  # ì™„ë£Œ ì‹œ ê²°ê³¼
    "error": None,   # ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
    "created_at": "2025-11-25T10:00:00",
    "updated_at": "2025-11-25T10:01:30"
}
```

**ì£¼ìš” ë©”ì„œë“œ**:
```python
class TaskManager:
    async def create_task(self, description: str) -> str:
        """ìƒˆ ì‘ì—… ìƒì„±, task_id ë°˜í™˜"""

    def update_task_progress(self, task_id: str, progress: int, message: str):
        """ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (0-100)"""

    def complete_task(self, task_id: str, result: any):
        """ì‘ì—… ì™„ë£Œ ì²˜ë¦¬"""

    def fail_task(self, task_id: str, error: str):
        """ì‘ì—… ì‹¤íŒ¨ ì²˜ë¦¬"""
```

### 4.2 Frontend í•µì‹¬ íŒŒì¼

#### 4.2.1 `frontend/index.ts`

**ì—­í• **: Extension manifest, í”ŒëŸ¬ê·¸ì¸ export

```typescript
const plugins: JupyterFrontEndPlugin<any>[] = [
  sidebarPlugin,           // 1. ì‚¬ì´ë“œë°” íŒ¨ë„
  cellButtonsPlugin,       // 2. ì…€ ë²„íŠ¼
  promptGenerationPlugin,  // 3. í”„ë¡¬í”„íŠ¸ ë‹¤ì´ì–¼ë¡œê·¸
  saveInterceptorPlugin    // 4. ì €ì¥ ì¸í„°ì…‰ì…˜
];

export default plugins;
```

**ì¤‘ìš”**: ìˆœì„œê°€ ë°”ë€Œë©´ í”ŒëŸ¬ê·¸ì¸ ê°„ ì°¸ì¡°ê°€ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ!

#### 4.2.2 `frontend/plugins/sidebar-plugin.ts`

**ì—­í• **: ì‚¬ì´ë“œë°”ì— Agent íŒ¨ë„ ì¶”ê°€

**ì£¼ìš” ê¸°ëŠ¥**:
1. `AgentPanelWidget` ìƒì„± (React wrapper)
2. ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°”ì— ì¶”ê°€ (rank: 100)
3. `hdsp-agent:toggle-sidebar` ì»¤ë§¨ë“œ ë“±ë¡
4. ìƒíƒœ ë³µì› (ì„ íƒì )

**ì½”ë“œ íë¦„**:
```typescript
// 1. Widget ìƒì„±
const widget = new AgentPanelWidget(apiService);
widget.id = 'hdsp-agent-sidebar';
widget.title.icon = agentIcon;

// 2. ì‚¬ì´ë“œë°” ì¶”ê°€
app.shell.add(widget, 'right', { rank: 100 });

// 3. ì»¤ë§¨ë“œ ë“±ë¡
app.commands.addCommand('hdsp-agent:toggle-sidebar', {
  execute: () => {
    if (!widget.isAttached) {
      app.shell.add(widget, 'right');
    }
    app.shell.activateById(widget.id);
  }
});
```

#### 4.2.3 `frontend/plugins/cell-buttons-plugin.ts`

**ì—­í• **: ì½”ë“œ ì…€ì— E/F/? ë²„íŠ¼ ì£¼ì…

**ë²„íŠ¼ ê¸°ëŠ¥**:
- **E** (Explain): ì½”ë“œ ì„¤ëª… ìš”ì²­
- **F** (Fix): ì˜¤ë¥˜ ìˆ˜ì • ì œì•ˆ
- **?** (Custom): ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ ë‹¤ì´ì–¼ë¡œê·¸

**ì£¼ì… ë¡œì§**:
```typescript
// 1. ë…¸íŠ¸ë¶ ì¶”ì 
tracker.widgetAdded.connect((sender, panel) => {
  const notebook = panel.content;

  // 2. ì…€ ë³€ê²½ ê°ì§€
  notebook.model.cells.changed.connect(() => {
    // 200ms í›„ ë²„íŠ¼ ì£¼ì… (ë Œë”ë§ ëŒ€ê¸°)
    setTimeout(() => injectButtons(notebook), 200);
  });
});

// 3. ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
buttonE.onclick = () => {
  const cellContent = cell.model.value.text;
  const cellId = cell.model.id;

  // AgentPanelë¡œ ì „ë‹¬ (ref ì‚¬ìš©)
  agentPanelRef.current?.setInput(`[ì…€ ${cellIndex}] ì„¤ëª…í•´ì¤˜`);
  agentPanelRef.current?.setLlmPrompt(`Explain this code:\n${cellContent}`);
  agentPanelRef.current?.setCurrentCellId(cellId);
  agentPanelRef.current?.handleSendMessage();
};
```

**íƒ€ì´ë° ì´ìŠˆ í•´ê²°**:
- ì´ˆê¸° ì£¼ì…: 200ms ëŒ€ê¸°
- ì¬ì‹œë„: 500ms í›„ (ëŠ¦ê²Œ ë Œë”ë§ë˜ëŠ” ì…€ ëŒ€ì‘)

#### 4.2.4 `frontend/components/AgentPanel.tsx`

**ì—­í• **: ë©”ì¸ ì±„íŒ… UI (900ì¤„+ì˜ í•µì‹¬ ì»´í¬ë„ŒíŠ¸)

**ìƒíƒœ ê´€ë¦¬**:
```typescript
const [messages, setMessages] = useState<IChatMessage[]>([]);
const [input, setInput] = useState('');
const [isLoading, setIsLoading] = useState(false);
const [isStreaming, setIsStreaming] = useState(false);
const [conversationId, setConversationId] = useState<string>('');
const [showSettings, setShowSettings] = useState(false);
const [llmConfig, setLlmConfig] = useState<LLMConfig | null>(null);
```

**Refë¡œ ë…¸ì¶œëœ ë©”ì„œë“œ** (cell-buttons-pluginì—ì„œ í˜¸ì¶œ):
```typescript
useImperativeHandle(ref, () => ({
  handleSendMessage: async () => { ... },
  setInput: (value: string) => { ... },
  setLlmPrompt: (prompt: string) => { ... },
  setCurrentCellId: (cellId: string) => { ... },
  setCurrentCellIndex: (cellIndex: number) => { ... }
}));
```

**ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬**:
```typescript
const response = await fetch('/hdsp-agent/chat/stream', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ message, conversationId })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const chunk = decoder.decode(value);
  const lines = chunk.split('\n');

  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const data = JSON.parse(line.slice(6));
      if (data.content) {
        // ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì‹œì§€ì— ì¶”ê°€
        setMessages(prev => updateLastMessage(prev, data.content));
      }
    }
  }
}
```

**Markdown ë Œë”ë§**:
```typescript
import { formatMarkdownToHtml } from '../utils/markdownRenderer';

const messageHtml = formatMarkdownToHtml(message.content);
<div dangerouslySetInnerHTML={{ __html: messageHtml }} />
```

#### 4.2.5 `frontend/components/SettingsPanel.tsx`

**ì—­í• **: LLM ì„¤ì • UI

**Providerë³„ í•„ë“œ**:

**Gemini**:
```typescript
<TextField
  label="API Key"
  type="password"
  value={config.gemini.apiKey}
  onChange={e => updateConfig('gemini', 'apiKey', e.target.value)}
/>
<Select value={config.gemini.model}>
  <MenuItem value="gemini-2.5-pro">Gemini 2.5 Pro</MenuItem>
  <MenuItem value="gemini-pro">Gemini Pro</MenuItem>
</Select>
```

**OpenAI**:
```typescript
<TextField label="API Key" type="password" />
<Select value={config.openai.model}>
  <MenuItem value="gpt-4">GPT-4</MenuItem>
  <MenuItem value="gpt-3.5-turbo">GPT-3.5 Turbo</MenuItem>
</Select>
```

**vLLM**:
```typescript
<TextField
  label="Endpoint URL"
  value={config.vllm.endpoint}
  placeholder="http://localhost:8000"
/>
<TextField label="Model" value={config.vllm.model} />
```

**API í‚¤ ë§ˆìŠ¤í‚¹**:
- í‘œì‹œ: `****XXXX` (ë§ˆì§€ë§‰ 4ìë§Œ í‘œì‹œ)
- ì €ì¥: masked í‚¤ëŠ” ê¸°ì¡´ ê°’ ìœ ì§€

#### 4.2.6 `frontend/services/ApiService.ts`

**ì—­í• **: REST API í´ë¼ì´ì–¸íŠ¸

**CSRF í† í° ì²˜ë¦¬**:
```typescript
private getCsrfToken(): string {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; _xsrf=`);
  return parts.length === 2 ? parts.pop().split(';').shift() : '';
}

private getHeaders(): HeadersInit {
  return {
    'Content-Type': 'application/json',
    'X-XSRFToken': this.getCsrfToken()
  };
}
```

**ì£¼ìš” ë©”ì„œë“œ**:
```typescript
class ApiService {
  async sendMessage(request: IChatRequest): Promise<IChatResponse> {
    const response = await fetch(`${this.baseUrl}/chat/message`, {
      method: 'POST',
      headers: this.getHeaders(),
      body: JSON.stringify(request)
    });
    return response.json();
  }

  async cellAction(request: ICellActionRequest): Promise<ICellResponse> { ... }
  async getConfig(): Promise<IAgentConfig> { ... }
  async saveConfig(config: IAgentConfig): Promise<void> { ... }
  async getStatus(): Promise<IHealthStatus> { ... }
}
```

---

## 5. ë¹Œë“œ í”„ë¡œì„¸ìŠ¤

### 5.1 ë¹Œë“œ íŒŒì´í”„ë¼ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. TypeScript ì»´íŒŒì¼                                 â”‚
â”‚    frontend/ â†’ lib/ (tsc)                           â”‚
â”‚    - *.ts â†’ *.js + *.d.ts                           â”‚
â”‚    - JSX â†’ React.createElement() ë³€í™˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. JupyterLab Extension ë¹Œë“œ                        â”‚
â”‚    lib/ â†’ backend/labextension/ (webpack)           â”‚
â”‚    - Module Federationìœ¼ë¡œ ë²ˆë“¤ë§                   â”‚
â”‚    - CSS ì¶”ì¶œ ë° ìµœì í™”                             â”‚
â”‚    - Code splitting (vendors, main, styles)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Python Wheel ìƒì„±                                â”‚
â”‚    backend/ + pyproject.toml â†’ dist/*.whl          â”‚
â”‚    - Python íŒŒì¼ í¬í•¨                               â”‚
â”‚    - labextension/ í¬í•¨                             â”‚
â”‚    - ë©”íƒ€ë°ì´í„° ìƒì„±                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ë¹Œë“œ ëª…ë ¹ì–´

#### ìë™ ë¹Œë“œ (ê¶Œì¥)

```bash
cd /Users/a453180/repo/hdsp_agent

# ì „ì²´ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
./build.sh
```

**`build.sh` ë‚´ìš©**:
```bash
#!/bin/bash
set -e

echo "ğŸ”¨ Step 1: TypeScript ì»´íŒŒì¼..."
npx tsc

echo "ğŸ“¦ Step 2: JupyterLab Extension ë¹Œë“œ..."
poetry run jupyter labextension build .

echo "ğŸ Step 3: Wheel íŒŒì¼ ìƒì„±..."
poetry build

echo "âœ… ë¹Œë“œ ì™„ë£Œ!"
ls -lh dist/
```

#### ìˆ˜ë™ ë¹Œë“œ (ë‹¨ê³„ë³„)

```bash
# Step 1: TypeScript ì»´íŒŒì¼
npx tsc
# ë˜ëŠ”
jlpm build:lib

# Step 2: Extension ë¹Œë“œ
poetry run jupyter labextension build .

# Step 3: Wheel ìƒì„±
poetry build
```

### 5.3 ê°œë°œ ëª¨ë“œ ë¹Œë“œ

```bash
# Watch mode (ì½”ë“œ ë³€ê²½ ì‹œ ìë™ ì¬ë¹Œë“œ)
jlpm watch

# ë˜ëŠ” ê°œë³„ watch
jlpm watch:src          # TypeScript watch
jlpm watch:labextension  # Extension watch
```

### 5.4 ë¹Œë“œ ì¶œë ¥ë¬¼

```
dist/
â””â”€â”€ hdsp_agent-0.1.0-py3-none-any.whl   # ë°°í¬ìš© wheel íŒŒì¼

backend/labextension/                    # ë¹Œë“œëœ extension
â”œâ”€â”€ package.json
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ 179.*.js                        # Async chunk
â”‚   â”œâ”€â”€ lib_index_js.*.js               # Main plugin
â”‚   â”œâ”€â”€ remoteEntry.*.js                # Module Federation
â”‚   â”œâ”€â”€ style_index_css.*.js            # Styles
â”‚   â”œâ”€â”€ style.js                        # Style entry
â”‚   â””â”€â”€ vendors-*.js                    # React, MUI, dependencies
â””â”€â”€ build_log.json

lib/                                     # TypeScript ì»´íŒŒì¼ ê²°ê³¼
â”œâ”€â”€ index.js, index.d.ts
â”œâ”€â”€ components/
â”œâ”€â”€ plugins/
â””â”€â”€ services/
```

### 5.5 ë¹Œë“œ ì„¤ì • íŒŒì¼

#### `tsconfig.json`

```json
{
  "compilerOptions": {
    "rootDir": "frontend",      // ì†ŒìŠ¤ ë””ë ‰í† ë¦¬
    "outDir": "lib",            // ì¶œë ¥ ë””ë ‰í† ë¦¬
    "target": "ES2020",
    "module": "esnext",
    "jsx": "react",
    "declaration": true,        // .d.ts ìƒì„±
    "skipLibCheck": true
  },
  "include": ["frontend/**/*"]
}
```

#### `package.json` (jupyterlab ì„¹ì…˜)

```json
{
  "jupyterlab": {
    "extension": true,
    "outputDir": "backend/labextension",  // Extension ì¶œë ¥ ê²½ë¡œ
    "sharedPackages": {
      "@jupyterlab/application": {
        "bundled": false,       // JupyterLab ì œê³µ íŒ¨í‚¤ì§€ ì¬ì‚¬ìš©
        "singleton": true
      }
    }
  }
}
```

#### `pyproject.toml` (build ì„¹ì…˜)

```toml
[tool.poetry]
packages = [{ include = "backend" }]  # backend/ í¬í•¨

include = [
    "backend/labextension/**/*",      # ë¹Œë“œëœ extension
    "backend/etc/**/*",               # ì„¤ì • íŒŒì¼
    "install.json"                    # ë©”íƒ€ë°ì´í„°
]

[tool.jupyter-packaging.builder]
factory = "jupyter_packaging.npm_builder"

[tool.jupyter-packaging.build-args]
build_cmd = "build:prod"
npm = ["jlpm"]
source_dir = "frontend"
build_dir = "backend/labextension"
```

---

## 6. Wheel íŒŒì¼ êµ¬ì¡°

### 6.1 Wheel ë‚´ë¶€ êµ¬ì¡°

```
hdsp_agent-0.1.0-py3-none-any.whl (ì••ì¶• íŒŒì¼)
â”‚
â”œâ”€â”€ backend/                           # Python íŒ¨í‚¤ì§€
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ _version.py
â”‚   â”œâ”€â”€ llm_service.py
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ chat.py
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ cell_action.py
â”‚   â”‚   â”œâ”€â”€ status.py
â”‚   â”‚   â”œâ”€â”€ test_llm.py
â”‚   â”‚   â””â”€â”€ notebook_generation.py
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config_manager.py
â”‚   â”‚   â”œâ”€â”€ llm_client.py
â”‚   â”‚   â”œâ”€â”€ notebook_generator.py
â”‚   â”‚   â”œâ”€â”€ prompt_builder.py
â”‚   â”‚   â””â”€â”€ task_manager.py
â”‚   â”‚
â”‚   â”œâ”€â”€ etc/
â”‚   â”‚   â””â”€â”€ jupyter/
â”‚   â”‚       â””â”€â”€ jupyter_server_config.d/
â”‚   â”‚           â””â”€â”€ hdsp_agent.json
â”‚   â”‚
â”‚   â””â”€â”€ labextension/                 # â­ ë¹Œë“œëœ Frontend
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ static/
â”‚       â”‚   â”œâ”€â”€ 179.*.js             # Async chunk
â”‚       â”‚   â”œâ”€â”€ lib_index_js.*.js    # Main plugin (40KB)
â”‚       â”‚   â”œâ”€â”€ remoteEntry.*.js     # Module Federation (2KB)
â”‚       â”‚   â”œâ”€â”€ style_index_css.*.js # Styles (15KB)
â”‚       â”‚   â”œâ”€â”€ style.js             # Style entry
â”‚       â”‚   â””â”€â”€ vendors-*.js         # React, MUI (500KB+)
â”‚       â””â”€â”€ build_log.json
â”‚
â”œâ”€â”€ hdsp_agent-0.1.0.dist-info/      # ë©”íƒ€ë°ì´í„°
â”‚   â”œâ”€â”€ METADATA
â”‚   â”œâ”€â”€ WHEEL
â”‚   â”œâ”€â”€ RECORD
â”‚   â””â”€â”€ entry_points.txt             # Extension ë“±ë¡ ì •ë³´
â”‚
â””â”€â”€ install.json                      # JupyterLab extension ë©”íƒ€ë°ì´í„°
```

### 6.2 í•µì‹¬ íŒŒì¼ ì„¤ëª…

#### `backend/labextension/static/`

**Module Federation êµ¬ì¡°**:
- **remoteEntry.*.js**: Extension ì§„ì…ì 
- **lib_index_js.*.js**: 4ê°œ í”ŒëŸ¬ê·¸ì¸ ì½”ë“œ
- **vendors-*.js**: React, MUI, Emotion ë“± ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **style_index_css.*.js**: ëª¨ë“  CSS ë²ˆë“¤

#### `hdsp_agent-0.1.0.dist-info/entry_points.txt`

```ini
[jupyter_labextensions]
hdsp-agent = backend

[jupyter_server.extension_points]
hdsp-agent = backend:_jupyter_server_extension_points
```

**ì—­í• **: Jupyterê°€ extensionì„ ìë™ ë°œê²¬í•˜ê³  ë¡œë“œ

#### `install.json`

```json
{
  "packageManager": "python",
  "packageName": "@hdsp-agent/extension",
  "uninstallInstructions": "Use `pip uninstall hdsp-agent` to remove"
}
```

### 6.3 ì„¤ì¹˜ ê³¼ì • ìƒì„¸

```bash
pip install hdsp_agent-0.1.0-py3-none-any.whl
```

**ë‚´ë¶€ ë™ì‘**:

1. **Python íŒŒì¼ ì„¤ì¹˜**:
   ```
   site-packages/backend/
   â”œâ”€â”€ __init__.py
   â”œâ”€â”€ handlers/
   â””â”€â”€ services/
   ```

2. **Extension íŒŒì¼ ë³µì‚¬**:
   ```
   site-packages/backend/labextension/
   â””â”€â”€ static/
       â”œâ”€â”€ lib_index_js.*.js
       â””â”€â”€ vendors-*.js
   ```

3. **ì„¤ì • íŒŒì¼ ë“±ë¡**:
   ```
   ~/.jupyter/jupyter_server_config.d/hdsp_agent.json
   ```

4. **Entry points ë“±ë¡**:
   - `jupyter_labextensions`: Frontend extension
   - `jupyter_server.extension_points`: Backend extension

5. **Jupyter ì¬ì‹œì‘ ì‹œ**:
   - Serverê°€ `backend:_jupyter_server_extension_points()` í˜¸ì¶œ
   - `load_jupyter_server_extension()` ì‹¤í–‰ â†’ API handlers ë“±ë¡
   - JupyterLabì´ `backend/labextension/` ë¡œë“œ â†’ í”ŒëŸ¬ê·¸ì¸ í™œì„±í™”

---

## 7. JupyterHub on K8s ë°°í¬

### 7.1 ì‚¬ì „ ì¤€ë¹„

#### ë¡œì»¬ì—ì„œ Wheel ë¹Œë“œ

```bash
cd /Users/a453180/repo/hdsp_agent

# ì „ì²´ ë¹Œë“œ
./build.sh

# ê²°ê³¼ í™•ì¸
ls -lh dist/
# hdsp_agent-0.1.0-py3-none-any.whl (ì•½ 600KB)
```

### 7.2 ë°°í¬ ë°©ë²• 1: Docker ì´ë¯¸ì§€ì— í¬í•¨ (ê¶Œì¥)

#### Dockerfile

```dockerfile
FROM jupyter/minimal-notebook:latest

# root ê¶Œí•œìœ¼ë¡œ ì „í™˜
USER root

# Wheel íŒŒì¼ ë³µì‚¬
COPY dist/hdsp_agent-0.1.0-py3-none-any.whl /tmp/

# Extension ì„¤ì¹˜
RUN pip install --no-cache-dir /tmp/hdsp_agent-0.1.0-py3-none-any.whl

# Extension í™œì„±í™” í™•ì¸
RUN jupyter server extension list && \
    jupyter labextension list

# ì„ì‹œ íŒŒì¼ ì‚­ì œ
RUN rm /tmp/hdsp_agent-0.1.0-py3-none-any.whl

# ë‹¤ì‹œ jovyan ì‚¬ìš©ìë¡œ
USER ${NB_UID}

# JupyterLab ì‹œì‘
CMD ["jupyter", "lab", "--ip=0.0.0.0", "--port=8888", "--no-browser"]
```

#### ë¹Œë“œ ë° í‘¸ì‹œ

```bash
# Docker ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t your-registry/jupyter-hdsp-agent:0.1.0 .

# Registryì— í‘¸ì‹œ
docker push your-registry/jupyter-hdsp-agent:0.1.0
```

#### JupyterHub Helm Values

```yaml
# values.yaml
singleuser:
  image:
    name: your-registry/jupyter-hdsp-agent
    tag: "0.1.0"

  # LLM API í‚¤ ì„¤ì • (Secret ì‚¬ìš©)
  extraEnv:
    GEMINI_API_KEY:
      valueFrom:
        secretKeyRef:
          name: llm-api-keys
          key: gemini-api-key
```

### 7.3 ë°°í¬ ë°©ë²• 2: InitContainerë¡œ ì„¤ì¹˜

#### ConfigMapì— Wheel ì €ì¥

```bash
# Wheelì„ base64 ì¸ì½”ë”©
base64 dist/hdsp_agent-0.1.0-py3-none-any.whl > wheel.b64

# ConfigMap ìƒì„±
kubectl create configmap hdsp-agent-wheel \
  --from-file=hdsp_agent-0.1.0-py3-none-any.whl=wheel.b64 \
  -n jupyterhub
```

#### JupyterHub Helm Values

```yaml
# values.yaml
singleuser:
  storage:
    extraVolumes:
      - name: hdsp-wheel
        configMap:
          name: hdsp-agent-wheel
    extraVolumeMounts:
      - name: hdsp-wheel
        mountPath: /tmp/wheels

  initContainers:
    - name: install-hdsp-agent
      image: jupyter/minimal-notebook:latest
      command: ["/bin/bash", "-c"]
      args:
        - |
          base64 -d /tmp/wheels/hdsp_agent-0.1.0-py3-none-any.whl > /tmp/wheel.whl
          pip install --user /tmp/wheel.whl
          rm /tmp/wheel.whl
      volumeMounts:
        - name: hdsp-wheel
          mountPath: /tmp/wheels
        - name: home
          mountPath: /home/jovyan
```

**í•œê³„ì **: Userë³„ë¡œ extension ì„¤ì¹˜ë˜ë©°, ì˜êµ¬ ìŠ¤í† ë¦¬ì§€ í•„ìš”

### 7.4 ë°°í¬ ë°©ë²• 3: PVCë¥¼ í†µí•œ ê³µìœ  ì„¤ì¹˜

#### Step 1: PVC ìƒì„±

```yaml
# wheel-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: hdsp-wheels-pvc
  namespace: jupyterhub
spec:
  accessModes:
    - ReadOnlyMany  # ì—¬ëŸ¬ Podì—ì„œ ì½ê¸°
  resources:
    requests:
      storage: 1Gi
  storageClassName: standard
```

```bash
kubectl apply -f wheel-pvc.yaml
```

#### Step 2: Wheel íŒŒì¼ ì—…ë¡œë“œ

```bash
# ì„ì‹œ Podë¡œ ì—…ë¡œë“œ
kubectl run wheel-uploader \
  --image=alpine \
  --restart=Never \
  --rm -i \
  --overrides='
{
  "apiVersion": "v1",
  "spec": {
    "containers": [{
      "name": "uploader",
      "image": "alpine",
      "command": ["sleep", "3600"],
      "volumeMounts": [{
        "name": "wheels",
        "mountPath": "/wheels"
      }]
    }],
    "volumes": [{
      "name": "wheels",
      "persistentVolumeClaim": {
        "claimName": "hdsp-wheels-pvc"
      }
    }]
  }
}'

# íŒŒì¼ ë³µì‚¬
kubectl cp dist/hdsp_agent-0.1.0-py3-none-any.whl \
  jupyterhub/wheel-uploader:/wheels/

# Pod ì‚­ì œ
kubectl delete pod wheel-uploader -n jupyterhub
```

#### Step 3: JupyterHub Helm Values

```yaml
# values.yaml
singleuser:
  storage:
    extraVolumes:
      - name: shared-wheels
        persistentVolumeClaim:
          claimName: hdsp-wheels-pvc
          readOnly: true
    extraVolumeMounts:
      - name: shared-wheels
        mountPath: /shared/wheels
        readOnly: true

  initContainers:
    - name: install-hdsp-agent
      image: jupyter/minimal-notebook:latest
      command: ["/bin/bash", "-c"]
      args:
        - pip install --user /shared/wheels/hdsp_agent-0.1.0-py3-none-any.whl
      volumeMounts:
        - name: shared-wheels
          mountPath: /shared/wheels
        - name: home
          mountPath: /home/jovyan
```

### 7.5 ë°°í¬ ë°©ë²• 4: Sidecar Container (ë™ì  ì„¤ì¹˜)

```yaml
# values.yaml
singleuser:
  extraContainers:
    - name: extension-installer
      image: jupyter/minimal-notebook:latest
      command: ["/bin/bash", "-c"]
      args:
        - |
          while true; do
            if [ ! -f /home/jovyan/.hdsp-installed ]; then
              pip install --user https://your-cdn.com/hdsp_agent-0.1.0-py3-none-any.whl
              touch /home/jovyan/.hdsp-installed
            fi
            sleep 300
          done
      volumeMounts:
        - name: home
          mountPath: /home/jovyan
```

### 7.6 API í‚¤ ê´€ë¦¬ (Secret)

#### Secret ìƒì„±

```bash
# Gemini API í‚¤ ì„¤ì •
kubectl create secret generic llm-api-keys \
  --from-literal=gemini-api-key=YOUR_GEMINI_API_KEY \
  --from-literal=openai-api-key=YOUR_OPENAI_API_KEY \
  -n jupyterhub
```

#### Extensionì—ì„œ ì‚¬ìš©

**ë°©ë²• 1: í™˜ê²½ë³€ìˆ˜ë¡œ ì£¼ì…**

```yaml
# values.yaml
singleuser:
  extraEnv:
    GEMINI_API_KEY:
      valueFrom:
        secretKeyRef:
          name: llm-api-keys
          key: gemini-api-key
```

ì‚¬ìš©ìê°€ Settingsì—ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ API í‚¤ë¡œ ì‚¬ìš©í•˜ë„ë¡ ì•ˆë‚´

**ë°©ë²• 2: ê¸°ë³¸ ì„¤ì • íŒŒì¼ ì œê³µ**

```yaml
singleuser:
  lifecycleHooks:
    postStart:
      exec:
        command:
          - /bin/bash
          - -c
          - |
            mkdir -p ~/.jupyter
            cat > ~/.jupyter/hdsp_agent_config.json <<EOF
            {
              "provider": "gemini",
              "gemini": {
                "apiKey": "$GEMINI_API_KEY",
                "model": "gemini-2.5-pro"
              }
            }
            EOF
```

### 7.7 Helm ë°°í¬ ëª…ë ¹ì–´

```bash
# Helm repo ì¶”ê°€
helm repo add jupyterhub https://hub.jupyter.org/helm-chart/
helm repo update

# JupyterHub ì„¤ì¹˜/ì—…ë°ì´íŠ¸
helm upgrade --install jupyterhub jupyterhub/jupyterhub \
  --namespace jupyterhub \
  --create-namespace \
  --values values.yaml \
  --version=3.0.0
```

### 7.8 ë°°í¬ í›„ í™•ì¸

```bash
# Pod ìƒíƒœ í™•ì¸
kubectl get pods -n jupyterhub

# Extension ì„¤ì¹˜ í™•ì¸
kubectl exec -it jupyter-username -n jupyterhub -- \
  jupyter server extension list

# Extension í™œì„±í™” í™•ì¸
kubectl exec -it jupyter-username -n jupyterhub -- \
  jupyter labextension list

# ë¡œê·¸ í™•ì¸
kubectl logs -f jupyter-username -n jupyterhub
```

---

## 8. ì„¤ì¹˜ ê²€ì¦

### 8.1 Extension ë“±ë¡ í™•ì¸

```bash
# Jupyter Server Extension í™•ì¸
jupyter server extension list

# ì •ìƒ ì¶œë ¥:
# Config dir: /Users/username/.jupyter
#     backend enabled
#     - Validating backend...
#       backend 0.1.0 OK
```

```bash
# JupyterLab Extension í™•ì¸
jupyter labextension list

# ì •ìƒ ì¶œë ¥:
# JupyterLab v4.x.x
# /path/to/labextensions
#     @hdsp-agent/extension v0.1.0 enabled OK
```

### 8.2 JupyterLab UI í™•ì¸

1. **JupyterLab ì‹œì‘**:
   ```bash
   jupyter lab
   ```

2. **ì‚¬ì´ë“œë°” íŒ¨ë„ í™•ì¸**:
   - ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°”ì— ğŸ¤– ì•„ì´ì½˜ í‘œì‹œ
   - í´ë¦­ ì‹œ Agent íŒ¨ë„ ì—´ë¦¼
   - ì±„íŒ… ì…ë ¥ì°½ ë° ì„¤ì • ë²„íŠ¼ í™•ì¸

3. **ì…€ ë²„íŠ¼ í™•ì¸**:
   - ë…¸íŠ¸ë¶ ìƒì„±
   - ì½”ë“œ ì…€ ì¶”ê°€
   - ì…€ ì˜¤ë¥¸ìª½ ìƒë‹¨ì— E/F/? ë²„íŠ¼ í‘œì‹œ í™•ì¸

4. **ì„¤ì • íŒ¨ë„ í™•ì¸**:
   - í†±ë‹ˆë°”í€´ ì•„ì´ì½˜ í´ë¦­
   - Provider ì„ íƒ (Gemini/OpenAI/vLLM)
   - API í‚¤ ì…ë ¥ í•„ë“œ í™•ì¸

### 8.3 API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸

```bash
# í„°ë¯¸ë„ì—ì„œ curl í…ŒìŠ¤íŠ¸

# 1. Status í™•ì¸
curl http://localhost:8888/hdsp-agent/status

# ì •ìƒ ì¶œë ¥:
# {"status": "ok", "version": "0.1.0"}

# 2. Config ì¡°íšŒ
curl http://localhost:8888/hdsp-agent/config

# ì •ìƒ ì¶œë ¥:
# {"provider": "gemini", "gemini": {...}, ...}
```

### 8.4 LLM ì—°ê²° í…ŒìŠ¤íŠ¸

1. **ì„¤ì •ì—ì„œ API í‚¤ ì…ë ¥**:
   - Settings ì—´ê¸°
   - Provider ì„ íƒ (ì˜ˆ: Gemini)
   - API í‚¤ ì…ë ¥
   - Save í´ë¦­

2. **ì±„íŒ… í…ŒìŠ¤íŠ¸**:
   - "Hello" ì…ë ¥ í›„ ì „ì†¡
   - ì‘ë‹µ ìˆ˜ì‹  í™•ì¸

3. **ì…€ ë¶„ì„ í…ŒìŠ¤íŠ¸**:
   - ì½”ë“œ ì…€ì— ê°„ë‹¨í•œ ì½”ë“œ ì‘ì„±
   - E ë²„íŠ¼ í´ë¦­
   - ì„¤ëª… ì‘ë‹µ í™•ì¸

### 8.5 ë¡œê·¸ í™•ì¸

```bash
# JupyterLab ë¡œê·¸ (í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰ ì‹œ)
# ì •ìƒì ìœ¼ë¡œ ë¡œë“œëœ ê²½ìš°:
[ServerApp] hdsp_agent extension loaded
[ServerApp] Handlers registered: /hdsp-agent/*

# ë¸Œë¼ìš°ì € ì½˜ì†” ë¡œê·¸ (F12)
# ì •ìƒì ìœ¼ë¡œ ë¡œë“œëœ ê²½ìš°:
[AgentPanel] Config loaded: {provider: 'gemini', ...}
[AgentPanel] Extension initialized
```

---

## 9. ì„¤ì • ë°©ë²•

### 9.1 ì„¤ì • íŒŒì¼ ìœ„ì¹˜

```
~/.jupyter/hdsp_agent_config.json
```

### 9.2 ê¸°ë³¸ ì„¤ì • êµ¬ì¡°

```json
{
  "provider": "gemini",
  "gemini": {
    "apiKey": "YOUR_API_KEY_HERE",
    "model": "gemini-2.5-pro"
  },
  "vllm": {
    "endpoint": "http://localhost:8000",
    "apiKey": "",
    "model": "meta-llama/Llama-2-7b-chat-hf"
  },
  "openai": {
    "apiKey": "",
    "model": "gpt-4"
  }
}
```

### 9.3 Providerë³„ ì„¤ì • ê°€ì´ë“œ

#### Gemini (Google)

1. **API í‚¤ ë°œê¸‰**:
   - https://makersuite.google.com/app/apikey ë°©ë¬¸
   - API key ìƒì„±

2. **ì„¤ì •**:
   ```json
   {
     "provider": "gemini",
     "gemini": {
       "apiKey": "AIzaSy...",
       "model": "gemini-2.5-pro"
     }
   }
   ```

3. **ì§€ì› ëª¨ë¸**:
   - `gemini-2.5-pro` (ê¶Œì¥)
   - `gemini-pro`
   - `gemini-1.5-flash`

#### OpenAI

1. **API í‚¤ ë°œê¸‰**:
   - https://platform.openai.com/api-keys ë°©ë¬¸
   - API key ìƒì„±

2. **ì„¤ì •**:
   ```json
   {
     "provider": "openai",
     "openai": {
       "apiKey": "sk-...",
       "model": "gpt-4"
     }
   }
   ```

3. **ì§€ì› ëª¨ë¸**:
   - `gpt-4` (ê¶Œì¥)
   - `gpt-4-turbo`
   - `gpt-3.5-turbo`

#### vLLM (ë¡œì»¬)

1. **vLLM ì„œë²„ ì‹œì‘**:
   ```bash
   pip install vllm

   python -m vllm.entrypoints.openai.api_server \
     --model meta-llama/Llama-2-7b-chat-hf \
     --port 8000
   ```

2. **ì„¤ì •**:
   ```json
   {
     "provider": "vllm",
     "vllm": {
       "endpoint": "http://localhost:8000",
       "apiKey": "",  # ì„ íƒì‚¬í•­
       "model": "meta-llama/Llama-2-7b-chat-hf"
     }
   }
   ```

### 9.4 UIì—ì„œ ì„¤ì • ë³€ê²½

1. JupyterLab ì‚¬ì´ë“œë°”ì—ì„œ Agent íŒ¨ë„ ì—´ê¸°
2. í†±ë‹ˆë°”í€´ ì•„ì´ì½˜(âš™ï¸) í´ë¦­
3. Provider ì„ íƒ
4. í•´ë‹¹ Provider ì •ë³´ ì…ë ¥
5. Save í´ë¦­

### 9.5 í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì • (K8s)

```yaml
# values.yaml
singleuser:
  extraEnv:
    HDSP_PROVIDER: "gemini"
    GEMINI_API_KEY:
      valueFrom:
        secretKeyRef:
          name: llm-api-keys
          key: gemini-api-key
```

Extensionì—ì„œ í™˜ê²½ë³€ìˆ˜ ì½ë„ë¡ ìˆ˜ì • í•„ìš” ì‹œ:

```python
# backend/services/config_manager.py
import os

def _default_config(self):
    return {
        'provider': os.getenv('HDSP_PROVIDER', 'gemini'),
        'gemini': {
            'apiKey': os.getenv('GEMINI_API_KEY', ''),
            'model': os.getenv('GEMINI_MODEL', 'gemini-2.5-pro')
        }
    }
```

---

## 10. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 10.1 Extensionì´ ë¡œë“œë˜ì§€ ì•Šì„ ë•Œ

**ì¦ìƒ**: ì‚¬ì´ë“œë°”ì— Agent íŒ¨ë„ì´ ì—†ìŒ

**í•´ê²° ë°©ë²•**:

1. **Extension ì„¤ì¹˜ í™•ì¸**:
   ```bash
   jupyter labextension list
   ```

   `@hdsp-agent/extension`ì´ ì—†ìœ¼ë©´:
   ```bash
   pip install --force-reinstall hdsp_agent-0.1.0-py3-none-any.whl
   ```

2. **ìºì‹œ í´ë¦¬ì–´**:
   ```bash
   jupyter lab clean
   jupyter lab build
   ```

3. **Browser ìºì‹œ ì‚­ì œ**:
   - Ctrl+Shift+R (ê°•ì œ ìƒˆë¡œê³ ì¹¨)
   - F12 â†’ Network â†’ Disable cache

4. **ë¡œê·¸ í™•ì¸**:
   ```bash
   jupyter lab --debug
   ```

### 10.2 API 404 ì—ëŸ¬

**ì¦ìƒ**: ì±„íŒ… ì „ì†¡ ì‹œ "Failed to send message" ì—ëŸ¬

**ì›ì¸**: Backend handlerê°€ ë“±ë¡ë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:

1. **Server Extension í™•ì¸**:
   ```bash
   jupyter server extension list
   ```

   `backend`ê°€ ì—†ìœ¼ë©´:
   ```bash
   jupyter server extension enable backend
   ```

2. **ë¼ìš°íŠ¸ í™•ì¸**:
   ```bash
   # JupyterLab ì‹¤í–‰ í›„ í„°ë¯¸ë„ì—ì„œ
   curl http://localhost:8888/hdsp-agent/status
   ```

   404 ì—ëŸ¬ ì‹œ ì„œë²„ ì¬ì‹œì‘:
   ```bash
   # JupyterLab ì¢…ë£Œ í›„
   jupyter lab
   ```

3. **Backend íŒŒì¼ í™•ì¸**:
   ```bash
   python -c "import backend; print(backend.__file__)"
   # backend/__init__.py ê²½ë¡œ ì¶œë ¥ í™•ì¸
   ```

### 10.3 LLM ì—°ê²° ì‹¤íŒ¨

#### Gemini API ì—ëŸ¬

**ì—ëŸ¬**: `503 Service Unavailable`

**í•´ê²°**:
- Retry ë¡œì§ì´ ìë™ ì‘ë™ (2s, 4s, 8s ëŒ€ê¸°)
- ì—¬ì „íˆ ì‹¤íŒ¨ ì‹œ ì ì‹œ í›„ ì¬ì‹œë„

**ì—ëŸ¬**: `400 API key not valid`

**í•´ê²°**:
- API í‚¤ ì¬í™•ì¸
- https://makersuite.google.com/app/apikey ì—ì„œ ìƒˆ í‚¤ ë°œê¸‰

#### OpenAI API ì—ëŸ¬

**ì—ëŸ¬**: `401 Unauthorized`

**í•´ê²°**:
- API í‚¤ í˜•ì‹ í™•ì¸ (`sk-`ë¡œ ì‹œì‘)
- ê³„ì •ì— í¬ë ˆë”§ ì”ì•¡ í™•ì¸

**ì—ëŸ¬**: `429 Rate limit exceeded`

**í•´ê²°**:
- Retry ë¡œì§ ì‘ë™ (5s, 10s, 20s ëŒ€ê¸°)
- API usage limit ì¦ê°€ ìš”ì²­

#### vLLM ì—°ê²° ì—ëŸ¬

**ì—ëŸ¬**: `Connection refused`

**í•´ê²°**:
1. vLLM ì„œë²„ ì‹¤í–‰ í™•ì¸:
   ```bash
   curl http://localhost:8000/v1/models
   ```

2. Endpoint URL í™•ì¸:
   - Settingsì—ì„œ `http://localhost:8000` ì…ë ¥
   - K8s í™˜ê²½: Service DNS ì‚¬ìš© (ì˜ˆ: `http://vllm-service:8000`)

### 10.4 ë¹Œë“œ ì—ëŸ¬

#### TypeScript ì»´íŒŒì¼ ì—ëŸ¬

```
error TS2307: Cannot find module '@jupyterlab/application'
```

**í•´ê²°**:
```bash
jlpm install  # ì˜ì¡´ì„± ì¬ì„¤ì¹˜
```

#### Extension ë¹Œë“œ ì—ëŸ¬

```
ValueError: Please install nodejs >=12.0.0
```

**í•´ê²°**:
```bash
# Node.js ë²„ì „ í™•ì¸
node --version  # v18+ ê¶Œì¥

# nvmìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ
nvm install 18
nvm use 18
```

#### Wheel ë¹Œë“œ ì—ëŸ¬

```
ERROR: backend/labextension/static/style.js not found
```

**í•´ê²°**:
```bash
# Extension ë¹Œë“œ ë¨¼ì € ì‹¤í–‰
jupyter labextension build .

# ê·¸ í›„ wheel ë¹Œë“œ
poetry build
```

### 10.5 ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ëŠê¹€

**ì¦ìƒ**: ì±„íŒ… ì‘ë‹µì´ ì¤‘ê°„ì— ë©ˆì¶¤

**ì›ì¸**: Proxy timeout (Nginx, K8s Ingress ë“±)

**í•´ê²°**:

**Nginx**:
```nginx
location /hdsp-agent/chat/stream {
    proxy_pass http://jupyterhub;
    proxy_buffering off;
    proxy_read_timeout 300s;
    proxy_connect_timeout 300s;
}
```

**K8s Ingress (Nginx)**:
```yaml
metadata:
  annotations:
    nginx.ingress.kubernetes.io/proxy-buffering: "off"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
```

### 10.6 ì„¤ì •ì´ ì €ì¥ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: Settingsì—ì„œ ì €ì¥í•´ë„ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”

**ì›ì¸**: íŒŒì¼ ê¶Œí•œ ë˜ëŠ” ê²½ë¡œ ë¬¸ì œ

**í•´ê²°**:

1. **ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸**:
   ```bash
   ls -la ~/.jupyter/
   chmod 755 ~/.jupyter/
   ```

2. **ì„¤ì • íŒŒì¼ ì§ì ‘ í™•ì¸**:
   ```bash
   cat ~/.jupyter/hdsp_agent_config.json
   ```

3. **ìˆ˜ë™ ìƒì„±**:
   ```bash
   mkdir -p ~/.jupyter
   cat > ~/.jupyter/hdsp_agent_config.json <<EOF
   {
     "provider": "gemini",
     "gemini": {
       "apiKey": "YOUR_KEY",
       "model": "gemini-2.5-pro"
     }
   }
   EOF
   ```

---

## 11. ê°œë°œ ê°€ì´ë“œ

### 11.1 ë¡œì»¬ ê°œë°œ í™˜ê²½ ì„¤ì •

#### ì´ˆê¸° ì„¤ì •

```bash
# 1. Repository clone
git clone https://github.com/lks21c/hdsp_agent.git
cd hdsp_agent

# 2. Python í™˜ê²½ ì„¤ì •
poetry install

# 3. Node.js ì˜ì¡´ì„± ì„¤ì¹˜
jlpm install

# 4. ê°œë°œ ëª¨ë“œ ì„¤ì¹˜
pip install -e .

# 5. Extension ê°œë°œ ëª¨ë“œ í™œì„±í™”
jupyter labextension develop . --overwrite
```

### 11.2 Watch Mode ì‹¤í–‰

**í„°ë¯¸ë„ 1**: TypeScript watch
```bash
jlpm watch:src
# frontend/ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ lib/ ì¬ë¹Œë“œ
```

**í„°ë¯¸ë„ 2**: Extension watch
```bash
jlpm watch:labextension
# lib/ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ backend/labextension/ ì¬ë¹Œë“œ
```

**í„°ë¯¸ë„ 3**: JupyterLab ì‹¤í–‰
```bash
jupyter lab --autoreload
# Python ì½”ë“œ ë³€ê²½ ì‹œ ìë™ ì¬ë¡œë“œ
```

### 11.3 ì½”ë“œ ìˆ˜ì • ì›Œí¬í”Œë¡œìš°

#### Frontend ìˆ˜ì •

1. `frontend/components/AgentPanel.tsx` ìˆ˜ì •
2. Watch modeê°€ ìë™ìœ¼ë¡œ `lib/components/AgentPanel.js` ìƒì„±
3. Extension watchê°€ ìë™ìœ¼ë¡œ `backend/labextension/` ì—…ë°ì´íŠ¸
4. ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ (Ctrl+R)

#### Backend ìˆ˜ì •

1. `backend/handlers/chat.py` ìˆ˜ì •
2. JupyterLab ìë™ ì¬ë¡œë“œ (--autoreload ì˜µì…˜)
3. API í…ŒìŠ¤íŠ¸

### 11.4 ë””ë²„ê¹… ë°©ë²•

#### Frontend ë””ë²„ê¹…

```typescript
// frontend/components/AgentPanel.tsx
console.log('[AgentPanel] Message sent:', message);
console.log('[AgentPanel] Response:', response);
```

**ë¸Œë¼ìš°ì € ì½˜ì†”** (F12):
- Console íƒ­ì—ì„œ ë¡œê·¸ í™•ì¸
- Network íƒ­ì—ì„œ API ìš”ì²­/ì‘ë‹µ í™•ì¸
- Sources íƒ­ì—ì„œ breakpoint ì„¤ì •

#### Backend ë””ë²„ê¹…

```python
# backend/handlers/chat.py
self.log.info(f"=== Chat message received ===")
self.log.info(f"Message: {message}")
```

**í„°ë¯¸ë„ ë¡œê·¸**:
```bash
jupyter lab --debug
# ëª¨ë“  ë¡œê·¸ ì¶œë ¥
```

**Python ë””ë²„ê±°**:
```python
import pdb; pdb.set_trace()
# ì½”ë“œ ì‹¤í–‰ ì¤‘ë‹¨ ë° ë””ë²„ê¹…
```

### 11.5 í…ŒìŠ¤íŠ¸

#### Frontend í…ŒìŠ¤íŠ¸ (TODO)

```bash
# Jest í…ŒìŠ¤íŠ¸ (ì•„ì§ ë¯¸êµ¬í˜„)
jlpm test
```

#### Backend í…ŒìŠ¤íŠ¸

```bash
# Pytest ì‹¤í–‰
poetry run pytest tests/
```

#### E2E í…ŒìŠ¤íŠ¸ (ìˆ˜ë™)

1. JupyterLab ì‹¤í–‰
2. ë…¸íŠ¸ë¶ ìƒì„±
3. ì½”ë“œ ì…€ì—ì„œ E ë²„íŠ¼ í´ë¦­
4. ì‘ë‹µ í™•ì¸
5. ì±„íŒ… ì…ë ¥ í…ŒìŠ¤íŠ¸
6. ì„¤ì • ë³€ê²½ í…ŒìŠ¤íŠ¸

### 11.6 ì½”ë“œ ìŠ¤íƒ€ì¼

#### Python (Black + isort)

```bash
# í¬ë§·íŒ…
poetry run black backend/
poetry run isort backend/

# Lint
poetry run flake8 backend/
```

#### TypeScript (Prettier + ESLint)

```bash
# í¬ë§·íŒ…
jlpm prettier

# Lint
jlpm eslint

# ì „ì²´
jlpm lint
```

### 11.7 ë¦´ë¦¬ìŠ¤ í”„ë¡œì„¸ìŠ¤

1. **ë²„ì „ ì—…ë°ì´íŠ¸**:
   ```bash
   # pyproject.toml
   version = "0.2.0"

   # package.json
   "version": "0.2.0"
   ```

2. **CHANGELOG ì‘ì„±**:
   ```markdown
   ## [0.2.0] - 2025-11-26
   ### Added
   - ìƒˆë¡œìš´ ê¸°ëŠ¥

   ### Fixed
   - ë²„ê·¸ ìˆ˜ì •
   ```

3. **ë¹Œë“œ**:
   ```bash
   ./build.sh
   ```

4. **í…ŒìŠ¤íŠ¸**:
   ```bash
   pip install dist/hdsp_agent-0.2.0-py3-none-any.whl
   jupyter lab
   # ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
   ```

5. **Git íƒœê·¸**:
   ```bash
   git tag v0.2.0
   git push origin v0.2.0
   ```

6. **ë°°í¬**:
   - PyPI ì—…ë¡œë“œ (ì„ íƒ):
     ```bash
     poetry publish
     ```
   - Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ

---

## 12. ì°¸ê³  ìë£Œ

### 12.1 ê³µì‹ ë¬¸ì„œ

- **JupyterLab Extensions**: https://jupyterlab.readthedocs.io/en/stable/extension/extension_dev.html
- **Jupyter Server**: https://jupyter-server.readthedocs.io/
- **Google Gemini API**: https://ai.google.dev/docs
- **OpenAI API**: https://platform.openai.com/docs
- **vLLM**: https://docs.vllm.ai/

### 12.2 ê´€ë ¨ ê¸°ìˆ 

- **TypeScript**: https://www.typescriptlang.org/
- **React**: https://react.dev/
- **Material-UI**: https://mui.com/
- **Poetry**: https://python-poetry.org/
- **aiohttp**: https://docs.aiohttp.org/

### 12.3 Repository

- **GitHub**: https://github.com/lks21c/hdsp_agent
- **Issues**: https://github.com/lks21c/hdsp_agent/issues

---

## 13. ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© |
|------|------|-----------|
| 2025-11-25 | 0.1.0 | ì´ˆê¸° ë¦´ë¦¬ìŠ¤ |
| 2025-11-25 | - | ì¸ìˆ˜ì¸ê³„ ë¬¸ì„œ ì‘ì„± |

---

## 14. ì—°ë½ì²˜

ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë‹¤ìŒìœ¼ë¡œ ì—°ë½ ì£¼ì„¸ìš”:

- **Email**: your.email@example.com
- **GitHub Issues**: https://github.com/lks21c/hdsp_agent/issues

---

**ë¬¸ì„œ ë**
